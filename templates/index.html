<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½å†…é‡‘ä»·å®æ—¶ç›‘æ§ç³»ç»Ÿ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui'],
                        mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular'],
                    },
                    colors: {
                        'up': '#ef4444',
                        'down': '#22c55e',
                        'card-bg': '#161b2a',
                        'page-bg': '#0b0f19',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root {
            --color-up: #ef4444;
            --color-down: #22c55e;
            --bg-page: #0b0f19;
            --bg-card: #161b2a;
            --bg-elevated: #1c2128;
            --bg-hover: #242a33;
            --border-light: rgba(255, 255, 255, 0.05);
            --border-default: rgba(255, 255, 255, 0.1);
            --border-subtle: rgba(255, 255, 255, 0.06);
            
            /* ç¥ç€é‡‘ä¸»é¢˜è‰² */
            --accent-primary: #d4a574;
            --accent-light: #f5c684;
            --accent-glow: rgba(212, 165, 116, 0.25);
            --accent-subtle: rgba(212, 165, 116, 0.1);
            
            /* æ¶¨è·Œé¢œè‰² */
            --up: #dc2626;
            --up-light: #ef4444;
            --up-bg: rgba(220, 38, 38, 0.1);
            --up-glow: rgba(220, 38, 68, 0.3);
            
            --down: #059669;
            --down-light: #10b981;
            --down-bg: rgba(5, 150, 105, 0.1);
            --down-glow: rgba(5, 150, 105, 0.3);
            
            /* æ–‡æœ¬é¢œè‰² */
            --text-primary: #f0f0f0;
            --text-secondary: #8b949e;
            --text-muted: #484f58;
        }

        /* ç¡¬ä»¶åŠ é€Ÿé€šç”¨ç±» */
        .hw-accel {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        @keyframes pulse-up-color {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }

            /* Red for Up */
            50% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }

        @keyframes pulse-down-color {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }

            /* Green for Down */
            50% {
                box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
            }
        }

        /* åŸºé‡‘å¡ç‰‡çŠ¶æ€é—ªçƒ */
        @keyframes flash-up {
            0% {
                background-color: rgba(239, 68, 68, 0.1);
            }

            50% {
                background-color: rgba(239, 68, 68, 0.3);
            }

            100% {
                background-color: transparent;
            }
        }

        @keyframes flash-down {
            0% {
                background-color: rgba(34, 197, 94, 0.1);
            }

            50% {
                background-color: rgba(34, 197, 94, 0.3);
            }

            100% {
                background-color: transparent;
            }
        }

        .animate-flash-up {
            animation: flash-up 1s ease-out;
        }

        .animate-flash-down {
            animation: flash-down 1s ease-out;
        }

        .pulse-up {
            animation: pulse-up-color 2s infinite;
        }

        .pulse-down {
            animation: pulse-down-color 2s infinite;
        }

        .price-up {
            color: #ef4444;
        }

        /* Red */
        .price-down {
            color: #22c55e;
        }

        /* Green */

        /* Red Gradient for Up/Rise */
        .bg-up {
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
        }

        /* Green Gradient for Down/Fall */
        .bg-down {
            background: linear-gradient(135deg, #065f46 0%, #047857 100%);
        }

        /* ç§»é™¤ç»ç’ƒæ‹Ÿæ€ï¼Œæ”¹ä¸ºå®è‰²é«˜æ€§èƒ½è®¾è®¡ */
        .glass {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* çº¯å‡€æ·±è‰²å¡ç‰‡ */
        .solid-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            transition: border-color 0.2s ease, transform 0.2s ease;
        }

        .solid-card:hover {
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* æ•°å­—å­—ä½“ä¼˜åŒ– */
        .font-num {
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: -0.02em;
        }


        /* æ–°å¢ï¼šä»·æ ¼æ›´æ–°æ—¶çš„å¼¹è·³é«˜äº®æ•ˆæœ */
        @keyframes pop-in {
            0% {
                transform: scale(1);
                filter: brightness(1);
            }

            40% {
                transform: scale(1.15);
                filter: brightness(1.5);
            }

            100% {
                transform: scale(1);
                filter: brightness(1);
            }
        }

        .pop-effect {
            animation: pop-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* æ–°å¢ï¼šæ—¶é—´æ›´æ–°é—ªçƒæ•ˆæœ - é»„é‡‘é¡µé‡‘è‰² */
        @keyframes time-flash {

            0%,
            100% {
                color: inherit;
            }

            50% {
                color: var(--accent-light);
            }
        }

        .time-pop {
            animation: time-flash 0.8s ease-out;
        }

        /* åŸºé‡‘é¡µæ—¶é—´é—ªçƒæ•ˆæœ - è“è‰²ç³» */
        @keyframes time-flash-fund {

            0%,
            100% {
                color: inherit;
            }

            50% {
                color: #60a5fa;
            }
        }

        .time-pop-fund {
            animation: time-flash-fund 0.8s ease-out;
        }

        /* Vue è¿‡æ¸¡åŠ¨ç”» */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.5s;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* Modal Animation */
        .modal-enter-active,
        .modal-leave-active {
            transition: all 0.3s ease;
        }

        .modal-enter-from,
        .modal-leave-to {
            opacity: 0;
            transform: scale(0.95);
        }

        .modal-enter-to,
        .modal-leave-from {
            opacity: 1;
            transform: scale(1);
        }

        /* Drawer Animation */
        .drawer-enter-active,
        .drawer-leave-active {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .drawer-enter-from,
        .drawer-leave-to {
            transform: translateX(100%);
        }

        .drawer-enter-to,
        .drawer-leave-from {
            transform: translateX(0);
        }

        /* ç§»é™¤ input type=number çš„é»˜è®¤ä¸Šä¸‹ç®­å¤´ */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
            /* Firefox & Standard */
        }

        .list-enter-active,
        .list-leave-active {
            transition: all 0.4s ease;
        }

        .list-enter-from,
        .list-leave-to {
            opacity: 0;
            transform: scale(0.9);
        }

        .list-move {
            will-change: transform;
            transition: transform 0.4s cubic-bezier(0.55, 0, 0.1, 1);
        }

        /* é¡¶éƒ¨å¯¼èˆªå…‰æ•ˆ */
        @keyframes shimmer {
            0% {
                transform: translateX(-100%) skewX(-15deg);
            }

            100% {
                transform: translateX(200%) skewX(-15deg);
            }
        }

        [v-cloak] {
            display: none;
        }

        /* å…¨å±€å­—ä½“ä¸å¹³æ»‘åº¦ä¼˜åŒ– */
        body {
            -webkit-font-smoothing: subpixel-antialiased;
            -moz-osx-font-smoothing: auto;
            text-rendering: optimizeLegibility;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ä¼˜åŒ– */
        .custom-scrollbar::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.3);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(75, 85, 99, 0.4);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.5);
        }

        /* ==================== å…¨å±€æ»šåŠ¨æ¡æ ·å¼ (æ¥è‡ªé¢„è§ˆé¡µ) ==================== */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-default);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* ==================== æ•°å­—æ»šåŠ¨åŠ¨ç”» ==================== */
        .digit-container {
            overflow: hidden;
            display: inline-block;
            vertical-align: bottom;
            padding: 0 4px;
            margin: 0 -4px;
        }

        .digit-roll {
            display: inline-block;
            animation: digitRoll 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes digitRoll {
            0% { transform: translateY(-120%); opacity: 0; }
            40% { transform: translateY(10%); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* ==================== å¡ç‰‡å…¥åœºåŠ¨ç”»åºåˆ— ==================== */
        .card-enter {
            opacity: 0;
            transform: translateY(30px);
            animation: cardEnter 0.6s ease-out forwards;
        }

        @keyframes cardEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* åŠ¨ç”»å»¶è¿Ÿç±» */
        .delay-0 { animation-delay: 0s; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }

        /* ä¿®å¤ï¼šç¡®ä¿å¤šè¡Œæ–‡æœ¬æˆªæ–­ç”Ÿæ•ˆ */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            overflow: hidden;
        }

        /* ==================== åŸºé‡‘åˆ—è¡¨è§†å›¾æ ·å¼ ==================== */
        .fund-list-view {
            --list-row-bg: rgba(22, 27, 42, 0.6);
            --list-row-hover: rgba(30, 41, 59, 0.8);
            --list-border: rgba(255, 255, 255, 0.04);
            --list-text-muted: rgba(148, 163, 184, 0.6);
        }

        .fund-list-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .fund-list-header {
            background: rgba(17, 24, 39, 0.8);
            border-bottom: 1px solid var(--list-border);
        }

        .fund-list-header th {
            padding: 12px 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--list-text-muted);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            transition: color 0.2s ease;
            text-align: left;
        }

        .fund-list-header th.text-right {
            text-align: right;
        }

        .fund-list-header th.text-center {
            text-align: center;
        }

        .fund-list-header th:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .fund-list-header th.sortable::after {
            content: 'â‡…';
            margin-left: 4px;
            font-size: 10px;
            opacity: 0.4;
        }

        .fund-list-header th.sort-asc::after {
            content: 'â†‘';
            opacity: 1;
            color: #60a5fa;
        }

        .fund-list-header th.sort-desc::after {
            content: 'â†“';
            opacity: 1;
            color: #60a5fa;
        }

        .fund-list-row {
            background: var(--list-row-bg);
            border-bottom: 1px solid var(--list-border);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .fund-list-row:hover {
            background: var(--list-row-hover);
        }

        .fund-list-row td {
            padding: 14px 16px;
            vertical-align: middle;
        }

        .fund-list-row.compact td {
            padding: 10px 16px;
        }

        .fund-list-row.comfortable td {
            padding: 18px 16px;
        }

        /* åˆ—è¡¨è§†å›¾æ“ä½œæŒ‰é’® */
        .fund-list-actions {
            display: flex;
            gap: 8px;
            opacity: 0.6;
            transition: opacity 0.2s ease;
        }

        .fund-list-row:hover .fund-list-actions {
            opacity: 1;
        }

        .fund-list-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
        }

        .fund-list-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .fund-list-btn.primary {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .fund-list-btn.primary:hover {
            background: rgba(59, 130, 246, 0.25);
        }

        .fund-list-btn.danger {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        .fund-list-btn.danger:hover {
            background: rgba(239, 68, 68, 0.25);
        }

        /* ç§»åŠ¨ç«¯åˆ—è¡¨å¡ç‰‡ */
        .fund-list-mobile {
            display: none;
        }

        @media (max-width: 768px) {
            .fund-list-desktop {
                display: none;
            }

            .fund-list-mobile {
                display: block;
            }

            .fund-mobile-card {
                background: var(--list-row-bg);
                border-bottom: 1px solid var(--list-border);
                padding: 12px 16px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .fund-mobile-card:hover {
                background: var(--list-row-hover);
            }
        }

        /* ==================== ç´§å‡‘å‹çŠ¶æ€èƒ¶å›Š - äº¤æ˜“çŠ¶æ€æŒ‡ç¤ºå™¨ ==================== */
        .status-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 9999px;
            cursor: default;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* æå…‰æ‰«è¿‡åŠ¨æ•ˆ */
        .status-pill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.05),
                    transparent);
            transition: none;
        }

        .status-pill.gold-active::before,
        .status-pill.fund-active::before {
            animation: pill-shimmer-enhanced 3s infinite;
        }

        @keyframes pill-shimmer-enhanced {
            0% {
                left: -100%;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                left: 100%;
                opacity: 0;
            }
        }

        /* é‡‘ä»·é¡µ - äº¤æ˜“ä¸­ */
        .status-pill.gold-active {
            animation: pill-breath-gold 3s ease-in-out infinite;
            border-color: rgba(212, 165, 116, 0.3);
        }

        /* é‡‘ä»·é¡µ - å‡æœŸ */
        .status-pill.gold-holiday {
            border-color: rgba(212, 165, 116, 0.25);
            background: rgba(212, 165, 116, 0.03);
        }

        /* åŸºé‡‘é¡µ - äº¤æ˜“ä¸­ */
        .status-pill.fund-active {
            animation: pill-breath-fund 3s ease-in-out infinite;
            border-color: rgba(59, 130, 246, 0.3);
        }

        /* åŸºé‡‘é¡µ - å‡æœŸ */
        .status-pill.fund-holiday {
            border-color: rgba(96, 165, 250, 0.25);
            background: rgba(96, 165, 250, 0.03);
        }

        /* é‡‘ä»·é¡µ - ä¼‘å¸‚ */
        .status-pill.gold-closed {
            border-color: rgba(107, 114, 128, 0.3);
            background: rgba(107, 114, 128, 0.05);
        }

        /* åŸºé‡‘é¡µ - ä¼‘å¸‚ */
        .status-pill.fund-closed {
            border-color: rgba(107, 114, 128, 0.3);
            background: rgba(107, 114, 128, 0.05);
        }

        @keyframes pill-breath-gold {
            0%, 100% {
                box-shadow: 0 0 5px rgba(212, 165, 116, 0), inset 0 0 0 rgba(212, 165, 116, 0);
                background: rgba(212, 165, 116, 0.02);
            }
            50% {
                box-shadow: 0 0 20px rgba(212, 165, 116, 0.2), inset 0 0 8px rgba(212, 165, 116, 0.08);
                background: rgba(212, 165, 116, 0.08);
            }
        }

        @keyframes pill-breath-holiday-gold {
            0%, 100% {
                box-shadow: 0 0 5px rgba(212, 165, 116, 0);
                background: rgba(212, 165, 116, 0.03);
            }
            50% {
                box-shadow: 0 0 15px rgba(212, 165, 116, 0.15);
                background: rgba(212, 165, 116, 0.06);
            }
        }

        @keyframes pill-breath-fund {
            0%, 100% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0), inset 0 0 0 rgba(59, 130, 246, 0);
                background: rgba(59, 130, 246, 0.02);
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.2), inset 0 0 8px rgba(59, 130, 246, 0.08);
                background: rgba(59, 130, 246, 0.08);
            }
        }

        @keyframes pill-breath-holiday-fund {
            0%, 100% {
                box-shadow: 0 0 5px rgba(96, 165, 250, 0);
                background: rgba(96, 165, 250, 0.03);
            }
            50% {
                box-shadow: 0 0 15px rgba(96, 165, 250, 0.15);
                background: rgba(96, 165, 250, 0.06);
            }
        }

        .status-pill:hover {
            background: rgba(255, 255, 255, 0.08) !important;
            border-color: rgba(255, 255, 255, 0.25) !important;
            padding-right: 16px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.05) !important;
        }

        /* æ ‡é¢˜æ–‡å­—å‘¼å¸ */
        .title-breath-active {
            animation: title-glow 3s ease-in-out infinite;
        }

        @keyframes title-glow {

            0%,
            100% {
                text-shadow: 0 0 0 rgba(250, 204, 21, 0);
            }

            50% {
                text-shadow: 0 0 15px rgba(250, 204, 21, 0.3);
            }
        }

        /* å‘¼å¸ç¯æ•ˆæœ */
        .led-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4b5563;
            position: relative;
            flex-shrink: 0;
        }

        /* é‡‘ä»·é¡µ - äº¤æ˜“ä¸­ï¼ˆäº®ç¥ç€é‡‘ï¼‰ */
        .led-dot.active {
            background: #e8c9a0;
            box-shadow: 0 0 10px rgba(232, 201, 160, 0.8), 0 0 20px rgba(212, 165, 116, 0.4);
            animation: led-pulse-enhanced 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* é‡‘ä»·é¡µ - å‡æœŸï¼ˆæ ‡å‡†ç¥ç€é‡‘ï¼‰ */
        .led-dot.holiday {
            background: #d4a574;
            box-shadow: 0 0 10px rgba(212, 165, 116, 0.8), 0 0 20px rgba(212, 165, 116, 0.4);
        }

        /* åŸºé‡‘é¡µ - äº¤æ˜“ä¸­ï¼ˆç§‘æŠ€è“ï¼‰ */
        .led-dot.fund-active {
            background: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8), 0 0 20px rgba(59, 130, 246, 0.4);
            animation: led-pulse-enhanced 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* åŸºé‡‘é¡µ - å‡æœŸï¼ˆæµ…è“ï¼‰ */
        .led-dot.fund-holiday {
            background: #60a5fa;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.8), 0 0 20px rgba(96, 165, 250, 0.4);
        }

        /* é‡‘ä»·é¡µ - ä¼‘å¸‚ï¼ˆç°è‰²ï¼‰ */
        .led-dot.closed {
            background: #6b7280;
        }

        /* åŸºé‡‘é¡µ - ä¼‘å¸‚ï¼ˆç°è‰²ï¼‰ */
        .led-dot.fund-closed {
            background: #6b7280;
        }

        @keyframes led-pulse-enhanced {
            0%, 100% {
                transform: scale(1) translateY(0);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.2) translateY(-1px);
                filter: brightness(1.3);
            }
        }

        .pill-details {
            max-width: 0;
            overflow: hidden;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-pill:hover .pill-details {
            max-width: 250px;
            opacity: 1;
            margin-left: 4px;
        }

        .pill-phase {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        @media (max-width: 768px) {
            .status-pill {
                padding: 4px 8px;
            }

            .pill-details {
                display: none !important;
            }
        }


        @keyframes pulse-breath-live {

            0%,
            100% {
                box-shadow: 0 0 0 rgba(59, 130, 246, 0);
                background: rgba(255, 255, 255, 0.05);
            }

            50% {
                box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
                background: rgba(255, 255, 255, 0.12);
            }
        }

        @keyframes pulse-breath-closed {

            0%,
            100% {
                box-shadow: 0 0 0 rgba(156, 163, 175, 0);
                background: rgba(255, 255, 255, 0.05);
            }

            50% {
                box-shadow: 0 0 15px rgba(156, 163, 175, 0.2);
                background: rgba(255, 255, 255, 0.08);
            }
        }

        .animate-breath-live {
            animation: pulse-breath-live 3s ease-in-out infinite;
        }

        .animate-breath-closed {
            animation: pulse-breath-closed 4s ease-in-out infinite;
        }

        .animate-subtle-float {
            animation: subtle-float 6s ease-in-out infinite;
        }

        @keyframes subtle-float {

            0%,
            100% {
                transform: translateY(0) rotate(45deg);
            }

            50% {
                transform: translateY(-10px) rotate(45deg);
            }
        }

        .animate-number-pulse {
            will-change: transform;
            animation: number-pulse 1s ease-out;
        }

        @keyframes number-pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }

            100% {
                transform: scale(1);
            }
        }

        /* ä»·æ ¼å®¹å™¨å‘¼å¸æ•ˆæœ */
        .price-container-breath {
            will-change: border-color, box-shadow;
            animation: price-container-glow 4s ease-in-out infinite;
        }

        @keyframes price-container-glow {

            0%,
            100% {
                border-color: rgba(255, 255, 255, 0.05);
                box-shadow: 0 0 0 rgba(255, 255, 255, 0);
            }

            50% {
                border-color: rgba(255, 255, 255, 0.15);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.03);
            }
        }

        /* ä»·æ ¼æ–‡å­—å‘¼å¸é€»è¾‘ (ç¡®ä¿å·²åœ¨æ–‡ä»¶ä¸­çš„æ ·å¼è¢«è¦†ç›–æˆ–å¼ºåŒ–) */
        .price-text-breath-up {
            animation: price-glow-up-intense 3s ease-in-out infinite;
        }

        .price-text-breath-down {
            animation: price-glow-down-intense 3s ease-in-out infinite;
        }

        @keyframes price-glow-up-intense {

            0%,
            100% {
                text-shadow: 0 0 0 rgba(239, 68, 68, 0);
            }

            50% {
                text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            }
        }

        @keyframes price-glow-down-intense {

            0%,
            100% {
                text-shadow: 0 0 0 rgba(34, 197, 94, 0);
            }

            50% {
                text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
            }
        }

        /* å…¨å±€å¡ç‰‡æŸ”å’Œå‘¼å¸ */
        @keyframes ambient-card-breath {

            0%,
            100% {
                border-color: rgba(255, 255, 255, 0.05);
                box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.3);
            }

            50% {
                border-color: rgba(255, 255, 255, 0.1);
                box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5);
            }
        }

        .card-ambient-breath {
            will-change: border-color, box-shadow;
            animation: ambient-card-breath 8s ease-in-out infinite;
        }

        /* å½•å…¥æŒ‰é’®é«˜çº§å‘¼å¸ */
        .btn-premium-breath {
            position: relative;
            overflow: hidden;
        }

        .btn-premium-breath:not(:disabled)::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: btn-ripple 4s infinite linear;
            pointer-events: none;
        }

        @keyframes btn-ripple {
            0% {
                transform: translate(-30%, -30%) scale(0.5);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: translate(30%, 30%) scale(1.2);
                opacity: 0;
            }
        }



        /* ç›ˆåˆ©è¿›åº¦æ¡æµåŠ¨å…‰æ•ˆ */
        .profit-bar-shimmer {
            position: relative;
            overflow: hidden;
        }

        .profit-bar-shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent);
            animation: bar-shimmer-run 2.5s infinite linear;
        }

        @keyframes bar-shimmer-run {
            0% {
                left: -100%;
            }

            100% {
                left: 150%;
            }
        }

        /* å®æ—¶çŠ¶æ€è§’æ ‡å‘¼å¸ */
        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 4px;
            color: #ef4444;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .live-dot-pulse {
            width: 5px;
            height: 5px;
            background: #ef4444;
            border-radius: 50%;
            animation: live-ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes live-ping {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            75%,
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }
    </style>
</head>

<body
    class="bg-[#0b0f19] text-gray-200 min-h-screen font-sans selection:bg-blue-500/30 selection:text-blue-200 overflow-x-hidden relative">
    <!-- å…¨å±€èƒŒæ™¯è£…é¥° (å¢å¼ºç¾è§‚åº¦) -->
    <div
        class="fixed top-0 left-1/4 w-[500px] h-[500px] bg-blue-600/5 blur-[120px] rounded-full animate-blob-slow pointer-events-none -z-10">
    </div>
    <div
        class="fixed bottom-0 right-1/4 w-[600px] h-[600px] bg-purple-600/5 blur-[150px] rounded-full animate-blob-delay pointer-events-none -z-10">
    </div>

    {% raw %}
    <div id="app" v-cloak>
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav
            class="fixed top-0 left-0 right-0 z-[60] bg-[#1a1f2e] border-b border-white/5 h-14 flex items-center justify-center gap-1 shadow-xl">
            <button @click="currentView = 'gold'"
                class="px-6 py-1.5 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden group"
                :class="[currentView === 'gold' ? 'bg-[var(--accent-primary)] text-[#0b0f19] shadow-lg shadow-[var(--accent-primary)]/20 nav-shimmer' : 'text-gray-400 hover:text-gray-200 hover:bg-white/5']">
                <span class="relative z-10">é‡‘ä»·ç›‘æ§</span>
            </button>
            <div class="w-px h-4 bg-white/10 mx-2"></div>
            <button @click="currentView = 'fund'"
                class="px-6 py-1.5 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden group"
                :class="[currentView === 'fund' ? 'bg-[#3b82f6] text-white shadow-lg shadow-blue-500/20 nav-shimmer' : 'text-gray-400 hover:text-gray-200 hover:bg-white/5']">
                <span class="relative z-10">åŸºé‡‘ä¼°å€¼</span>
            </button>
        </nav>

        <!-- å…¨å±€è’™å±‚ä¸å¤´éƒ¨ -->
        <!-- åˆå§‹åŠ è½½é®ç½© -->
        <transition name="fade">
            <div v-if="isInitialLoading"
                class="fixed inset-0 z-[100] bg-gray-900 flex flex-col items-center justify-center">
                <div class="w-16 h-16 border-4 border-yellow-500/20 border-t-yellow-500 rounded-full animate-spin mb-4">
                </div>
                <p class="text-yellow-500 font-bold animate-pulse">æ­£åœ¨è¿æ¥æ•°æ®æº...</p>
            </div>
        </transition>

        <!-- ä¸¥é‡é”™è¯¯é®ç½© (ä»…åœ¨å®Œå…¨æ— æ³•è·å–æ•°æ®æ—¶æ˜¾ç¤º) -->
        <transition name="fade">
            <div v-if="fetchError && !isInitialLoading"
                class="fixed inset-0 z-[90] bg-gray-900/95 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center">
                <div class="text-6xl mb-6">ğŸ“¡</div>
                <h2 class="text-2xl font-bold text-white mb-2">æœåŠ¡æš‚æ—¶ä¸å¯ç”¨</h2>
                <p class="text-gray-400 mb-8 max-w-md">{{ fetchError }}ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚</p>
                <button @click="fetchPrice"
                    class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold px-8 py-3 rounded-xl transition-all shadow-lg active:scale-95">
                    æ‰‹åŠ¨é‡è¯•
                </button>
                <p class="mt-4 text-xs text-gray-600">Au99.99 å®æ—¶ç›‘æ§ç³»ç»Ÿ</p>
            </div>
        </transition>

        <!-- é¡¶éƒ¨æ ‡é¢˜æ  (å…¨å±€å›ºå®š) -->
        <header class="fixed top-14 left-0 right-0 z-50 bg-[#0b0f19] border-b border-white/5 py-4 px-6 shadow-sm">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex-1 flex items-center gap-3">
                    <div class="flex flex-col">
                        <h1 class="text-xl font-extrabold tracking-tight hidden sm:block"
                            :class="currentView === 'gold' ? 'text-[var(--accent-primary)]' : 'text-blue-500'">
                            {{ currentView === 'gold' ? 'Au99.99' : 'åŸºé‡‘ä¼°å€¼' }}
                        </h1>
                        <h1 class="text-lg font-extrabold sm:hidden"
                            :class="currentView === 'gold' ? 'text-[var(--accent-primary)]' : 'text-blue-500'">
                            {{ currentView === 'gold' ? 'Au99.99' : 'åŸºé‡‘' }}
                        </h1>
                        <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest mt-0.5">
                            {{ currentView === 'gold' ? (currentData.source || 'SGE') + 'è¡Œæƒ…æ•°æ®' : 'å®æ—¶ä¼°å€¼ç›‘æ§' }}
                        </p>
                    </div>

                    <!-- ç´§å‡‘å‹çŠ¶æ€èƒ¶å›Š (é»„é‡‘) -->
                    <div v-if="currentView === 'gold'" class="status-pill ml-2"
                        :class="{ 'gold-active': tradingStatus.is_trading_time, 'gold-holiday': tradingStatus.is_holiday, 'gold-closed': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }"
                        :title="tradingStatus.phase_name + (tradingStatus.time_until_next ? ' | ' + formatCountdown(tradingStatus.time_until_next, tradingStatus.next_event_time) + tradingStatus.next_event_name : '')">
                        <div class="led-dot"
                            :class="{ 'active': tradingStatus.is_trading_time, 'holiday': tradingStatus.is_holiday, 'closed': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }">
                        </div>
                        <span class="pill-phase"
                            :class="{ 'text-amber-400': tradingStatus.is_trading_time, 'text-amber-300': tradingStatus.is_holiday, 'text-gray-400': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }">{{
                            tradingStatus.phase_name }}</span>
                        <div class="pill-details">
                            <span class="w-px h-2.5 bg-white/10"></span>
                            <span class="text-[10px]">{{ tradingStatus.weekday_name }}</span>
                            <template v-if="tradingStatus.time_until_next">
                                <span class="w-px h-2.5 bg-white/10"></span>
                                <span class="font-mono">
                                    <template v-if="tradingStatus.is_holiday && getHolidayName()">
                                        {{ getHolidayName() }} Â· {{ formatCountdown(tradingStatus.time_until_next, tradingStatus.next_event_time) }}å¼€
                                    </template>
                                    <template v-else>
                                        {{ formatCountdown(tradingStatus.time_until_next, tradingStatus.next_event_time) }}{{ tradingStatus.next_event_name }}
                                    </template>
                                </span>
                            </template>
                        </div>
                    </div>

                    <!-- ç´§å‡‘å‹çŠ¶æ€èƒ¶å›Š (åŸºé‡‘) -->
                    <div v-if="currentView === 'fund'" class="status-pill ml-2"
                        :class="{ 'fund-active': fundTradingStatus.is_trading_time, 'fund-holiday': fundTradingStatus.is_holiday, 'fund-closed': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }"
                        :title="fundTradingStatus.phase_name">
                        <div class="led-dot"
                            :class="{ 'fund-active': fundTradingStatus.is_trading_time, 'fund-holiday': fundTradingStatus.is_holiday, 'fund-closed': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }">
                        </div>
                        <span class="pill-phase"
                            :class="{ 'text-blue-400': fundTradingStatus.is_trading_time, 'text-[#60a5fa]': fundTradingStatus.is_holiday, 'text-gray-400': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }">{{
                            fundTradingStatus.phase_name }}</span>
                        <div class="pill-details">
                            <span class="w-px h-2.5 bg-white/10"></span>
                            <span class="text-[10px]">{{ fundTradingStatus.weekday_name }}</span>
                            <template v-if="fundTradingStatus.time_until_next">
                                <span class="w-px h-2.5 bg-white/10"></span>
                                <span class="font-mono">
                                    <template v-if="fundTradingStatus.is_holiday && getHolidayName()">
                                        {{ getHolidayName() }} Â· {{ formatCountdown(fundTradingStatus.time_until_next, fundTradingStatus.next_event_time) }}å¼€
                                    </template>
                                    <template v-else>
                                        {{ formatCountdown(fundTradingStatus.time_until_next, fundTradingStatus.next_event_time) }}{{ fundTradingStatus.next_event_name }}
                                    </template>
                                </span>
                            </template>
                        </div>
                    </div>

                    <!-- äº¤æ˜“çŠ¶æ€æé†’å¼€å…³ -->
                    <button @click="settings.trading_events_enabled = !settings.trading_events_enabled; saveSettings()"
                        class="p-2 rounded-full transition-all duration-300 ml-1 flex items-center justify-center"
                        :class="[
                            settings.trading_events_enabled 
                                ? (currentView === 'gold' ? 'text-[var(--accent-light)] bg-[var(--accent-primary)]/10 hover:bg-[var(--accent-primary)]/20' : 'text-blue-400 bg-blue-400/10 hover:bg-blue-400/20') 
                                : 'text-gray-500 bg-gray-800/50 hover:bg-gray-800'
                        ]" :title="settings.trading_events_enabled ? 'çŠ¶æ€æé†’å·²å¼€å¯' : 'çŠ¶æ€æé†’å·²ç¦ç”¨'">
                        <!-- çº¿æ€§ç²¾è‡´å›¾æ ‡ (å¼€å¯çŠ¶æ€) -->
                        <svg v-if="settings.trading_events_enabled" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                        </svg>
                        <!-- çº¿æ€§ç²¾è‡´å›¾æ ‡ (ç¦ç”¨çŠ¶æ€) - ä½¿ç”¨ MASK æŠ€æœ¯å®ç°å®Œç¾çš„â€œç ´æŸâ€åˆ‡å‰²æ•ˆæœï¼Œæ›´ç²¾è‡´ -->
                        <svg v-else xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.6" stroke="currentColor" class="w-5 h-5 opacity-40">
                            <defs>
                                <mask id="bell-off-mask">
                                    <rect width="24" height="24" fill="white" />
                                    <!-- é»‘è‰²çº¿æ¡åœ¨ Mask ä¸­ä»£è¡¨â€œå‰ªæ‰â€ï¼Œstroke-width ç•¥å¤§ä»¥åˆ›é€ ç²¾è‡´çš„é—´éš™ -->
                                    <path d="M3 3l18 18" stroke="black" stroke-width="3" stroke-linecap="round" />
                                </mask>
                            </defs>
                            <g mask="url(#bell-off-mask)">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                            </g>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3l18 18" />
                        </svg>
                    </button>
                </div>

                <div class="flex-1 flex justify-center items-center">
                    <!-- é‡‘ä»·æ˜¾ç¤º (é»„é‡‘è§†è§’) -->
                    <div v-if="currentView === 'gold'"
                        class="bg-black/20 px-4 py-1.5 rounded-xl border border-white/5 price-container-breath flex items-center gap-3 hw-accel"
                        :class="{'pop-effect': priceAnimating}">
                        <span class="digit-container">
                            <span class="text-2xl font-black font-mono tracking-tighter transition-colors duration-300"
                                :class="[
                                    isPriceUp ? 'text-red-500' : 'text-green-500',
                                    { 'digit-roll': priceAnimating }
                                ]">
                                {{ formatPrice(currentData.price) }}
                            </span>
                        </span>
                        <span class="text-xs font-black font-mono px-2 py-0.5 rounded bg-white/5"
                            :class="isPriceUp ? 'text-red-400 price-text-breath-up' : 'text-green-400 price-text-breath-down'">
                            {{ currentData.change >= 0 ? '+' : '' }}{{ currentData.change }}
                        </span>
                    </div>

                    <!-- ç›ˆäºæ‘˜è¦ (åŸºé‡‘è§†è§’) -->
                    <div v-if="currentView === 'fund'"
                        class="bg-black/20 px-4 py-1.5 rounded-xl border border-white/5 flex items-center gap-4 hw-accel">
                        <div class="flex flex-col items-center">
                            <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">é¢„ä¼°ä»Šæ—¥æ”¶ç›Š</span>
                            <span class="digit-container">
                                <span class="text-lg font-black font-mono"
                                    :class="[(holdingsSummary.total_today_profit || 0) >= 0 ? 'text-red-500' : 'text-green-500', { 'digit-roll': fundPriceAnimating }]">
                                    {{ (holdingsSummary.total_today_profit || 0) >= 0 ? '+' : '' }}{{
                                    (holdingsSummary.total_today_profit || 0).toFixed(0) }}
                                </span>
                            </span>
                        </div>
                        <div class="w-px h-8 bg-white/10"></div>
                        <div class="flex flex-col items-center">
                            <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">æ€»ç›ˆäº</span>
                            <span class="digit-container">
                                <span class="text-lg font-black font-mono"
                                    :class="[holdingsSummary.total_profit >= 0 ? 'text-red-500' : 'text-green-500', { 'digit-roll': fundPriceAnimating }]">
                                    {{ holdingsSummary.total_profit >= 0 ? '+' : '' }}{{
                                    holdingsSummary.total_profit.toFixed(0) }}
                                </span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="flex-1 text-right">
                    <p
                        class="text-gray-600 text-[10px] uppercase font-bold tracking-widest leading-none mb-1 hidden sm:block">
                        {{ currentView === 'gold' ? 'æ›´æ–°æ—¶é—´' : 'æœ€ååŠ¨æ€' }}</p>
                    <p class="text-sm sm:text-lg font-mono font-bold text-gray-400"
                        :class="{'time-pop': currentView === 'gold' && timeAnimating, 'time-pop-fund': currentView === 'fund' && fundTimeAnimating}">
                        {{ currentView === 'gold' ? (currentData.time_str || '--:--:--') : holdingsLastUpdate }}
                    </p>
                </div>
            </div>
        </header>

        <!-- é¡µé¢çŠ¶æ€æŒ‡ç¤ºå™¨ (å…¨å±€) -->
        <div
            class="fixed bottom-4 right-4 flex items-center gap-2 bg-gray-800 px-4 py-2 rounded-full shadow-lg border border-gray-700 z-50">
            <span class="w-3 h-3 rounded-full transition-colors duration-300"
                :class="[isConnected ? 'bg-green-500 animate-pulse' : 'bg-red-500']"></span>
            <span class="text-sm font-medium">{{ isConnected ? 'å®æ—¶ç›‘æ§ä¸­' : 'è¿æ¥ä¸­æ–­' }}</span>
        </div>

        <!-- é‡‘ä»·è§†å›¾å†…å®¹ -->
        <div v-if="currentView === 'gold'" class="pt-32">
            <main class="max-w-7xl mx-auto p-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <!-- å·¦ä¾§ï¼šå®æ—¶ä»·æ ¼é¢æ¿ -->
                    <div class="lg:col-span-1 space-y-6">

                        <!-- ç²˜æ€§ä»·æ ¼å®¹å™¨ (ä¿®æ­£åç§»é‡ä»¥å®ç°å¯¹é½) - å…¥åœºåŠ¨ç”» -->
                        <div class="lg:sticky lg:top-28 space-y-6"
                            :class="{'card-enter delay-0': isFirstLoad && !cardsAnimated}">
                            <!-- å½“å‰ä»·æ ¼å¡ç‰‡ -->
                            <div class="rounded-2xl p-6 transition-all duration-500 solid-card card-ambient-breath shadow-2xl relative overflow-hidden"
                                :class="[isPriceUp ? 'border-red-500/20 bg-gradient-to-br from-red-500/5 to-transparent' : 'border-green-500/20 bg-gradient-to-br from-green-500/5 to-transparent', {'pop-effect': priceAnimating}]">
                                <p
                                    class="text-gray-500 text-[10px] font-black uppercase tracking-widest mb-2 opacity-80">
                                    Au99.99 å®æ—¶æˆäº¤ä»· (å…ƒ/å…‹)</p>
                                <div class="flex items-baseline gap-3">
                                    <span class="digit-container">
                                        <span
                                            class="text-5xl font-black font-mono tracking-tighter transition-transform duration-300"
                                            :class="[
                                                isPriceUp ? 'text-red-500' : 'text-green-500',
                                                { 'digit-roll': priceAnimating }
                                            ]">
                                            {{ formatPrice(currentData.price) }}
                                        </span>
                                    </span>
                                    <span class="text-xl font-black font-mono"
                                        :class="isPriceUp ? 'text-red-400 price-text-breath-up' : 'text-green-400 price-text-breath-down'">
                                        {{ currentData.change >= 0 ? '+' : '' }}{{ currentData.change }}
                                    </span>
                                    <!-- Source Badge -->
                                    <span v-if="currentData.source"
                                        class="text-[9px] px-1.5 py-0.5 rounded bg-white/5 border border-white/5 font-bold uppercase text-gray-500 ml-auto self-start mt-2"
                                        :title="'æ•°æ®æ¥æº: ' + currentData.source">
                                        {{ currentData.source }}
                                    </span>
                                </div>
                                <div class="mt-6 grid grid-cols-2 gap-x-6 gap-y-4 text-sm text-gray-400">
                                    <div class="flex justify-between items-end border-b border-white/[0.03] pb-1">
                                        <p class="text-[10px] font-bold uppercase text-gray-600">ä»Šå¼€</p>
                                        <p class="font-mono font-bold">{{ formatPrice(currentData.open) }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b border-white/[0.03] pb-1">
                                        <p class="text-[10px] font-bold uppercase text-gray-600">æ˜¨æ”¶</p>
                                        <p class="font-mono font-bold text-gray-500">{{
                                            formatPrice(currentData.yesterday_close) }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b border-white/[0.03] pb-1">
                                        <p class="text-[10px] font-bold uppercase text-gray-600">æœ€é«˜</p>
                                        <p class="font-mono font-bold text-red-500/80">{{ formatPrice(currentData.high)
                                            }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b border-white/[0.03] pb-1">
                                        <p class="text-[10px] font-bold uppercase text-gray-600">æœ€ä½</p>
                                        <p class="font-mono font-bold text-green-500/80">{{ formatPrice(currentData.low)
                                            }}</p>
                                    </div>
                                </div>

                                <!-- æ–°å¢ï¼šå½“æ—¥æ³¢åŠ¨æ‘˜è¦ -->
                                <div v-if="currentData.volatility"
                                    class="mt-4 pt-4 border-t border-white/10 grid grid-cols-2 gap-4 text-sm text-gray-200 opacity-90">
                                    <div class="col-span-2 flex justify-between items-center mb-1">
                                        <span class="text-xs font-bold text-yellow-400/80">å½“æ—¥æ³¢åŠ¨æ‘˜è¦</span>
                                        <span class="text-[10px] opacity-40">åŸºäº {{ currentData.count }} æ¡æ ·æœ¬</span>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">å½“æ—¥æœ€é«˜</p>
                                        <p class="font-mono">{{ formatPrice(currentData.high_24h) }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">å½“æ—¥æœ€ä½</p>
                                        <p class="font-mono">{{ formatPrice(currentData.low_24h) }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">å½“æ—¥æŒ¯å¹…</p>
                                        <p class="font-mono text-yellow-300">{{ currentData.volatility }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">å½“æ—¥å‡ä»·</p>
                                        <p class="font-mono">{{ formatPrice(currentData.avg_24h) }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ä¹°å…¥ä»·æ ¼è®¾ç½® (delay-2) -->
                            <div class="bg-[#161b2a] rounded-2xl p-6 shadow-xl border border-white/5"
                                :class="{'card-enter delay-2': isFirstLoad && !cardsAnimated}">
                                <h3
                                    class="text-sm font-black mb-4 text-gray-200 uppercase tracking-widest flex items-center gap-2">
                                    <span class="w-1 h-3 bg-yellow-500 rounded-full"></span>
                                    æˆ‘çš„ä¹°å…¥æˆæœ¬
                                </h3>
                                <div class="grid grid-cols-5 gap-2">
                                    <!-- ä¹°å…¥ä»·æ ¼ (å 3ä»½) -->
                                    <div class="col-span-3 flex">
                                        <input type="number" v-model.number="buyPrice" @focus="handleInputFocus($event)"
                                            @blur="handleInputBlur"
                                            class="w-full bg-gray-700 border border-gray-600 rounded-l-lg px-4 py-3 text-xl font-mono focus:outline-none focus:border-[var(--accent-primary)] transition-colors"
                                            placeholder="ä¹°å…¥ä»·" step="0.01">
                                        <button @click="resetToCurrent"
                                            class="bg-gray-600 hover:bg-gray-500 text-gray-300 px-3 py-3 rounded-r-lg transition border-l border-gray-500"
                                            title="é‡ç½®ä¸ºå½“å‰ä»·æ ¼">
                                            â†º
                                        </button>
                                    </div>

                                    <!-- ä¹°å…¥å…‹æ•° (å 2ä»½) -->
                                    <div class="col-span-2 relative">
                                        <input type="number" v-model.number="buyWeight"
                                            @focus="handleInputFocus($event)"
                                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-xl font-mono focus:outline-none focus:border-[var(--accent-primary)] transition-colors text-right pr-8"
                                            placeholder="å…‹æ•°" step="1">
                                        <span
                                            class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm pointer-events-none">g</span>
                                    </div>
                                </div>
                                <p class="text-gray-500 text-sm mt-2 flex justify-between">
                                    <span>* æ‰‹ç»­è´¹ç‡: 0.5%</span>
                                    <span v-if="buyPrice > 0" class="text-yellow-500/80">
                                        æŒä»“: {{ buyWeight > 0 ? buyWeight : '--' }}g @ {{ buyPrice.toFixed(2) }}
                                    </span>
                                    <span v-else class="text-gray-600">æœªè®¾ç½®</span>
                                </p>
                                
                                <!-- åˆ†éš”çº¿ -->
                                <hr class="border-white/10 my-4">
                                
                                <!-- è®°å½•æŒ‰é’® -->
                                <button @click="recordPrice" :disabled="!(buyPrice > 0)"
                                    class="w-full font-bold py-3 rounded-xl transition shadow-lg btn-premium-breath flex justify-center items-center gap-2 text-sm"
                                    :class="buyPrice > 0 ? 'bg-[var(--accent-primary)] hover:bg-[var(--accent-light)] text-black hover:shadow-[var(--accent-primary)]/30' : 'bg-gray-700 text-gray-500 cursor-not-allowed'">
                                    <span>è®°å½•å½“å‰ä»·æ ¼</span>
                                    <span v-if="isRecording" class="animate-spin">â³</span>
                                </button>
                            </div>

                            <!-- å½“å‰ç›ˆäºçŠ¶æ€ (delay-3) -->
                            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700 transition-opacity duration-300"
                                :class="[{'opacity-40 grayscale': !(buyPrice > 0)}, {'card-enter delay-3': isFirstLoad && !cardsAnimated}]">
                                <h3 class="text-lg font-semibold mb-4">å½“å‰ç›ˆäºçŠ¶æ€</h3>
                                <div class="text-center py-4">
                                    <p class="text-gray-400 text-sm">è‹¥ç°åœ¨å–å‡º (æ‰£é™¤æ‰‹ç»­è´¹å)</p>
                                    <p class="text-4xl font-bold font-mono my-2"
                                        :class="currentProfit.rate >= 0 ? 'text-red-500' : 'text-green-500'">
                                        {{ buyPrice > 0 ? (currentProfit.rate >= 0 ? '+' : '') + currentProfit.rate +
                                        '%' : '--%' }}
                                    </p>
                                    <p class="text-gray-500 text-sm font-mono">
                                        {{ buyWeight > 0 ? 'æ€»ç›ˆäº' : 'æ¯å…‹ç›ˆäº' }}:
                                        <span class="text-lg font-bold"
                                            :class="currentProfit.amount >= 0 ? 'text-red-400' : 'text-green-400'">
                                            {{ buyPrice > 0 ? (currentProfit.amount >= 0 ? '+' : '') +
                                            currentProfit.amount + ' å…ƒ' : '-- å…ƒ' }}
                                        </span>
                                    </p>
                                </div>
                                <!-- ç›ˆåˆ©è¿›åº¦æ¡ -->
                                <div class="mt-4 relative pt-6">
                                    <div class="flex justify-between text-xs text-gray-500 mb-1 absolute top-0 w-full">
                                        <span style="left: 0%">-10%</span>
                                        <span style="left: 33.3%">0%</span>
                                        <span style="right: 0">+20%</span>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded-full overflow-hidden relative">
                                        <!-- 0ç‚¹å‚è€ƒçº¿ -->
                                        <div class="absolute h-full w-0.5 bg-gray-600 left-1/3 z-10"></div>
                                        <div class="h-full transition-all duration-500 relative"
                                            :style="buyPrice > 0 ? profitBarStyle : {width: '0%', left: '33.3%'}"
                                            :class="currentProfit.rate >= 0 ? 'bg-red-500' : 'bg-green-500'">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šå›¾è¡¨å’Œç›®æ ‡ -->
                    <div class="lg:col-span-2 space-y-6">

                        <!-- ä»·æ ¼èµ°åŠ¿å›¾ (delay-1) -->
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700"
                            :class="{'card-enter delay-1': isFirstLoad && !cardsAnimated}">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                                <div class="flex items-center gap-4">
                                    <h3 class="text-lg font-semibold">ä»·æ ¼èµ°åŠ¿</h3>
                                    <div class="flex bg-gray-900/50 p-1 rounded-lg border border-gray-700">
                                        <button @click="setChartViewMode('30M')"
                                            class="px-3 py-1 text-xs rounded-md transition-all"
                                            :class="chartViewMode === '30M' ? 'bg-[var(--accent-primary)] text-black font-bold shadow-lg' : 'text-gray-400 hover:text-gray-200'">
                                            30åˆ†é’Ÿ
                                        </button>
                                        <button @click="setChartViewMode('1D')"
                                            class="px-3 py-1 text-xs rounded-md transition-all"
                                            :class="chartViewMode === '1D' ? 'bg-[var(--accent-primary)] text-black font-bold shadow-lg' : 'text-gray-400 hover:text-gray-200'">
                                            å½“æ—¥
                                        </button>
                                    </div>
                                </div>
                                <span class="text-gray-500 text-[10px] sm:text-xs flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
                                    {{ chartViewMode === '30M' ? 'å®æ—¶åŸå§‹æ•°æ®' : 'æ¯5ç§’æ›´æ–°' }}
                                </span>
                            </div>
                            <div class="h-64 relative">
                                <canvas id="priceChart" ref="priceChart" class="transition-opacity duration-300"
                                    :class="chartSwitching ? 'opacity-0' : 'opacity-100'"></canvas>
                            </div>
                        </div>

                        <!-- ä»·æ ¼é¢„è­¦è®¾ç½® (delay-4) -->
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700"
                            :class="{'card-enter delay-4': isFirstLoad && !cardsAnimated}">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-[var(--accent-primary)]">ä»·æ ¼é¢„è­¦ (æµè§ˆå™¨é€šçŸ¥)</h3>
                                <div class="flex items-center gap-3">
                                    <button @click="resetAlertsToDefault"
                                        class="text-[10px] text-gray-500 hover:text-yellow-500 border border-gray-700 px-2 py-1 rounded transition">
                                        é‡ç½®ä¸º Â±3%
                                    </button>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" v-model="settings.enabled" @change="saveSettings"
                                            class="sr-only peer">
                                        <div
                                            class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500">
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 block mb-1">é‡‘ä»·é«˜äº (å…ƒ/å…‹)</label>
                                    <input type="number" v-model.number="settings.high" @blur="saveSettings"
                                        class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[var(--accent-primary)]"
                                        placeholder="0.00" step="0.01">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500 block mb-1">é‡‘ä»·ä½äº (å…ƒ/å…‹)</label>
                                    <input type="number" v-model.number="settings.low" @blur="saveSettings"
                                        class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[var(--accent-primary)]"
                                        placeholder="0.00" step="0.01">
                                </div>
                            </div>
                            <p class="text-[10px] text-gray-500 mt-3 italic">* å¼€å¯åè¯·ç¡®ä¿å…è®¸æµè§ˆå™¨é€šçŸ¥ã€‚è§¦å‘åå°†è¿›å…¥ 5 åˆ†é’Ÿå†·å´æœŸã€‚</p>
                        </div>

                        <!-- å¤šç›®æ ‡ç›ˆåˆ©è®¡ç®—è¡¨ (delay-5) -->
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700 transition-opacity duration-300"
                            :class="[{'opacity-40 grayscale': !(buyPrice > 0)}, {'card-enter delay-5': isFirstLoad && !cardsAnimated}]">
                            <h3 class="text-lg font-semibold mb-4 text-[var(--accent-primary)]">ç›®æ ‡å–å‡ºä»·æ ¼</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="text-gray-400 text-sm border-b border-gray-700">
                                            <th class="text-left py-3">ç›®æ ‡ç›ˆåˆ©</th>
                                            <th class="text-right py-3">{{ buyWeight > 0 ? 'æ€»ç›ˆåˆ©' : 'æ¯å…‹ç›ˆåˆ©' }}</th>
                                            <th class="text-right py-3">éœ€æ¶¨è‡³</th>
                                            <th class="text-right py-3">å®é™…æ¶¨å¹…</th>
                                            <th class="text-right py-3">è·ç›®æ ‡</th>
                                            <th class="text-right py-3">çŠ¶æ€</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template v-if="buyPrice > 0">
                                            <tr v-for="target in targetTable" :key="target.percent"
                                                class="border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors"
                                                :class="{'bg-red-900/20': target.reached}">
                                                <td class="py-4">
                                                    <span class="font-bold"
                                                        :class="target.reached ? 'text-red-400' : 'text-yellow-400'">
                                                        +{{ target.percent }}%
                                                    </span>
                                                </td>
                                                <td class="text-right py-4 font-mono text-blue-400">
                                                    {{ target.profitAmount }} å…ƒ
                                                </td>
                                                <td class="text-right py-4 font-mono text-lg">{{ target.sellPrice }}
                                                </td>
                                                <td class="text-right py-4 text-gray-400 font-mono">+{{
                                                    target.requiredGain }}%</td>
                                                <td class="text-right py-4 font-mono">
                                                    <span v-if="target.reached"
                                                        class="text-red-400 font-bold">å·²è¾¾æˆ</span>
                                                    <span v-else class="text-gray-400">{{ target.progress }}%</span>
                                                </td>
                                                <td class="text-right py-4">
                                                    <span v-if="target.reached"
                                                        class="px-2 py-1 bg-red-600/20 text-red-400 rounded text-xs border border-red-600/50">
                                                        å¯å–å‡º
                                                    </span>
                                                    <span v-else
                                                        class="px-2 py-1 bg-gray-700 text-gray-400 rounded text-xs">
                                                        ç­‰å¾…ä¸­
                                                    </span>
                                                </td>
                                            </tr>
                                        </template>
                                        <tr v-else>
                                            <td colspan="5" class="py-12 text-center text-gray-500 italic">
                                                è¯·è¾“å…¥ä¹°å…¥æˆæœ¬ä»¥è®¡ç®—ç›®æ ‡
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- å†å²è®°å½• (delay-5) -->
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700"
                            :class="{'card-enter delay-5': isFirstLoad && !cardsAnimated}">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">ä»·æ ¼è®°å½•</h3>
                                <div class="flex gap-2">
                                    <button @click="exportCSV"
                                        class="text-blue-400 hover:text-blue-300 text-sm px-3 py-1 hover:bg-blue-900/20 rounded transition">
                                        å¯¼å‡ºè®°å½•
                                    </button>
                                    <button @click="exportHistoryCSV"
                                        class="text-yellow-400 hover:text-yellow-300 text-sm px-3 py-1 hover:bg-yellow-900/20 rounded transition">
                                        å¯¼å‡ºå½“æ—¥å†å²
                                    </button>
                                    <button @click="clearRecords"
                                        class="text-red-400 hover:text-red-300 text-sm px-3 py-1 hover:bg-red-900/20 rounded transition">
                                        æ¸…ç©ºè®°å½•
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-2 max-h-64 overflow-y-auto pr-2 custom-scrollbar">
                                <div v-if="records.length === 0"
                                    class="text-gray-500 text-center py-8 bg-gray-700/20 rounded-lg">
                                    æš‚æ— è®°å½•
                                </div>
                                <transition-group name="fade">
                                    <div v-for="(record, index) in reversedRecords" :key="index"
                                        class="flex justify-between items-center bg-gray-700/30 hover:bg-gray-700/50 rounded-lg p-3 border border-gray-700/50 transition-colors">
                                        <div>
                                            <span class="font-mono text-lg text-yellow-100">{{ formatPrice(record.price)
                                                }}</span>
                                            <span class="text-gray-500 text-sm ml-2 font-mono">{{ record.time_str
                                                }}</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="font-mono font-bold"
                                                :class="parseFloat(record.profit) >= 0 ? 'text-red-400' : 'text-green-400'">
                                                {{ parseFloat(record.profit) >= 0 ? '+' : '' }}{{ record.profit }}%
                                            </span>
                                        </div>
                                    </div>
                                </transition-group>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ç›¸å…³ (å·²ç§»è‡³é¡¶éƒ¨) -->
        </div>

        <!-- åŸºé‡‘è§†å›¾å†…å®¹ -->
        <div v-if="currentView === 'fund'" class="pt-32 max-w-7xl mx-auto min-h-screen">


            <div class="px-4 pt-4">
                <!-- æˆ‘çš„æŒä»“å¡ç‰‡ (é‡æ„å¸ƒå±€ä¸èƒŒæ™¯) -->
                <div
                    class="mb-8 bg-[#161b2a]/60 backdrop-blur-2xl rounded-3xl border border-white/5 shadow-2xl overflow-hidden">
                    <!-- æ ‡é¢˜æ ï¼šå“åº”å¼æ¢è¡Œå¤„ç† -->
                    <div
                        class="px-6 py-5 border-b border-white/5 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div class="flex items-center gap-4">

                            <div>
                                <h2 class="text-xl font-bold text-gray-100 tracking-tight">æˆ‘çš„æŒä»“</h2>
                                <div class="flex items-center gap-2 mt-0.5">
                                    <span v-if="holdingsSummary.count > 0"
                                        class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded-md font-bold uppercase tracking-wider">
                                        {{ holdingsSummary.count }} åªåŸºé‡‘
                                    </span>
                                    <span class="text-[10px] text-gray-500 font-medium tracking-tight">{{
                                        holdingsLastUpdate }}</span>
                                </div>
                            </div>
                            <div class="w-px h-8 bg-white/10 mx-2"></div>

                        </div>

                        <!-- æ“ä½œåŒº -->
                        <div
                            class="flex items-center gap-2 self-end sm:self-auto px-1.5 py-1.5 rounded-2xl bg-black/30 border border-white/5 shadow-inner">
                            <button @click="openAddHoldingModal()"
                                class="group flex items-center gap-2 text-[12px] bg-blue-500/15 hover:bg-blue-500/25 text-blue-300 px-4 py-2 rounded-xl font-black transition-all border border-blue-400/20 active:scale-95"
                                title="æ·»åŠ æŒä»“">
                                <span class="text-[14px] transition-transform duration-300 group-hover:scale-125">+</span>
                                <span>æ·»åŠ </span>
                            </button>
                            <button @click="fetchHoldings" :disabled="isLoadingHoldings"
                                class="group flex items-center gap-2 text-[12px] bg-white/5 hover:bg-white/10 text-gray-300 px-4 py-2 rounded-xl font-black transition-all border border-white/5 active:scale-95"
                                :class="{'opacity-50 cursor-not-allowed': isLoadingHoldings}" title="åˆ·æ–°æ•°æ®">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" class="w-4 h-4 transition-transform duration-500"
                                    :class="isLoadingHoldings ? 'animate-spin' : 'group-hover:rotate-180'">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                                <span>åˆ·æ–°</span>
                            </button>
                        </div>
                    </div>

                    <!-- æ±‡æ€»ä¿¡æ¯é¢æ¿ (ç¡®ä¿ Grid ç‹¬ç«‹) -->
                    <div v-if="holdingsSummary.count > 0"
                        class="px-6 py-6 grid grid-cols-2 xl:grid-cols-5 gap-4 bg-gradient-to-b from-transparent to-black/10 border-b border-white/5 relative overflow-hidden">
                        <!-- èƒŒæ™¯å…‰æ™• -->
                        <div
                            class="absolute -right-16 -top-16 w-32 h-32 bg-blue-500/10 blur-[60px] pointer-events-none rotate-45 animate-subtle-float">
                        </div>
                        <div class="absolute -left-20 -bottom-20 w-40 h-40 bg-purple-500/5 blur-[80px] pointer-events-none animate-subtle-float"
                            style="animation-delay: -3s;">
                        </div>

                        <div
                            class="flex flex-col justify-center px-3 py-3 rounded-lg bg-black/10 border border-white/5 hover:bg-black/20 hover:border-blue-500/30 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 cursor-default">
                            <span class="text-[10px] uppercase tracking-[0.2em] text-gray-600 mb-1">èµ„äº§æˆæœ¬</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="text-xl font-bold font-mono text-gray-300 tracking-tighter">{{
                                    holdingsSummary.total_cost.toFixed(0) }}</span>
                                <span class="text-[9px] text-gray-700 font-bold font-mono">CNY</span>
                            </div>
                        </div>

                        <div
                            class="flex flex-col justify-center px-3 py-3 rounded-lg bg-black/10 border border-white/5 hover:bg-black/20 hover:border-blue-500/30 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 cursor-default">
                            <span class="text-[10px] uppercase tracking-[0.2em] text-gray-600 mb-1">å½“å‰å¸‚å€¼</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="text-xl font-bold font-mono text-blue-400 tracking-tighter">{{
                                    holdingsSummary.total_value.toFixed(0) }}</span>
                                <span class="text-[9px] text-blue-900 font-bold font-mono uppercase">CNY</span>
                            </div>
                        </div>

                        <!-- é¢„ä¼°ä»Šæ—¥æ”¶ç›Š -->
                        <div
                            class="flex flex-col justify-center px-3 py-3 rounded-lg bg-black/10 border border-white/5 hover:bg-black/20 hover:border-blue-500/30 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 cursor-default">
                            <span class="text-[10px] uppercase tracking-[0.2em] text-gray-600 mb-1">é¢„ä¼°ä»Šæ—¥æ”¶ç›Š</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[
                                            (holdingsSummary.total_today_profit || totalTodayProfit) >= 0 ? 'text-red-500' : 'text-green-500',
                                            holdingsPulse.todayProfit ? 'animate-number-pulse' : '',
                                            { 'digit-roll': fundPriceAnimating }
                                        ]">
                                        {{ (holdingsSummary.total_today_profit || totalTodayProfit) >= 0 ? '+' : '' }}{{
                                        (holdingsSummary.total_today_profit || totalTodayProfit).toFixed(0) }}
                                    </span>
                                </span>
                            </div>
                        </div>

                        <!-- ç´¯è®¡ç›ˆäº (å¸¦èƒŒæ™¯è‰²å—å¼ºè°ƒè®¾è®¡) -->
                        <div
                            class="flex flex-col justify-center px-3 py-3 rounded-lg bg-black/10 border border-white/5 hover:bg-black/20 hover:border-blue-500/30 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 cursor-default">
                            <span class="text-[10px] uppercase tracking-[0.2em] text-gray-600 mb-1">é¢„æœŸæ”¶ç›Š</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[
                                            holdingsSummary.total_profit >= 0 ? 'text-red-500' : 'text-green-500',
                                            holdingsPulse.totalProfit ? 'animate-number-pulse' : '',
                                            { 'digit-roll': fundPriceAnimating }
                                        ]">
                                        {{ holdingsSummary.total_profit >= 0 ? '+' : '' }}{{
                                        holdingsSummary.total_profit.toFixed(0) }}
                                    </span>
                                </span>
                            </div>
                        </div>

                        <!-- æ€»æ”¶ç›Šç‡ (å¼ºè°ƒè®¾è®¡) -->
                        <div
                            class="flex flex-col justify-center px-3 py-3 rounded-lg bg-black/10 border border-white/5 hover:bg-black/20 hover:border-blue-500/30 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 cursor-default">
                            <span class="text-[10px] uppercase tracking-[0.2em] text-gray-600 mb-1">æŠ•èµ„å›æŠ¥</span>
                            <div class="flex items-baseline gap-1">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[
                                            holdingsSummary.total_profit_rate >= 0 ? 'text-red-500' : 'text-green-500',
                                            holdingsPulse.profitRate ? 'animate-number-pulse' : '',
                                            { 'digit-roll': fundPriceAnimating }
                                        ]">
                                        {{ holdingsSummary.total_profit_rate >= 0 ? '+' : '' }}{{
                                        holdingsSummary.total_profit_rate.toFixed(2) }}<span
                                            class="text-xs ml-0.5 opacity-60">%</span>
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- æŒä»“åˆ—è¡¨ -->
                    <div ref="holdingsListRef" :class="[
                        'px-6 overflow-hidden duration-500 ease-in-out',
                        holdingsListTransitionEnabled ? 'transition-all' : '',
                        isHoldingsListCollapsed ? 'py-0 opacity-0' : 'py-8 opacity-100'
                    ]" :style="{ maxHeight: isHoldingsListCollapsed ? '0px' : holdingsListHeight + 'px' }">
                        <div v-if="isLoadingHoldings" class="text-center py-8 text-gray-500">
                            <span class="animate-spin inline-block mr-2 text-2xl">â³</span>
                            <p class="text-sm">æ­£åœ¨åŠ è½½æŒä»“æ•°æ®...</p>
                        </div>
                        <div v-else-if="holdings.length === 0"
                            class="group relative flex flex-col items-center justify-center py-16 px-4 bg-white/[0.01] border-2 border-dashed border-white/5 rounded-3xl mx-5 transition-all hover:bg-white/[0.02] hover:border-blue-500/20">
                            <div
                                class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mb-4 ring-8 ring-blue-500/[0.02] group-hover:scale-110 transition-transform duration-500">
                                <span class="text-3xl">ğŸ“¥</span>
                            </div>
                            <h3 class="text-gray-300 font-bold text-base mb-1">å¼€å§‹ç®¡ç†æ‚¨çš„æŠ•èµ„</h3>
                            <p class="text-gray-600 text-[11px] mb-6 text-center max-w-[200px] leading-relaxed">
                                å½•å…¥æ‚¨çš„æŒä»“æˆæœ¬ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è®¡ç®—ç›ˆäºï¼ŒåŠ©æ‚¨åšå‡ºæ˜æ™ºå†³ç­–ã€‚
                            </p>
                            <button @click="openAddHoldingModal()"
                                class="bg-blue-600 hover:bg-blue-500 text-white text-xs font-black px-6 py-2.5 rounded-full shadow-lg shadow-blue-600/20 transition-all active:scale-95 flex items-center gap-2">
                                <span>+ å½•å…¥ç¬¬ä¸€ç¬”æŒä»“</span>
                            </button>

                            <!-- è£…é¥°å…ƒç´  -->
                            <div class="absolute inset-0 overflow-hidden pointer-events-none opacity-20">
                                <div
                                    class="absolute -right-4 -bottom-4 text-4xl transform rotate-12 filter grayscale opacity-20">
                                    ğŸ“Š</div>
                            </div>
                        </div>
                        <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6">
                            <div v-for="h in holdings" :key="h.code" @click="toggleHoldings(h)"
                                class="group relative bg-[#1c2230]/60 backdrop-blur-xl rounded-2xl border border-white/5 hover:border-blue-500/30 hover:shadow-[0_20px_40px_rgba(0,0,0,0.3)] transition-all duration-300 cursor-pointer overflow-hidden flex flex-col min-h-[180px]"
                                :class="[
                                h.animating && h.changeType === 'up' ? 'animate-flash-up' : '',
                                h.animating && h.changeType === 'down' ? 'animate-flash-down' : ''
                             ]">

                                <!-- ç›ˆäºçŠ¶æ€ä¾§è¾¹æ¡ -->
                                <div class="absolute left-0 top-0 bottom-0 w-1"
                                    :class="h.profit_rate >= 0 ? 'bg-gradient-to-b from-red-500/80 to-red-500/20' : 'bg-gradient-to-b from-green-500/80 to-green-500/20'">
                                </div>

                                <div class="p-4 flex-1 flex flex-col justify-between">
                                    <!-- é¡¶éƒ¨ï¼šåç§°ä¸ä»£ç  -->
                                    <div class="flex justify-between items-start gap-2">
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-black text-gray-100 whitespace-normal line-clamp-2 text-[13px] tracking-tight mb-0.5 group-hover:text-blue-300 transition-colors"
                                                :title="h.name">{{ h.name }}</h4>
                                            <div class="flex items-center gap-1.5">
                                                <span
                                                    class="text-[10px] bg-white/5 text-gray-500 px-1.5 py-0.5 rounded font-mono border border-white/5 uppercase">{{
                                                    h.code }}</span>
                                                <span v-if="!h.data_available"
                                                    class="text-[9px] text-yellow-500 border border-yellow-500/20 px-1 rounded animate-pulse">ç¦»çº¿</span>
                                            </div>
                                        </div>
                                        <!-- ä»Šæ—¥æ¶¨è·Œ -->
                                        <div class="shrink-0 text-right">
                                            <div class="px-2 py-1 rounded-lg text-[11px] font-black font-mono shadow-sm transition-all duration-300 flex items-center justify-end"
                                                :class="[
                                                h.change >= 0 ? 'text-red-400 bg-red-400/5 ring-1 ring-red-400/20' : 'text-green-400 bg-green-400/5 ring-1 ring-green-400/20',
                                                h.animating ? 'pop-effect' : ''
                                             ]">
                                                <span>{{ h.change >= 0 ? '+' : '' }}{{ h.change }}%</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ä¸­éƒ¨ï¼šç›ˆäºæ ¸å¿ƒæ•°æ® -->
                                    <div class="flex items-center justify-between py-2">
                                        <div class="flex flex-col">
                                            <div
                                                class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-0.5 opacity-60">
                                                æŒæœ‰æ”¶ç›Šç‡</div>
                                            <div class="flex items-baseline gap-1.5">
                                                <span class="text-2xl font-black font-mono tracking-tighter"
                                                    :class="h.profit_rate >= 0 ? 'text-red-500' : 'text-green-500'">
                                                    {{ (h.profit_rate >= 0 ? '+' : '') + h.profit_rate.toFixed(2)
                                                    }}<span class="text-xs ml-0.5">%</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <div
                                                class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-0.5 opacity-60 text-right">
                                                ä»Šæ—¥é¢„ä¼°ç›ˆäº</div>
                                            <span class="text-lg font-black font-mono"
                                                :class="h.today_profit >= 0 ? 'text-red-400' : 'text-green-400'">
                                                {{ (h.today_profit >= 0 ? '+' : '') + (h.today_profit !== undefined ?
                                                h.today_profit.toFixed(2) : '0.00') }}
                                            </span>
                                        </div>
                                    </div>

                                    <!-- åº•éƒ¨ï¼šèµ„äº§æ˜ç»† -->
                                    <div class="grid grid-cols-3 gap-2 pt-3 border-t border-white/[0.03] text-[10px]">
                                        <div class="flex flex-col">
                                            <span class="text-gray-600 font-medium mb-0.5">æŒä»½</span>
                                            <span class="font-bold font-mono text-gray-400">{{ h.shares }}</span>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-gray-600 font-medium mb-0.5">æˆæœ¬ä»·</span>
                                            <span class="font-bold font-mono text-gray-400">{{ h.cost_price }}</span>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <span class="text-gray-600 font-medium mb-0.5">å½“å‰å¸‚å€¼</span>
                                            <span class="font-black font-mono text-blue-400/90 text-[11px]">{{
                                                h.market_value.toFixed(0) }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- åº•éƒ¨ç²¾ç®€æ“ä½œæ¡ (Slide-up) -->
                                <div
                                    class="absolute bottom-0 left-0 right-0 h-9 bg-gray-900/95 backdrop-blur-md border-t border-white/5 flex items-stretch translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out z-10">
                                    <!-- è¯¦æƒ… -->
                                    <button @click.stop="toggleHoldings(h)"
                                        class="flex-1 flex items-center justify-center gap-2 hover:bg-blue-500/10 transition-all text-gray-400 hover:text-blue-400 border-r border-white/5 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2.5" stroke="currentColor" class="w-3.5 h-3.5">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                        </svg>
                                        <span class="text-[10px] font-bold tracking-wider">é‡ä»“è‚¡</span>
                                    </button>

                                    <!-- æ“ä½œ -->
                                    <div class="flex-[1.5] flex items-stretch">
                                        <button @click.stop="openEditHoldingModal(h)"
                                            class="flex-1 flex items-center justify-center gap-1.5 hover:bg-yellow-500/10 transition-all text-gray-500 hover:text-yellow-500 border-r border-white/5 group/btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="2" stroke="currentColor"
                                                class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                            </svg>
                                            <span class="text-[10px] font-bold">ç¼–è¾‘</span>
                                        </button>
                                        <button @click.stop="deleteHolding(h.code)"
                                            class="flex-1 flex items-center justify-center gap-1.5 hover:bg-red-500/10 transition-all text-gray-600 hover:text-red-400 group/btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="2" stroke="currentColor"
                                                class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                            <span class="text-[10px] font-bold">åˆ é™¤</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- æ”¶èµ·/å±•å¼€æŒ‰é’®æ  -->
                    <div v-if="holdings.length > 0 && !isLoadingHoldings"
                        class="border-t border-white/5 bg-black/20 hover:bg-black/30 transition-colors">
                        <button @click="isHoldingsListCollapsed = !isHoldingsListCollapsed"
                            class="w-full py-3 flex items-center justify-center text-gray-400 hover:text-gray-200 transition-colors group">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" class="w-6 h-6 transition-transform duration-300"
                                :class="isHoldingsListCollapsed ? 'rotate-0' : 'rotate-180'">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="px-4 pt-4">
                    <!-- è‡ªé€‰åŸºé‡‘åˆ—è¡¨æ ‡é¢˜ -->
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6 px-1">
                        <div class="flex items-center gap-3">
                            <h3 class="text-xl font-bold text-gray-200">è‡ªé€‰åŸºé‡‘</h3>
                            <span v-if="funds.length > 0"
                                class="text-xs bg-gray-800 text-gray-400 px-2 py-0.5 rounded-full border border-gray-700">
                                {{ filteredFunds.length }}/{{ funds.length }}
                            </span>
                        </div>

                        <div class="flex flex-wrap items-center gap-3">
                            <!-- æ·»åŠ åŸºé‡‘ (é›†æˆåˆ°å·¥å…·æ ) -->
                            <div
                                class="relative group flex items-center bg-gray-800 rounded-lg border border-gray-700 p-0.5 focus-within:border-blue-500/50 focus-within:ring-1 focus-within:ring-blue-500/50 transition-all shadow-sm">
                                <input type="text" v-model="newFundCode" @keyup.enter="addFund" placeholder="æ·»åŠ åŸºé‡‘ä»£ç "
                                    class="w-28 focus:w-36 bg-transparent border-none text-xs text-center text-gray-200 px-2 py-1.5 focus:outline-none placeholder-gray-500 transition-all font-mono">
                                <button @click="addFund" :disabled="isAddingFund"
                                    class="bg-blue-600 hover:bg-blue-500 text-white px-2.5 py-1 rounded-md text-xs font-bold transition-all disabled:opacity-50 active:scale-95 shadow-sm border border-white/10"
                                    title="æ·»åŠ ">
                                    <span v-if="isAddingFund" class="animate-spin inline-block">â³</span>
                                    <span v-else>+</span>
                                </button>
                            </div>

                            <!-- åˆ—è¡¨æ¨¡å¼è¡Œé«˜åˆ‡æ¢ï¼ˆä»…åˆ—è¡¨æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                            <div v-if="fundDisplayMode === 'list'" class="flex bg-gray-800 p-1 rounded-lg border border-gray-700">
                                <button @click="fundRowHeight = 'compact'"
                                    class="px-2.5 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundRowHeight === 'compact' ? 'bg-indigo-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                    title="ç´§å‡‘è¡Œé«˜">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h17.25M3 9h17.25M3 13.5h17.25" />
                                    </svg>
                                </button>
                                <button @click="fundRowHeight = 'comfortable'"
                                    class="px-2.5 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundRowHeight === 'comfortable' ? 'bg-indigo-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                    title="èˆ’é€‚è¡Œé«˜">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h17.25M3 12h17.25M3 19.5h17.25" />
                                    </svg>
                                </button>
                            </div>

                            <!-- å±•ç¤ºæ¨¡å¼åˆ‡æ¢ -->
                            <div class="flex bg-gray-800 p-1 rounded-lg border border-gray-700">
                                <button @click="setFundDisplayMode('card')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium flex items-center gap-1.5"
                                    :class="fundDisplayMode === 'card' ? 'bg-slate-600 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                    title="å¡ç‰‡è§†å›¾">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                                    </svg>
                                    <span class="hidden sm:inline">å¡ç‰‡</span>
                                </button>
                                <button @click="setFundDisplayMode('list')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium flex items-center gap-1.5"
                                    :class="fundDisplayMode === 'list' ? 'bg-slate-600 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                    title="åˆ—è¡¨è§†å›¾">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                                    </svg>
                                    <span class="hidden sm:inline">åˆ—è¡¨</span>
                                </button>
                            </div>

                            <!-- æ’åºæ§åˆ¶ -->
                            <div class="flex bg-gray-800 p-1 rounded-lg border border-gray-700">
                                <button @click="setLegacyFundSortMode('default')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="(fundSortMode === 'default' && fundSortField === 'default') ? 'bg-blue-600 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'">
                                    é»˜è®¤
                                </button>
                                <button @click="setLegacyFundSortMode('gain')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundSortMode === 'gain' ? 'bg-red-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'">
                                    æ¶¨å¹…
                                </button>
                                <button @click="setLegacyFundSortMode('loss')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundSortMode === 'loss' ? 'bg-green-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'">
                                    è·Œå¹…
                                </button>
                            </div>

                            <!-- å®æ—¶è¿‡æ»¤å™¨ -->
                            <div v-if="funds.length > 0" class="relative group">
                                <input type="text" v-model="fundFilterText" placeholder="æœç´¢åŸºé‡‘å/ä»£ç ..."
                                    class="bg-gray-800/80 border border-gray-700 rounded-lg px-3 py-1.5 pl-8 text-sm focus:outline-none focus:border-blue-500/50 transition-all w-full sm:w-56 placeholder-gray-600 group-hover:bg-gray-800">
                                <span
                                    class="absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-600 text-xs transition-colors group-focus-within:text-blue-400">ğŸ”</span>
                            </div>
                        </div>
                    </div>

                    <!-- åŸºé‡‘åˆ—è¡¨ (é«˜å¯†åº¦å“åº”å¼ç½‘æ ¼) -->
                    <div class="pb-24">
                        <div v-if="funds.length === 0" class="text-center py-20 text-gray-500">
                            <div class="text-6xl mb-4 opacity-20">ğŸ“¡</div>
                            <p>æš‚æ— è‡ªé€‰ï¼Œè¯·è¾“å…¥ä»£ç æ·»åŠ </p>
                        </div>

                        <!-- å¡ç‰‡è§†å›¾ -->
                        <transition-group v-if="fundDisplayMode === 'card'" name="list" tag="div"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3">
                            <div v-for="fund in filteredFunds" :key="fund.code" @click="toggleHoldings(fund)"
                                class="bg-gray-800 rounded-xl p-3 border transition-all hover:bg-gray-750 hover:border-blue-500/50 hover:shadow-[0_0_15px_rgba(59,130,246,0.2)] hover:scale-[1.02] group relative overflow-hidden cursor-pointer flex flex-col h-full"
                                :class="[
                                fund.change > 0 ? 'border-red-500/10 bg-red-500/[0.02]' : (fund.change < 0 ? 'border-green-500/10 bg-green-500/[0.02]' : 'border-gray-700/50'),
                                fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '',
                                fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : ''
                             ]">

                                <!-- S013: æ ¸å¿ƒä¿¡æ¯åŒº (é«˜å¯†åº¦å¸ƒå±€) -->
                                <div class="flex-1 space-y-2">
                                    <!-- ç¬¬ä¸€æ®µï¼šå¤´éƒ¨æ ‡è¯† (æ›´ç´§å‡‘) -->
                                    <div class="flex justify-between items-start gap-1">
                                        <div class="flex items-center gap-1.5 min-w-0 flex-1">
                                            <h3 class="font-bold text-sm text-white whitespace-normal line-clamp-2 leading-tight"
                                                :title="fund.name">{{ fund.name }}</h3>
                                            <span
                                                class="text-[10px] bg-gray-900/50 text-gray-500 px-1 py-0.5 rounded font-mono shrink-0">{{
                                                fund.code }}</span>
                                        </div>
                                    </div>

                                    <!-- ç¬¬äºŒæ®µï¼šå…³é”®æŒ‡æ ‡ (å±…ä¸­å¼ºè°ƒæ¶¨è·Œ) -->
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-baseline gap-1">
                                            <span
                                                class="text-2xl font-black font-mono tracking-tighter transition-all duration-300 flex items-center"
                                                :class="[
                                                fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'),
                                                fund.animating ? 'pop-effect' : ''
                                             ]">
                                                {{ (fund.change > 0 ? '+' : '') + fund.change }}%
                                                <span
                                                    class="text-lg w-5 text-center inline-block transition-all duration-300 transform"
                                                    :class="fund.animating ? 'opacity-100 scale-125' : 'opacity-0 scale-50 overflow-hidden w-0'">
                                                    {{ fund.changeType === 'up' ? 'â†‘' : 'â†“' }}
                                                </span>
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <p
                                                class="text-[10px] text-gray-500 font-mono uppercase leading-none mb-0.5">
                                                å‡€å€¼</p>
                                            <span class="text-sm font-bold text-gray-300 font-mono transition-transform"
                                                :class="fund.animating ? 'scale-110' : ''">{{ fund.price }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬ä¸‰æ®µï¼šçŠ¶æ€è„šéƒ¨ (æ˜¾ç¤ºæ ¸å¿ƒæ—¶é—´ä¸æŒä»“çŠ¶æ€) -->
                                <div class="mt-2 flex justify-between items-end">
                                    <span
                                        class="text-[10px] text-gray-600 font-mono opacity-60 group-hover:opacity-100 transition-opacity">{{
                                        fund.time_str }}</span>
                                    <div class="flex items-center gap-2">
                                        <!-- æŒä»“æ ‡ç­¾ (å¸¸é©»é«˜äº®) -->
                                        <div v-if="isFundInHoldings(fund.code)"
                                            class="flex items-center gap-1 bg-blue-500/10 text-blue-400 border border-blue-500/20 px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">
                                            å·²æŒä»“
                                        </div>
                                    </div>
                                </div>

                                <!-- åº•éƒ¨æ‚¬æµ®åŠ¨ä½œæ¡ (Slide-up) -->
                                <div
                                    class="absolute bottom-0 left-0 right-0 h-11 lg:h-9 bg-gray-900/98 backdrop-blur-md border-t border-blue-500/30 flex items-stretch translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out z-10">
                                    <!-- å±•å¼€é‡ä»“è‚¡ -->
                                    <button @click.stop="toggleHoldings(fund)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-blue-500/10 transition-colors text-gray-400 hover:text-blue-400 border-r border-gray-700/50 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">é‡ä»“è‚¡</span>
                                    </button>

                                    <!-- åŠ æŒä»“ -->
                                    <button @click.stop="addFundToHoldings(fund)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-green-500/10 transition-colors text-gray-400 hover:text-green-400 border-r border-gray-700/50 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">å…¥æŒä»“</span>
                                    </button>

                                    <!-- ç§»é™¤ -->
                                    <button @click.stop="deleteFund(fund.code)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-red-500/10 transition-colors text-gray-500 hover:text-red-400 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">ç§»é™¤</span>
                                    </button>
                                </div>
                            </div>
                        </transition-group>

                        <!-- åˆ—è¡¨è§†å›¾ (æ¡Œé¢ç«¯è¡¨æ ¼) -->
                        <div v-else class="fund-list-view fund-list-desktop rounded-xl overflow-hidden border border-gray-700/50">
                            <table class="fund-list-table">
                                <thead class="fund-list-header">
                                    <tr>
                                        <th class="sortable" :class="getSortClass('name')" @click="toggleSort('name')">åŸºé‡‘åç§°</th>
                                        <th class="sortable text-right" :class="getSortClass('change')" @click="toggleSort('change')">æ¶¨è·Œå¹…</th>
                                        <th class="sortable text-right" :class="getSortClass('price')" @click="toggleSort('price')">å‡€å€¼</th>
                                        <th class="text-right">æ›´æ–°æ—¶é—´</th>
                                        <th class="text-center">çŠ¶æ€</th>
                                        <th class="text-right">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="fund in filteredFunds" :key="fund.code"
                                        @click="toggleHoldings(fund)"
                                        class="fund-list-row"
                                        :class="[
                                            fundRowHeight,
                                            fund.change > 0 ? 'up' : (fund.change < 0 ? 'down' : ''),
                                            fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '',
                                            fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : ''
                                        ]">
                                        <td>
                                            <div class="flex flex-col">
                                                <span class="font-bold text-sm text-white">{{ fund.name }}</span>
                                                <span class="text-[10px] text-gray-500 font-mono">{{ fund.code }}</span>
                                            </div>
                                        </td>
                                        <td class="text-right">
                                            <span class="text-lg font-black font-mono"
                                                :class="[
                                                    fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'),
                                                    fund.animating ? 'pop-effect' : ''
                                                ]">
                                                {{ (fund.change > 0 ? '+' : '') + fund.change }}%
                                            </span>
                                        </td>
                                        <td class="text-right">
                                            <span class="text-base font-bold text-gray-300 font-mono">{{ fund.price }}</span>
                                        </td>
                                        <td class="text-right">
                                            <span class="text-[11px] text-gray-500 font-mono">{{ fund.time_str }}</span>
                                        </td>
                                        <td class="text-center">
                                            <span v-if="isFundInHoldings(fund.code)"
                                                class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20">
                                                å·²æŒä»“
                                            </span>
                                        </td>
                                        <td>
                                            <div class="fund-list-actions justify-end">
                                                <button @click.stop="toggleHoldings(fund)" class="fund-list-btn primary">
                                                    é‡ä»“è‚¡
                                                </button>
                                                <button @click.stop="addFundToHoldings(fund)" class="fund-list-btn">
                                                    å…¥æŒä»“
                                                </button>
                                                <button @click.stop="deleteFund(fund.code)" class="fund-list-btn danger">
                                                    ç§»é™¤
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- åˆ—è¡¨è§†å›¾ (ç§»åŠ¨ç«¯å¡ç‰‡) -->
                        <div v-if="fundDisplayMode === 'list'" class="fund-list-mobile">
                            <div v-for="fund in filteredFunds" :key="fund.code"
                                @click="toggleHoldings(fund)"
                                class="fund-mobile-card"
                                :class="[
                                    fund.change > 0 ? 'up' : (fund.change < 0 ? 'down' : ''),
                                    fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '',
                                    fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : ''
                                ]">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex flex-col min-w-0 flex-1">
                                        <span class="font-bold text-sm text-white">{{ fund.name }}</span>
                                        <span class="text-[10px] text-gray-500 font-mono">{{ fund.code }}</span>
                                    </div>
                                    <span class="text-xl font-black font-mono"
                                        :class="[
                                            fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'),
                                            fund.animating ? 'pop-effect' : ''
                                        ]">
                                        {{ (fund.change > 0 ? '+' : '') + fund.change }}%
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <span class="text-sm font-bold text-gray-300 font-mono">{{ fund.price }}</span>
                                        <span class="text-[10px] text-gray-500 font-mono">{{ fund.time_str }}</span>
                                        <span v-if="isFundInHoldings(fund.code)"
                                            class="inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20">
                                            å·²æŒä»“
                                        </span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click.stop="toggleHoldings(fund)" class="fund-list-btn primary py-1 px-2 text-[10px]">
                                            é‡ä»“
                                        </button>
                                        <button @click.stop="deleteFund(fund.code)" class="fund-list-btn danger py-1 px-2 text-[10px]">
                                            ç§»é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åº•éƒ¨æç¤º (ç°åœ¨éšåˆ—è¡¨æ»šåŠ¨) -->
                        <div v-if="funds.length > 0" class="mt-8 mb-12 text-center">
                            <span
                                class="bg-gray-800/50 px-4 py-1.5 rounded-full text-xs text-gray-500 border border-gray-700/50 font-medium">
                                å®æ—¶ä¼°å€¼ï¼Œçº¦ 3 ç§’åˆ·æ–°
                            </span>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- End of Fund View -->
        <!-- è‡ªå®šä¹‰æ¨¡æ€æ¡† (Modal) -->
        <transition name="modal">
            <div v-if="modal.visible" class="fixed inset-0 z-[100] flex items-center justify-center px-4"
                @keydown.esc="closeModal(false)">
                <!-- é®ç½©å±‚ -->
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
                    @click="closeModal(false)"></div>

                <!-- å¼¹çª—ä¸»ä½“ -->
                <div
                    class="relative bg-gray-800 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md p-6 transform transition-all">
                    <h3 class="text-xl font-bold mb-4 text-white">{{ modal.title }}</h3>

                    <!-- Prompt æ¨¡å¼ä¸‹çš„è¾“å…¥æ¡† -->
                    <div v-if="modal.type === 'prompt'" class="mb-6">
                        <input ref="modalInput" v-model="modal.inputValue" @keyup.enter="closeModal(true)" type="text"
                            class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-yellow-500 transition-colors placeholder-gray-500"
                            :placeholder="modal.placeholder">
                    </div>

                    <!-- Confirm æ¨¡å¼ä¸‹çš„æç¤ºæ–‡æœ¬ -->
                    <div v-if="modal.type === 'confirm'" class="mb-6 text-gray-300">
                        {{ modal.message }}
                    </div>

                    <!-- æŒ‰é’®ç»„ -->
                    <div class="flex justify-end gap-3">
                        <button @click="closeModal(false)"
                            class="px-5 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600 transition-colors font-medium">
                            å–æ¶ˆ
                        </button>
                        <button @click="closeModal(true)"
                            class="px-5 py-2 rounded-lg font-bold transition-colors shadow-lg"
                            :class="modal.confirmButtonClass || 'bg-blue-600 hover:bg-blue-500 text-white'">
                            {{ modal.confirmText || 'ç¡®å®š' }}
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- æŒä»“ç¼–è¾‘æ¨¡æ€æ¡† -->
        <transition name="modal">
            <div v-if="holdingModal.visible" class="fixed inset-0 z-[100] flex items-center justify-center px-4">
                <!-- é®ç½©å±‚ -->
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
                    @click="closeHoldingModal()"></div>

                <!-- å¼¹çª—ä¸»ä½“ -->
                <div
                    class="relative bg-[#161b2a] rounded-2xl shadow-2xl border border-white/10 w-full max-w-md p-6 transform transition-all">
                    <h3 class="text-xl font-black mb-4 text-gray-100 uppercase tracking-tight flex items-center gap-2">
                        <span class="w-1.5 h-4 bg-blue-500 rounded-full"></span>
                        {{ holdingModal.isEdit ? 'ç¼–è¾‘æŒä»“' : 'æ·»åŠ æŒä»“' }}
                    </h3>

                    <div class="space-y-4">
                        <!-- åŸºé‡‘ä»£ç  -->
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">åŸºé‡‘ä»£ç </label>
                            <input type="text" v-model="holdingModal.code" :disabled="holdingModal.isEdit" maxlength="6"
                                class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-500 font-mono"
                                :class="{'opacity-50 cursor-not-allowed': holdingModal.isEdit}" placeholder="6ä½åŸºé‡‘ä»£ç ">
                        </div>

                        <!-- æˆæœ¬ä»· -->
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">æˆæœ¬ä»· (å…ƒ)</label>
                            <input type="number" v-model.number="holdingModal.costPrice" step="0.0001"
                                class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-500 font-mono"
                                placeholder="å¦‚ 1.2345">
                        </div>

                        <!-- æŒæœ‰ä»½é¢ -->
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">æŒæœ‰ä»½é¢</label>
                            <input type="number" v-model.number="holdingModal.shares" step="0.01"
                                class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-500 font-mono"
                                placeholder="å¦‚ 1000">
                        </div>

                        <!-- å¤‡æ³¨ -->
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">å¤‡æ³¨ (å¯é€‰)</label>
                            <input type="text" v-model="holdingModal.note"
                                class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-500"
                                placeholder="å¯é€‰å¤‡æ³¨ä¿¡æ¯">
                        </div>
                    </div>

                    <!-- æŒ‰é’®ç»„ -->
                    <div class="flex justify-end gap-3 mt-6">
                        <button @click="closeHoldingModal()"
                            class="px-5 py-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600 transition-colors font-medium">
                            å–æ¶ˆ
                        </button>
                        <button @click="saveHolding()" :disabled="holdingModal.saving"
                            class="px-5 py-2 rounded-lg font-bold transition-colors shadow-lg bg-blue-600 hover:bg-blue-500 text-white disabled:bg-gray-600 disabled:cursor-not-allowed">
                            {{ holdingModal.saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- é‡ä»“è‚¡è¯¦æƒ…æŠ½å±‰ -->
        <div v-if="portfolioDrawer.visible" class="fixed inset-0 z-[110] overflow-hidden">
            <!-- é®ç½©å±‚ -->
            <transition name="fade" appear>
                <div v-if="portfolioDrawer.visible"
                    class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
                    @click="closePortfolioDrawer()"></div>
            </transition>

            <!-- æŠ½å±‰ä¸»ä½“ -->
            <transition name="drawer" appear>
                <div v-if="portfolioDrawer.visible"
                    class="absolute right-0 top-0 h-full w-full max-w-md bg-[#161b2a] shadow-2xl flex flex-col border-l border-white/10">
                    <!-- æŠ½å±‰å¤´éƒ¨ -->
                    <div class="p-6 border-b border-gray-700 flex items-center justify-between bg-gray-800/80">
                        <div>
                            <h3 class="text-xl font-bold text-white">{{ portfolioDrawer.fundName }}</h3>
                            <p class="text-xs text-gray-400 font-mono mt-1 font-medium tracking-tight">{{
                                portfolioDrawer.fundCode }} â€¢ å‰åå¤§é‡ä»“è‚¡è¯¦æƒ…</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <!-- å¼ºåˆ¶åˆ·æ–°æŒ‰é’® -->
                            <button
                                @click="toggleHoldings({code: portfolioDrawer.fundCode, name: portfolioDrawer.fundName}, true)"
                                :disabled="portfolioDrawer.loading"
                                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-blue-500/10 text-gray-400 hover:text-blue-400 transition-all group/ref"
                                title="åˆ·æ–°æŒä»“æ„æˆ">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor"
                                    class="w-5 h-5 transition-transform group-hover/ref:rotate-180 duration-500"
                                    :class="{'animate-spin': portfolioDrawer.loading}">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                            </button>
                            <button @click="closePortfolioDrawer()"
                                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" class="w-6 h-6 text-gray-400">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- æŠ½å±‰å†…å®¹ -->
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                        <div v-if="portfolioDrawer.loading"
                            class="flex flex-col items-center justify-center h-64 text-gray-400">
                            <span class="animate-spin text-4xl mb-4 text-blue-500">â³</span>
                            <p class="font-medium">æ­£åœ¨æ‹‰å–å®æ—¶è¡Œæƒ…...</p>
                        </div>
                        <div v-else-if="portfolioDrawer.holdings && portfolioDrawer.holdings.length > 0"
                            class="space-y-4">
                            <!-- æ”¶ç›Šè´¡çŒ®æ±‡æ€» -->
                            <div class="bg-gray-900/60 rounded-2xl p-5 border border-blue-500/20 shadow-inner">
                                <div class="flex justify-between items-center mb-2">
                                    <span
                                        class="text-xs text-gray-300 font-bold uppercase tracking-wider">å‰åå¤§é‡ä»“è´¡çŒ®é¢„ä¼°</span>
                                    <span
                                        class="text-xs bg-blue-500/10 text-blue-300 px-1.5 py-0.5 rounded border border-blue-500/20 scale-90">å®æ—¶ä¼°ç®—</span>
                                </div>
                                <div class="text-4xl font-bold font-mono tracking-tighter"
                                    :class="portfolioContribution.available ? (portfolioContribution.value >= 0 ? 'text-red-400' : 'text-green-400') : 'text-gray-400'">
                                    <template v-if="portfolioContribution.available">
                                        {{ portfolioContribution.value >= 0 ? '+' : '' }}{{
                                        portfolioContribution.value.toFixed(3) }}<span class="text-lg ml-0.5">%</span>
                                    </template>
                                    <template v-else>--</template>
                                </div>
                                <div class="mt-3 text-xs text-gray-400 flex items-center gap-1 font-medium">
                                    <span class="opacity-70">æ•°æ®æˆªæ­¢:</span>
                                    <span class="text-gray-300 italic">{{ portfolioDrawer.meta.report_period ||
                                        portfolioDrawer.holdings[0]?.report_period || '--' }} å­£åº¦æŠ¥å‘ŠæœŸ</span>
                                </div>
                                <div class="mt-2 text-xs text-gray-400 flex items-center justify-between font-medium">
                                    <span>æƒé‡è¦†ç›–: <span class="text-gray-200 font-mono">{{
                                            portfolioDrawer.meta.weight_coverage !== undefined ?
                                            portfolioDrawer.meta.weight_coverage.toFixed(2) + '%' : '--'
                                            }}</span></span>
                                    <span>ç½®ä¿¡åº¦: <span class="text-gray-200">{{ portfolioDrawer.meta.confidence_label
                                            || '--' }}</span></span>
                                </div>
                                <p v-if="portfolioDrawer.meta.estimate_mode === 'equal_weight'"
                                    class="mt-2 text-xs text-yellow-300/80">
                                    å·²ä½¿ç”¨ç­‰æƒä¼°ç®—ï¼Œç»“æœä»…ä¾›å‚è€ƒ
                                </p>
                                <p v-else-if="!portfolioDrawer.meta.contribution_available"
                                    class="mt-2 text-xs text-yellow-300/80">
                                    æƒé‡å æ¯”ç¼ºå¤±ï¼Œè´¡çŒ®æš‚ä¸å¯ä¼°ç®—
                                </p>
                                <p v-if="portfolioDrawer.meta.estimate_mode === 'cached_stale'"
                                    class="mt-1 text-xs text-orange-300/80">
                                    ä½¿ç”¨è¿‡æœŸç¼“å­˜æƒé‡ä¼°ç®—ï¼Œè¯·æ³¨æ„æ—¶æ•ˆ
                                </p>
                                <p v-if="portfolioDrawer.meta.parse_error" class="mt-1 text-xs text-orange-300/80">
                                    è§£ææç¤ºï¼š{{ portfolioDrawer.meta.parse_error }}
                                </p>
                            </div>

                            <!-- è‚¡ç¥¨åˆ—è¡¨ -->
                            <div class="space-y-3 pb-8">
                                <div v-for="(stock, idx) in portfolioDrawer.holdings" :key="stock.code"
                                    class="bg-gray-750/40 rounded-xl p-4 border border-gray-700/50 hover:bg-gray-700/60 hover:border-blue-500/50 hover:shadow-[0_0_15px_rgba(59,130,246,0.15)] transition-all group">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2">
                                                <span class="text-xs text-gray-500 font-mono w-5 font-bold">{{ (idx
                                                    + 1).toString().padStart(2, '0') }}</span>
                                                <h4 class="font-bold text-white truncate text-base leading-tight">{{
                                                    stock.name }}</h4>
                                            </div>
                                            <div class="text-xs text-gray-400 font-mono mt-1 opacity-80">{{
                                                stock.code }}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-lg font-bold font-mono leading-none"
                                                :class="stock.change_percent >= 0 ? 'text-red-400' : 'text-green-400'">
                                                {{ stock.change_percent >= 0 ? '+' : '' }}{{
                                                stock.change_percent.toFixed(2) }}%
                                            </div>
                                            <div class="text-[11px] font-bold font-mono mt-1 px-1.5 py-0.5 rounded inline-block"
                                                :class="typeof stock.contribution === 'number' ? (stock.contribution >= 0 ? 'bg-red-900/10 text-red-400/80' : 'bg-green-900/10 text-green-400/80') : 'bg-gray-700/40 text-gray-400'">
                                                è´¡çŒ®: {{ typeof stock.contribution === 'number' ?
                                                (stock.contribution.toFixed(3) + '%') : '--' }}
                                            </div>
                                        </div>
                                    </div>
                                    <div
                                        class="flex justify-between items-end text-xs mt-3 pt-3 border-t border-gray-700/30">
                                        <div class="text-gray-400 font-medium">
                                            æŒä»“å æ¯”: <span class="text-yellow-400/90 font-mono font-bold ml-1 text-sm">{{
                                                stock.weight ? stock.weight.toFixed(2) + '%' : '--' }}</span>
                                        </div>
                                        <div class="text-gray-400 font-mono">
                                            ç°ä»·: <span class="text-gray-200 font-bold ml-1">{{ stock.price.toFixed(2)
                                                }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else class="flex flex-col items-center justify-center py-20 text-gray-500">
                            <div class="text-6xl mb-4 opacity-10">ğŸ‚</div>
                            <p>æš‚æ— é‡ä»“è‚¡æ•°æ®</p>
                            <p class="text-xs opacity-40 mt-2">è¯·ç¡®è®¤åŸºé‡‘ä»£ç æ˜¯å¦æ­£ç¡®æˆ–ç¨åé‡è¯•</p>
                        </div>
                    </div>

                    <!-- æŠ½å±‰åº•éƒ¨ -->
                    <div class="p-6 border-t border-gray-700 bg-gray-900/30">
                        <div class="flex items-start gap-2 bg-blue-900/10 p-3 rounded-lg border border-blue-900/20">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" class="w-5 h-5 mt-0.5 text-blue-400 shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                            </svg>
                            <p class="text-xs text-gray-400 leading-relaxed">
                                æ•°æ®æç¤ºï¼šå‰åå¤§é‡ä»“è‚¡ä¸ºå­£åº¦å…¬å¼€æŠ«éœ²æ•°æ®ï¼Œå…·æœ‰æ»åæ€§ã€‚å®æ—¶è´¡çŒ®åº¦åŸºäºå½“å‰è‚¡ç¥¨æ¶¨è·Œå¹…ä¼°ç®—ï¼Œä»…ä¾›åŸºé‡‘æ—¥å†…æ³¢åŠ¨å‚è€ƒï¼Œä¸ä»£è¡¨åŸºé‡‘å®é™…å‡€å€¼ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </transition>
        </div>

    </div>
    {% endraw %}

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // è§†å›¾çŠ¶æ€
                    currentView: 'gold', // 'gold' | 'fund'

                    // åŸºé‡‘æ•°æ®
                    funds: [],
                    newFundCode: '',
                    fundFilterText: '',
                    fundSortMode: 'default', // 'default' | 'gain' | 'loss'
                    isAddingFund: false,

                    // æŒä»“æ•°æ®
                    holdings: [],
                    holdingsSummary: { total_cost: 0, total_value: 0, total_profit: 0, total_profit_rate: 0, count: 0 },
                    holdingsLastUpdate: '--',
                    isLoadingHoldings: false,
                    holdingsTimer: null,
                    fundPriceAnimating: false,  // åŸºé‡‘é¡µæ•°å­—æ»šåŠ¨åŠ¨ç”»

                    // æŒä»“ç¼–è¾‘æ¨¡æ€æ¡†
                    holdingModal: {
                        visible: false,
                        isEdit: false,
                        code: '',
                        costPrice: '',
                        shares: '',
                        note: '',
                        saving: false
                    },

                    // é‡ä»“è‚¡æŠ½å±‰çŠ¶æ€
                    portfolioDrawer: {
                        visible: false,
                        loading: false,
                        fundName: '',
                        fundCode: '',
                        holdings: [],
                        meta: {
                            weight_coverage: 0,
                            contribution_available: false,
                            confidence_label: '--',
                            report_period: '',
                            estimate_mode: 'none'
                        }
                    },

                    // æ•°æ®çŠ¶æ€
                    isInitialLoading: true, // æ–°å¢ï¼šåˆå§‹åŠ è½½çŠ¶æ€
                    fetchError: null,       // æ–°å¢ï¼šæŠ“å–é”™è¯¯ä¿¡æ¯
                    currentData: {
                        price: 0,
                        change: 0,
                        open: 0,
                        yesterday_close: 0,
                        high: 0,
                        low: 0,
                        time_str: '--:--:--'
                    },
                    buyPrice: 0,
                    buyWeight: 1, // é»˜è®¤ 1g
                    records: [],
                    historyData: [], // ç”¨äºå›¾è¡¨
                    chartViewMode: '30M', // '30M' | '1D'

                    // ç³»ç»ŸçŠ¶æ€
                    isConnected: false,
                    isRecording: false,
                    hasInitializedBuyPrice: false,
                    priceTimer: null,    // é‡‘ä»·è½®è¯¢å®šæ—¶å™¨
                    fundTimer: null,     // åŸºé‡‘è½®è¯¢å®šæ—¶å™¨
                    lastPriceInterval: null,   // ä¸Šæ¬¡é‡‘ä»·è½®è¯¢é—´éš”
                    lastFundInterval: null,    // ä¸Šæ¬¡åŸºé‡‘è½®è¯¢é—´éš”
                    tempBuyPrice: null, // ç”¨äºè¾“å…¥æ¡†è·å–ç„¦ç‚¹æ—¶æš‚å­˜æ•°æ®
                    chartSwitching: false, // æ§åˆ¶å›¾è¡¨åˆ‡æ¢åŠ¨ç”»
                    timeAnimating: false, // æ§åˆ¶é‡‘ä»·æ—¶é—´æ›´æ–°åŠ¨ç”»
                    fundTimeAnimating: false, // æ§åˆ¶åŸºé‡‘æ—¶é—´æ›´æ–°åŠ¨ç”»
                    priceAnimTimer: null, // åŠ¨ç”»å®šæ—¶å™¨å¼•ç”¨
                    timeAnimTimer: null, // é‡‘ä»·æ—¶é—´åŠ¨ç”»å®šæ—¶å™¨
                    fundTimeAnimTimer: null, // åŸºé‡‘æ—¶é—´åŠ¨ç”»å®šæ—¶å™¨
                    // å¡ç‰‡å…¥åœºåŠ¨ç”»æ§åˆ¶
                    isFirstLoad: true,      // æ˜¯å¦é¦–æ¬¡åŠ è½½ï¼ˆæ§åˆ¶å…¥åœºåŠ¨ç”»è§¦å‘ï¼‰
                    cardsAnimated: false,   // å¡ç‰‡åŠ¨ç”»æ˜¯å¦å·²å®Œæˆ
                    // é¢„è­¦è®¾ç½®
                    settings: {
                        high: 0,
                        low: 0,
                        enabled: false,
                        trading_events_enabled: true
                    },
                    lastNotifiedTime: 0, // ä¸Šæ¬¡é€šçŸ¥æ—¶é—´

                    // äº¤æ˜“çŠ¶æ€
                    tradingStatus: {
                        is_trading_time: false,
                        trading_phase: 'closed',
                        phase_name: 'ä¼‘å¸‚',
                        next_event: null,
                        next_event_time: null,
                        time_until_next: null,
                        is_holiday: false,
                        weekday: 0,
                        weekday_name: ''
                    },
                    fundTradingStatus: {
                        is_trading_time: false,
                        trading_phase: 'closed',
                        phase_name: 'ä¼‘å¸‚',
                        next_event: null,
                        next_event_time: null,
                        time_until_next: null,
                        is_holiday: false,
                        weekday: 0,
                        weekday_name: ''
                    },
                    lastTradingPhase: null, // ç”¨äºæ£€æµ‹å¼€æ”¶ç›˜äº‹ä»¶
                    lastFundTradingPhase: null, // ç”¨äºæ£€æµ‹åŸºé‡‘å¼€æ”¶ç›˜äº‹ä»¶
                    tradingTimer: null, // äº¤æ˜“çŠ¶æ€æ£€æŸ¥å®šæ—¶å™¨
                    isRibbonHovered: false, // ä¸å¸¦æ ‡ç­¾æ‚¬åœçŠ¶æ€

                    // æ¨¡æ€æ¡†çŠ¶æ€
                    modal: {
                        visible: false,
                        type: 'prompt', // 'prompt' | 'confirm'
                        title: '',
                        message: '',
                        placeholder: '',
                        inputValue: '',
                        confirmText: 'ç¡®å®š',
                        confirmButtonClass: '',
                        resolve: null // Promise resolve function
                    },
                    // chartInstance å·²ç§»é™¤ï¼Œé¿å… Vue ä»£ç†å¯¼è‡´çš„å›¾è¡¨å¡æ­»é—®é¢˜

                    // æ•°å­—åŠ¨ç”»çŠ¶æ€
                    holdingsPulse: {
                        todayProfit: false,
                        totalProfit: false,
                        profitRate: false,
                        timers: {
                            todayProfit: null,
                            totalProfit: null,
                            profitRate: null
                        }
                    },

                    // æŒä»“åˆ—è¡¨æ”¶èµ·çŠ¶æ€
                    isHoldingsListCollapsed: false,

                    // æŒä»“åˆ—è¡¨åŠ¨æ€é«˜åº¦
                    holdingsListHeight: 2000,

                    // æŒä»“åˆ—è¡¨è¿‡æ¸¡åŠ¨ç”»å¼€å…³ï¼ˆé˜²æ­¢é«˜åº¦è®¡ç®—æ—¶äº§ç”Ÿä¸¤æ®µåŠ¨ç”»ï¼‰
                    holdingsListTransitionEnabled: true,

                    // æŒä»“åˆ—è¡¨æ˜¯å¦æ­£åœ¨å±•å¼€ï¼ˆå†»ç»“é«˜åº¦æ›´æ–°ï¼‰
                    isHoldingsListExpanding: false,

                    // è‡ªé€‰åŸºé‡‘å±•ç¤ºæ¨¡å¼ä¸åå¥½
                    fundDisplayMode: 'card', // 'card' | 'list'
                    fundSortField: 'default', // 'default' | 'change' | 'price' | 'name'
                    fundSortDirection: 'desc', // 'asc' | 'desc'
                    fundRowHeight: 'comfortable' // 'compact' | 'comfortable'
                }
            },
            created() {
                this.chartInstance = null; // éå“åº”å¼å˜é‡
                this.loadFundViewPreferences(); // åŠ è½½ç”¨æˆ·åå¥½
            },
            watch: {
                'portfolioDrawer.visible'(newVal) {
                    if (newVal) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                },
                async currentView(newVal) {
                    if (newVal === 'fund') {
                        // åœæ­¢é‡‘ä»·è½®è¯¢
                        if (this.priceTimer) {
                            clearInterval(this.priceTimer);
                            this.priceTimer = null;
                        }
                        // åˆ‡æ¢åˆ°åŸºé‡‘è§†å›¾æ—¶ï¼Œé”€æ¯å›¾è¡¨å®ä¾‹é˜²æ­¢æ®‹ç•™
                        if (this.chartInstance) {
                            this.chartInstance.destroy();
                            this.chartInstance = null;
                        }

                        // è·å–åŸºé‡‘äº¤æ˜“çŠ¶æ€ï¼ˆç­‰å¾…å®Œæˆåå†å¯åŠ¨è½®è¯¢ï¼‰
                        await this.fetchTradingStatus('fund');

                        this.fetchFunds(true);
                        this.fetchHoldings(true); // åŠ è½½æŒä»“æ•°æ®

                        // åŸºé‡‘é¡µè½®è¯¢é—´éš”
                        this.startFundPolling();
                    } else {
                        // åœæ­¢åŸºé‡‘è½®è¯¢
                        if (this.fundTimer) {
                            clearInterval(this.fundTimer);
                            this.fundTimer = null;
                        }
                        // åˆ‡æ¢å›é‡‘ä»·è§†å›¾æ—¶ï¼Œå…ˆè·å–äº¤æ˜“çŠ¶æ€ï¼ˆç­‰å¾…å®Œæˆï¼‰
                        await this.fetchTradingStatus('gold');

                        // åˆ·æ–°å†å²æ•°æ®ä»¥å¡«è¡¥æ–­æ¡£
                        this.fetchHistory();
                        this.fetchPrice();

                        // ä½¿ç”¨æ™ºèƒ½è½®è¯¢ï¼ˆæ ¹æ®äº¤æ˜“çŠ¶æ€è°ƒæ•´é—´éš”ï¼‰
                        this.startPricePolling();
                    }
                },
                holdingsSummary: {
                    handler(newVal, oldVal) {
                        if (!oldVal) return;
                        if (newVal.count === 0 && oldVal.count === 0) return;
                        if (newVal.count === oldVal.count) {
                            if (newVal.total_today_profit !== oldVal.total_today_profit) {
                                this.triggerPulse('todayProfit');
                            }
                            if (newVal.total_profit !== oldVal.total_profit) {
                                this.triggerPulse('totalProfit');
                            }
                            if (newVal.total_profit_rate !== oldVal.total_profit_rate) {
                                this.triggerPulse('profitRate');
                            }
                        }
                    },
                    deep: true
                },
                isHoldingsListCollapsed(newVal) {
                    if (!newVal) {
                        // å±•å¼€æ—¶å…ˆå†»ç»“é«˜åº¦æ›´æ–°ï¼Œç­‰å¾…åŠ¨ç”»å®Œæˆ
                        this.isHoldingsListExpanding = true;
                        // åˆå§‹è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„é«˜åº¦ï¼Œç¡®ä¿å†…å®¹èƒ½æ˜¾ç¤º
                        // ä½¿ç”¨å›ºå®šå¤§å€¼é¿å…ç«‹å³è®¡ç®— scrollHeight å¯¼è‡´çš„æŠ–åŠ¨
                        this.holdingsListHeight = 2000;
                        // 500ms åï¼ˆCSS åŠ¨ç”»å®Œæˆï¼‰è§£å†»å¹¶æ›´æ–°å‡†ç¡®é«˜åº¦
                        setTimeout(() => {
                            this.isHoldingsListExpanding = false;
                            this.updateHoldingsListHeight();
                        }, 500);
                    }
                },
                holdings: {
                    handler() {
                        // é¿å…å±•å¼€åŠ¨ç”»æœŸé—´é‡å¤è®¡ç®—ï¼ˆå†»ç»“æœŸé—´ä¼šè·³è¿‡ï¼‰
                        this.$nextTick(() => {
                            this.updateHoldingsListHeight();
                        });
                    },
                    deep: true
                },
                fundRowHeight() {
                    // è¡Œé«˜å˜åŒ–æ—¶ä¿å­˜åå¥½
                    this.saveFundViewPreferences();
                }
            },
            computed: {
                totalTodayProfit() {
                    return this.holdings.reduce((sum, h) => sum + (h.today_profit || 0), 0);
                },
                portfolioContribution() {
                    const holdings = this.portfolioDrawer.holdings || [];
                    const meta = this.portfolioDrawer.meta || {};
                    if (!holdings.length || meta.contribution_available === false) {
                        return { available: false, value: 0 };
                    }
                    const total = holdings.reduce((sum, stock) => {
                        return sum + (typeof stock.contribution === 'number' ? stock.contribution : 0);
                    }, 0);
                    return { available: true, value: total };
                },
                filteredFunds() {
                    let result = [...this.funds];

                    // 1. è¿‡æ»¤
                    if (this.fundFilterText) {
                        const q = this.fundFilterText.toLowerCase();
                        result = result.filter(f =>
                            f.name.toLowerCase().includes(q) ||
                            f.code.toLowerCase().includes(q)
                        );
                    }

                    // 2. æ’åº (ä¼˜å…ˆä½¿ç”¨åˆ—è¡¨è§†å›¾çš„åˆ—æ’åº)
                    const sortDir = this.fundSortDirection === 'asc' ? 1 : -1;

                    if (this.fundSortField !== 'default') {
                        // åˆ—æ’åºæ¨¡å¼
                        switch (this.fundSortField) {
                            case 'change':
                                result.sort((a, b) => sortDir * (a.change - b.change));
                                break;
                            case 'price':
                                result.sort((a, b) => sortDir * (parseFloat(a.price) - parseFloat(b.price)));
                                break;
                            case 'name':
                                result.sort((a, b) => sortDir * a.name.localeCompare(b.name, 'zh-CN'));
                                break;
                        }
                    } else {
                        // ä¼ ç»Ÿæ’åºæ¨¡å¼ (å…¼å®¹æ—§ç‰ˆæŒ‰é’®)
                        if (this.fundSortMode === 'gain') {
                            result.sort((a, b) => b.change - a.change);
                        } else if (this.fundSortMode === 'loss') {
                            result.sort((a, b) => a.change - b.change);
                        }
                    }

                    return result;
                },
                isPriceUp() {
                    return this.currentData.change >= 0;
                },
                currentProfit() {
                    if (!this.buyPrice || this.buyPrice <= 0 || !this.currentData.price) {
                        return { rate: '0.00', amount: '0.00' };
                    }
                    const feeRate = 0.005;
                    const actualReceive = this.currentData.price * (1 - feeRate);
                    const rate = ((actualReceive - this.buyPrice) / this.buyPrice * 100);
                    // åŸºç¡€æ¯å…‹ç›ˆäº
                    let amount = actualReceive - this.buyPrice;

                    // å¦‚æœè®¾ç½®äº†å…‹æ•°ï¼Œåˆ™è®¡ç®—æ€»ç›ˆäº
                    if (this.buyWeight && this.buyWeight > 0) {
                        amount = amount * this.buyWeight;
                    }

                    return {
                        rate: rate.toFixed(2),
                        amount: amount.toFixed(2)
                    };
                },
                profitBarStyle() {
                    const rate = parseFloat(this.currentProfit.rate);
                    // èŒƒå›´ -10% åˆ° +20% (æ€»è·¨åº¦ 30%)
                    // -10% å¯¹åº” left 0%
                    // 0% å¯¹åº” left 33.3%
                    // +20% å¯¹åº” left 100%

                    if (rate <= -10) return { width: '0%', left: '0%' };
                    if (rate >= 20) return { width: '66.7%', left: '33.3%' };

                    if (rate < 0) {
                        // -10 åˆ° 0 ä¹‹é—´
                        const widthPct = ((rate + 10) / 10) * 33.3;
                        return { width: `${widthPct}%`, left: '0%' }; // ç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥é å³å¯¹é½åˆ°å‚è€ƒçº¿
                    } else {
                        // 0 åˆ° 20 ä¹‹é—´
                        const widthPct = (rate / 20) * 66.7;
                        return { width: `${widthPct}%`, left: '33.3%' };
                    }
                },
                targetTable() {
                    if (!this.buyPrice || this.buyPrice <= 0) return [];

                    const targets = [5, 10, 15, 20, 30];
                    const feeRate = 0.005;

                    return targets.map(percent => {
                        // ç›®æ ‡å–å‡ºä»· = ä¹°å…¥ä»· * (1 + åˆ©æ¶¦ç‡) / (1 - æ‰‹ç»­è´¹)
                        const sellPrice = this.buyPrice * (1 + percent / 100) / (1 - feeRate);
                        let profitAmount = (this.buyPrice * percent / 100);

                        // å¦‚æœæœ‰å…‹æ•°ï¼Œè®¡ç®—æ€»ç›ˆåˆ©
                        if (this.buyWeight && this.buyWeight > 0) {
                            profitAmount = profitAmount * this.buyWeight;
                        }

                        const requiredGain = ((sellPrice - this.buyPrice) / this.buyPrice * 100);
                        const reached = this.currentData.price >= sellPrice;
                        // è®¡ç®—è¿›åº¦ 0-100%
                        const progress = Math.min(100, Math.max(0,
                            (this.currentData.price - this.buyPrice) / (sellPrice - this.buyPrice) * 100
                        ));

                        return {
                            percent,
                            sellPrice: sellPrice.toFixed(2),
                            profitAmount: profitAmount.toFixed(2),
                            requiredGain: requiredGain.toFixed(2),
                            reached,
                            progress: progress.toFixed(1)
                        };
                    });
                },
                reversedRecords() {
                    return [...this.records].reverse();
                }
            },
            methods: {
                // æ ¼å¼åŒ–æ–¹æ³•
                formatPrice(price) {
                    if (price === undefined || price === null || isNaN(price)) return '--';
                    return parseFloat(price).toFixed(2);
                },
                formatAmount(amount) {
                    if (amount === undefined || amount === null || isNaN(amount)) return '--';
                    return parseFloat(amount).toFixed(2);
                },
                formatPercent(val) {
                    if (val === undefined || val === null || isNaN(val)) return '0.00';
                    return (val >= 0 ? '+' : '') + parseFloat(val).toFixed(2);
                },

                // ==================== è‡ªé€‰åŸºé‡‘è§†å›¾åå¥½ç®¡ç† ====================
                loadFundViewPreferences() {
                    try {
                        const saved = localStorage.getItem('fundViewPreferences');
                        if (saved) {
                            const prefs = JSON.parse(saved);
                            if (prefs.displayMode) this.fundDisplayMode = prefs.displayMode;
                            if (prefs.sortField) this.fundSortField = prefs.sortField;
                            if (prefs.sortDirection) this.fundSortDirection = prefs.sortDirection;
                            if (prefs.rowHeight) this.fundRowHeight = prefs.rowHeight;
                        }
                    } catch (e) {
                        console.warn('åŠ è½½åŸºé‡‘è§†å›¾åå¥½å¤±è´¥:', e);
                    }
                },

                saveFundViewPreferences() {
                    try {
                        const prefs = {
                            displayMode: this.fundDisplayMode,
                            sortField: this.fundSortField,
                            sortDirection: this.fundSortDirection,
                            rowHeight: this.fundRowHeight
                        };
                        localStorage.setItem('fundViewPreferences', JSON.stringify(prefs));
                    } catch (e) {
                        console.warn('ä¿å­˜åŸºé‡‘è§†å›¾åå¥½å¤±è´¥:', e);
                    }
                },

                setFundDisplayMode(mode) {
                    this.fundDisplayMode = mode;
                    this.saveFundViewPreferences();
                },

                setLegacyFundSortMode(mode) {
                    this.fundSortMode = mode;
                    this.fundSortField = 'default';
                    this.fundSortDirection = mode === 'loss' ? 'asc' : 'desc';
                    this.saveFundViewPreferences();
                },

                toggleSort(field) {
                    if (this.fundSortField === field) {
                        // åˆ‡æ¢æ–¹å‘
                        this.fundSortDirection = this.fundSortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        // æ–°å­—æ®µï¼Œé»˜è®¤é™åº
                        this.fundSortField = field;
                        this.fundSortDirection = 'desc';
                    }
                    // ç‚¹å‡»è¡¨å¤´æ’åºæ—¶ï¼Œå°†æ—§æ’åºæ¨¡å¼é‡ç½®ä¸ºé»˜è®¤ï¼Œä¿æŒUIä¸€è‡´æ€§
                    this.fundSortMode = 'default';
                    this.saveFundViewPreferences();
                },

                getSortClass(field) {
                    if (this.fundSortField !== field) return '';
                    return this.fundSortDirection === 'asc' ? 'sort-asc' : 'sort-desc';
                },

                // æ›´æ–°æŒä»“åˆ—è¡¨é«˜åº¦
                updateHoldingsListHeight() {
                    // å¦‚æœæ­£åœ¨å±•å¼€åŠ¨ç”»æœŸé—´ï¼Œè·³è¿‡é«˜åº¦æ›´æ–°
                    if (this.isHoldingsListExpanding) {
                        return;
                    }

                    if (this.$refs.holdingsListRef) {
                        // ä¸´æ—¶ç¦ç”¨è¿‡æ¸¡åŠ¨ç”»ï¼Œé˜²æ­¢é«˜åº¦å˜åŒ–äº§ç”Ÿä¸¤æ®µåŠ¨ç”»
                        this.holdingsListTransitionEnabled = false;
                        const height = this.$refs.holdingsListRef.scrollHeight;
                        this.holdingsListHeight = Math.max(height, 100);
                        // ä¸‹ä¸€å¸§é‡æ–°å¯ç”¨è¿‡æ¸¡åŠ¨ç”»
                        requestAnimationFrame(() => {
                            this.holdingsListTransitionEnabled = true;
                        });
                    }
                },

                // æ•°å­—è„‰å†²åŠ¨ç”»è§¦å‘æ–¹æ³•
                triggerPulse(field) {
                    const timer = this.holdingsPulse.timers[field];
                    if (timer) {
                        clearTimeout(timer);
                        this.holdingsPulse.timers[field] = null;
                    }
                    this.holdingsPulse[field] = false;
                    this.$nextTick(() => {
                        this.holdingsPulse[field] = true;
                    });
                    this.holdingsPulse.timers[field] = setTimeout(() => {
                        this.holdingsPulse[field] = false;
                        this.holdingsPulse.timers[field] = null;
                    }, 1000);
                },

                // ==================== äº¤æ˜“çŠ¶æ€ç®¡ç† ====================
                async fetchTradingStatus(type = 'gold') {
                    try {
                        const res = await fetch(`/api/trading-status?type=${type}`);
                        const data = await res.json();
                        if (data.success) {
                            if (type === 'gold') {
                                this.tradingStatus = data.data;
                                if (!this.lastTradingPhase) {
                                    this.lastTradingPhase = data.data.trading_phase;
                                }
                            } else {
                                this.fundTradingStatus = data.data;
                                if (!this.lastFundTradingPhase) {
                                    this.lastFundTradingPhase = data.data.trading_phase;
                                }
                            }
                        }
                    } catch (e) {
                        console.error(`è·å–${type}äº¤æ˜“çŠ¶æ€å¤±è´¥`, e);
                    }
                },

                async checkTradingEvents() {
                    try {
                        // åŒæ—¶æ£€æŸ¥é»„é‡‘å’ŒåŸºé‡‘
                        await Promise.all([
                            this._checkSingleEvent('gold'),
                            this._checkSingleEvent('fund')
                        ]);
                    } catch (e) {
                        console.error('æ£€æŸ¥äº¤æ˜“äº‹ä»¶å¤±è´¥', e);
                    }
                },

                async _checkSingleEvent(type) {
                    const res = await fetch(`/api/trading-status?type=${type}`);
                    const data = await res.json();
                    if (data.success) {
                        const newStatus = data.data;
                        const oldPhase = type === 'gold' ? this.lastTradingPhase : this.lastFundTradingPhase;
                        const newPhase = newStatus.trading_phase;

                        if (oldPhase && oldPhase !== newPhase) {
                            // æ£€æµ‹å¼€æ”¶ç›˜äº‹ä»¶
                            let eventMap = {};
                            if (type === 'gold') {
                                eventMap = {
                                    'day_auction_day_session': { name: 'æ—¥é—´äº¤æ˜“å¼€å§‹', icon: 'â˜€ï¸' },
                                    'day_session_closed': { name: 'æ—¥é—´äº¤æ˜“ç»“æŸ', icon: 'ğŸŒ…' },
                                    'night_auction_night_session': { name: 'å¤œé—´äº¤æ˜“å¼€å§‹', icon: 'ğŸŒ™' },
                                    'night_session_closed': { name: 'å¤œé—´äº¤æ˜“ç»“æŸ', icon: 'ğŸŒƒ' }
                                };
                            } else {
                                eventMap = {
                                    'closed_trading': { name: 'åŸºé‡‘å¸‚åœºå¼€ç›˜', icon: 'ğŸ“ˆ' },
                                    'trading_lunch_break': { name: 'åŸºé‡‘åˆé—´ä¼‘å¸‚', icon: 'ğŸŒ…' },
                                    'lunch_break_trading': { name: 'åŸºé‡‘ä¸‹åˆå¼€ç›˜', icon: 'ğŸ“ˆ' },
                                    'trading_closed': { name: 'åŸºé‡‘å¸‚åœºæ”¶ç›˜', icon: 'ğŸ“‰' }
                                };
                            }


                            const eventKey = `${oldPhase}_${newPhase}`;
                            if (this.settings.trading_events_enabled && eventMap[eventKey]) {
                                const event = eventMap[eventKey];
                                this.showTradingNotification(`${type === 'gold' ? 'é»„é‡‘' : 'åŸºé‡‘'} ${event.name}`, event.icon);
                            }
                        }

                        // æ›´æ–°çŠ¶æ€
                        if (type === 'gold') {
                            this.tradingStatus = newStatus;
                            this.lastTradingPhase = newPhase;
                            this.adjustPollingInterval();
                        } else {
                            this.fundTradingStatus = newStatus;
                            this.lastFundTradingPhase = newPhase;
                            this.adjustFundPollingInterval();
                        }
                    }
                },

                showTradingNotification(eventName, icon) {
                    // æµè§ˆå™¨é€šçŸ¥
                    if ('Notification' in window && Notification.permission === 'granted') {
                        const title = eventName.includes('é»„é‡‘') ? 'Au99.99 äº¤æ˜“æé†’' : (eventName.includes('åŸºé‡‘') ? 'åŸºé‡‘ä¼°å€¼ äº¤æ˜“æé†’' : 'äº¤æ˜“çŠ¶æ€æé†’');
                        new Notification(title, {
                            body: `${icon} ${eventName}`,
                            icon: '/favicon.ico',
                            requireInteraction: true
                        });
                    }

                    // é¡µé¢å†… Toast é€šçŸ¥
                    this.showToast(`${icon} ${eventName}`, 'info');
                },

                startPricePolling() {
                    // å…ˆæ¸…é™¤æ—§å®šæ—¶å™¨
                    if (this.priceTimer) {
                        clearInterval(this.priceTimer);
                    }

                    // æ ¹æ®äº¤æ˜“çŠ¶æ€è®¾ç½®è½®è¯¢é—´éš”
                    const interval = this.tradingStatus.is_trading_time ? 5000 : 300000; // 5ç§’æˆ–5åˆ†é’Ÿ

                    // ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åå¯åŠ¨å®šæ—¶å™¨
                    this.fetchPrice();

                    this.priceTimer = setInterval(() => {
                        this?.fetchPrice?.();
                    }, interval);
                    console.log(`[è½®è¯¢] é»„é‡‘ä»·æ ¼é‡‡é›†é—´éš”å·²è®¾ç½®ä¸º ${interval / 1000} ç§’`);
                },

                startFundPolling() {
                    // å…ˆæ¸…é™¤æ—§å®šæ—¶å™¨
                    if (this.fundTimer) clearInterval(this.fundTimer);

                    // æ ¹æ®äº¤æ˜“çŠ¶æ€è®¾ç½®è½®è¯¢é—´éš”
                    const interval = this.fundTradingStatus.is_trading_time ? 3000 : 300000; // äº¤æ˜“æ—¶é—´ 3ç§’ï¼Œéäº¤æ˜“æ—¶é—´ 5åˆ†é’Ÿ

                    // ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åå¯åŠ¨å®šæ—¶å™¨
                    this.fetchFunds(true);
                    this.fetchHoldings(true, true);

                    this.fundTimer = setInterval(() => {
                        this.fetchFunds(true);
                        this.fetchHoldings(true, true);
                    }, interval);
                    console.log(`[è½®è¯¢] åŸºé‡‘æ•°æ®é‡‡é›†é—´éš”å·²è®¾ç½®ä¸º ${interval / 1000} ç§’`);
                },

                adjustPollingInterval() {
                    if (this.currentView !== 'gold') return;

                    // åªåœ¨é—´éš”çœŸæ­£å˜åŒ–æ—¶æ‰é‡å¯å®šæ—¶å™¨
                    const newInterval = this.tradingStatus.is_trading_time ? 5000 : 300000;
                    if (this.lastPriceInterval !== newInterval) {
                        this.lastPriceInterval = newInterval;
                        this.startPricePolling();
                    }
                },

                adjustFundPollingInterval() {
                    if (this.currentView !== 'fund') return;

                    // åªåœ¨é—´éš”çœŸæ­£å˜åŒ–æ—¶æ‰é‡å¯å®šæ—¶å™¨
                    const newInterval = this.fundTradingStatus.is_trading_time ? 3000 : 300000;
                    if (this.lastFundInterval !== newInterval) {
                        this.lastFundInterval = newInterval;
                        this.startFundPolling();
                    }
                },

                formatCountdown(seconds, nextEventTime) {
                    if (!seconds || seconds <= 0) return '00:00:00';
                    
                    const days = Math.floor(seconds / 86400);
                    const hours = Math.floor((seconds % 86400) / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = seconds % 60;

                    // è¶…è¿‡2å¤©æ˜¾ç¤ºå…·ä½“æ—¥æœŸ
                    if (days >= 2) {
                        if (nextEventTime) {
                            const date = new Date(nextEventTime);
                            const month = date.getMonth() + 1;
                            const day = date.getDate();
                            return `${month}æœˆ${day}æ—¥`;
                        }
                        return `${days}å¤©å`;
                    } else if (days > 0) {
                        return `${days}å¤©${hours}æ—¶`;
                    } else if (hours > 0) {
                        return `${hours}å°æ—¶${minutes}åˆ†`;
                    } else if (minutes > 0) {
                        return `${minutes}åˆ†${secs}ç§’`;
                    } else {
                        return `${secs}ç§’å`;
                    }
                },

                getHolidayName() {
                    const now = new Date();
                    const month = now.getMonth() + 1;
                    const date = now.getDate();
                    
                    // æ˜¥èŠ‚æœŸé—´ï¼ˆå¤§çº¦1æœˆåº•åˆ°2æœˆä¸­ï¼‰
                    if (month === 2 && date >= 15 && date <= 22) {
                        return 'æ˜¥èŠ‚';
                    }
                    // æ¸…æ˜èŠ‚ï¼ˆ4æœˆ4-6æ—¥ï¼‰
                    if (month === 4 && date >= 4 && date <= 6) {
                        return 'æ¸…æ˜èŠ‚';
                    }
                    // åŠ³åŠ¨èŠ‚ï¼ˆ5æœˆ1-2æ—¥ï¼‰
                    if (month === 5 && date >= 1 && date <= 2) {
                        return 'åŠ³åŠ¨èŠ‚';
                    }
                    // ç«¯åˆèŠ‚ï¼ˆ5æœˆåº•-6æœˆåˆï¼‰
                    if ((month === 5 && date >= 30) || (month === 6 && date <= 5)) {
                        return 'ç«¯åˆèŠ‚';
                    }
                    // ä¸­ç§‹èŠ‚ï¼ˆ9æœˆåº•-10æœˆåˆï¼‰
                    if ((month === 9 && date >= 20) || (month === 10 && date <= 5)) {
                        return 'ä¸­ç§‹èŠ‚';
                    }
                    // å›½åº†èŠ‚ï¼ˆ10æœˆ1-7æ—¥ï¼‰
                    if (month === 10 && date >= 1 && date <= 7) {
                        return 'å›½åº†èŠ‚';
                    }
                    // å…ƒæ—¦ï¼ˆ1æœˆ1æ—¥ï¼‰
                    if (month === 1 && date === 1) {
                        return 'å…ƒæ—¦';
                    }
                    
                    return null;
                },

                showToast(message, type = 'info') {
                    // ç®€å•çš„ Toast æç¤ºå®ç°
                    const toast = document.createElement('div');
                    toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-[70] px-6 py-3 rounded-full shadow-lg text-sm font-medium animate-fade-in`;

                    if (type === 'info') {
                        toast.className += ' bg-blue-500/90 text-white';
                    } else if (type === 'success') {
                        toast.className += ' bg-green-500/90 text-white';
                    } else if (type === 'warning') {
                        toast.className += ' bg-yellow-500/90 text-black';
                    }

                    toast.textContent = message;
                    document.body.appendChild(toast);

                    setTimeout(() => {
                        toast.style.opacity = '0';
                        toast.style.transition = 'opacity 0.5s';
                        setTimeout(() => toast.remove(), 500);
                    }, 5000);
                },

                handleResize() {
                    if (this.chartInstance) {
                        this.chartInstance.options.layout.padding.right = window.innerWidth < 640 ? 60 : 110;
                        this.chartInstance.update('none');
                    }
                },

                processDataForChart(sortedData) {
                    if (!sortedData || sortedData.length === 0) return [];
                    const now = Date.now() / 1000;
                    const maxGap = 600; // 10åˆ†é’Ÿæ–­æ¡£
                    let filteredData = [];

                    if (this.chartViewMode === '30M') {
                        // 30åˆ†é’Ÿæ¨¡å¼ï¼šç›´æ¥æ˜¾ç¤ºåŸå§‹ç‚¹
                        filteredData = sortedData.filter(item => item.timestamp > now - 1800);
                    } else {
                        // 1D æ¨¡å¼ï¼šä¿ç•™èšåˆé€»è¾‘
                        const bucketSize = 5 * 60; // 5åˆ†é’Ÿä¸€æ¡¶
                        let buckets = {};
                        let recentData = [];

                        sortedData.forEach(item => {
                            const age = now - item.timestamp;
                            if (age <= 1800) { // æœ€è¿‘30åˆ†é’Ÿç”¨åŸå§‹ç‚¹
                                recentData.push(item);
                            } else {
                                const bucketKey = Math.floor(item.timestamp / bucketSize);
                                if (!buckets[bucketKey]) {
                                    buckets[bucketKey] = { min: item, max: item };
                                } else {
                                    if (item.price < buckets[bucketKey].min.price) buckets[bucketKey].min = item;
                                    if (item.price > buckets[bucketKey].max.price) buckets[bucketKey].max = item;
                                }
                            }
                        });

                        let bucketList = Object.values(buckets).flatMap(b => {
                            if (b.min.timestamp === b.max.timestamp) return [b.min];
                            return b.min.timestamp < b.max.timestamp ? [b.min, b.max] : [b.max, b.min];
                        });

                        filteredData = [...bucketList, ...recentData].sort((a, b) => a.timestamp - b.timestamp);
                    }

                    // æ’å…¥æ–­æ¡£æ ‡è®° (null)
                    let finalData = [];
                    for (let i = 0; i < filteredData.length; i++) {
                        if (i > 0) {
                            const gap = filteredData[i].timestamp - filteredData[i - 1].timestamp;
                            if (gap > maxGap) {
                                finalData.push({ x: (filteredData[i - 1].timestamp + 1), y: null });
                            }
                        }
                        finalData.push({ x: filteredData[i].timestamp, y: filteredData[i].price });
                    }

                    return finalData;
                },
                handleInputFocus(event) {
                    // ä¸å†æ¸…ç©º buyPriceï¼Œè€Œæ˜¯å…¨é€‰æ–‡å­—æ–¹ä¾¿ä¿®æ”¹
                    if (event && event.target) {
                        event.target.select();
                    }
                },
                handleInputBlur() {
                    // å¤±å»ç„¦ç‚¹æ—¶ï¼Œå¦‚æœä¸ºç©ºåˆ™ä¿æŒä¸ºç©ºï¼Œç­‰å¾…ç”¨æˆ·ä¸‹æ¬¡è¾“å…¥æˆ–ç‚¹å‡»é‡ç½®
                },
                resetToCurrent() {
                    if (this.currentData.price > 0) {
                        this.buyPrice = this.currentData.price;
                    }
                },
                async fetchPrice() {
                    try {
                        const res = await fetch('/api/price');
                        const data = await res.json();

                        if (data.success) {
                            this.fetchError = null; // æ¸…é™¤é”™è¯¯
                            // æ£€æŸ¥æ•°æ®æ–°é²œåº¦ (20ç§’é˜ˆå€¼)
                            const now = Date.now() / 1000;
                            const isStale = (now - data.data.timestamp) > 20;
                            this.isConnected = !isStale;

                            // æ£€æŸ¥é¢„è­¦
                            this.checkAlerts(data.data.price);

                            // é¦–æ¬¡åˆå§‹åŒ–ä¹°å…¥ä»·
                            if (!this.hasInitializedBuyPrice && data.data.price > 0) {
                                this.buyPrice = data.data.price;

                                // è‡ªåŠ¨åˆå§‹åŒ–é¢„è­¦å€¼ä¸º +-3% (ä»…å½“å°šæœªè®¾ç½®è¿‡æ—¶)
                                if (this.settings.high === 0 && this.settings.low === 0) {
                                    this.settings.high = parseFloat((data.data.price * 1.03).toFixed(2));
                                    this.settings.low = parseFloat((data.data.price * 0.97).toFixed(2));
                                    this.saveSettings();
                                }

                                this.hasInitializedBuyPrice = true;
                            }

                            // ä»…å½“ä»·æ ¼å‘ç”Ÿå˜åŒ–æˆ–é¦–æ¬¡åŠ è½½æ—¶æ‰è§¦å‘åŠ¨ç”»
                            const priceChanged = this.currentData.price !== data.data.price;
                            const timeChanged = this.currentData.timestamp !== data.data.timestamp;

                            this.currentData = data.data;

                            // æ›´æ–°å›¾è¡¨æ•°æ®
                            this.updateChartData(data.data);

                            // ä»·æ ¼è·³åŠ¨åŠ¨ç”»
                            if (priceChanged) {
                                if (this.priceAnimTimer) clearTimeout(this.priceAnimTimer);
                                // å¼ºåˆ¶é‡ç½®åŠ¨ç”»çŠ¶æ€ä»¥è§¦å‘ Vue é‡æ–°æ¸²æŸ“/CSS é‡æ–°å¼€å§‹
                                this.priceAnimating = false;
                                this.$nextTick(() => {
                                    this.priceAnimating = true;
                                    this.priceAnimTimer = setTimeout(() => {
                                        this.priceAnimating = false;
                                        this.priceAnimTimer = null;
                                    }, 400);
                                });
                            }

                            // æ—¶é—´é—ªçƒåŠ¨ç”»
                            if (timeChanged) {
                                if (this.timeAnimTimer) clearTimeout(this.timeAnimTimer);
                                this.timeAnimating = false;
                                this.$nextTick(() => {
                                    this.timeAnimating = true;
                                    this.timeAnimTimer = setTimeout(() => {
                                        this.timeAnimating = false;
                                        this.timeAnimTimer = null;
                                    }, 800);
                                });
                            }

                        } else {
                            this.isConnected = false;
                            // å¦‚æœä»·æ ¼è¿˜æ˜¯0ï¼Œè¯´æ˜ä»æœªè·å–æˆåŠŸè¿‡
                            if (this.currentData.price === 0) {
                                this.fetchError = data.message || 'è·å–æ•°æ®å¤±è´¥';
                            }
                        }
                    } catch (e) {
                        console.error(e);
                        this.isConnected = false;
                        if (this.currentData.price === 0) {
                            this.fetchError = 'ç½‘ç»œè¿æ¥å¼‚å¸¸';
                        }
                    } finally {
                        this.isInitialLoading = false;
                    }
                },
                async fetchHistory() {
                    try {
                        const res = await fetch('/api/history');
                        const data = await res.json();
                        if (data.success) {
                            this.historyData = data.data;
                            // ç¡®ä¿DOMå·²æ¸²æŸ“åå†åˆå§‹åŒ–å›¾è¡¨
                            this.$nextTick(() => {
                                const canvas = document.getElementById('priceChart');
                                if (canvas && !this.chartInstance) {
                                    this.initChart();
                                }
                            });
                        }
                    } catch (e) { console.error(e); }
                },
                async fetchRecords() {
                    try {
                        const res = await fetch('/api/records');
                        const data = await res.json();
                        if (data.success) this.records = data.data;
                    } catch (e) { console.error(e); }
                },
                async fetchSettings() {
                    try {
                        const res = await fetch('/api/settings');
                        const data = await res.json();
                        if (data.success) this.settings = data.settings;
                    } catch (e) { console.error(e); }
                },
                resetAlertsToDefault() {
                    if (this.currentData.price > 0) {
                        this.settings.high = parseFloat((this.currentData.price * 1.03).toFixed(2));
                        this.settings.low = parseFloat((this.currentData.price * 0.97).toFixed(2));
                        this.saveSettings();
                    }
                },
                async saveSettings() {
                    if (this.settings.enabled && Notification.permission !== "granted") {
                        const permission = await Notification.requestPermission();
                        if (permission !== "granted") {
                            this.settings.enabled = false;
                            alert("éœ€è¦æµè§ˆå™¨é€šçŸ¥æƒé™æ‰èƒ½å¼€å¯é¢„è­¦ï¼Œå–µï¼");
                        }
                    }

                    try {
                        await fetch('/api/settings', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.settings)
                        });
                    } catch (e) { console.error(e); }
                },
                checkAlerts(currentPrice) {
                    if (!this.settings.enabled || currentPrice <= 0) return;

                    const now = Date.now();
                    const cooldown = 5 * 60 * 1000; // 5åˆ†é’Ÿå†·å´

                    if (now - this.lastNotifiedTime < cooldown) return;

                    let msg = "";
                    if (this.settings.high > 0 && currentPrice >= this.settings.high) {
                        msg = `ğŸ“ˆ é‡‘ä»·å·²æ¶¨è‡³ ${currentPrice}ï¼Œè¶…è¿‡é¢„è­¦çº¿ ${this.settings.high}`;
                    } else if (this.settings.low > 0 && currentPrice <= this.settings.low) {
                        msg = `ğŸ“‰ é‡‘ä»·å·²è·Œè‡³ ${currentPrice}ï¼Œä½äºé¢„è­¦çº¿ ${this.settings.low}`;
                    }

                    if (msg) {
                        this.sendNotification("é‡‘ä»·æé†’ (Au99.99)", msg);
                        this.lastNotifiedTime = now;
                    }
                },
                sendNotification(title, body) {
                    if (Notification.permission === "granted") {
                        new Notification(title, {
                            body: body,
                            icon: "https://p3.itc.cn/images01/20210712/f6d76a7f34034442a8656157834241e3.png" // é‡‘ç‰Œå›¾æ ‡å ä½
                        });
                    }
                },

                // é€šç”¨ Modal æ–¹æ³•: Prompt
                openPrompt(title, placeholder = '') {
                    return new Promise((resolve) => {
                        this.modal = {
                            visible: true,
                            type: 'prompt',
                            title: title,
                            placeholder: placeholder,
                            inputValue: '',
                            confirmText: 'ç¡®è®¤è®°å½•',
                            confirmButtonClass: 'bg-blue-600 hover:bg-blue-500 text-white shadow-blue-900/50',
                            resolve: resolve
                        };
                        this.$nextTick(() => {
                            if (this.$refs.modalInput) this.$refs.modalInput.focus();
                        });
                    });
                },

                // é€šç”¨ Modal æ–¹æ³•: Confirm
                openConfirm(title, message, confirmText = 'ç¡®å®š', confirmClass = 'bg-red-600 hover:bg-red-500 text-white shadow-red-900/50') {
                    return new Promise((resolve) => {
                        this.modal = {
                            visible: true,
                            type: 'confirm',
                            title: title,
                            message: message,
                            confirmText: confirmText,
                            confirmButtonClass: confirmClass,
                            resolve: resolve
                        };
                    });
                },

                closeModal(result) {
                    if (this.modal.resolve) {
                        if (this.modal.type === 'prompt') {
                            // Prompt è¿”å›è¾“å…¥å€¼æˆ– null
                            this.modal.resolve(result ? this.modal.inputValue : null);
                        } else {
                            // Confirm è¿”å› true/false
                            this.modal.resolve(result);
                        }
                    }
                    this.modal.visible = false;
                    this.modal.resolve = null;
                },

                async recordPrice() {
                    if (this.isRecording) return;

                    this.isRecording = true;

                    const payload = {
                        price: this.currentData.price,
                        buy_price: this.buyPrice,
                        profit: this.currentProfit.rate,
                        note: '' // å¤‡æ³¨åŠŸèƒ½å·²å–æ¶ˆ
                    };

                    try {
                        const res = await fetch('/api/record', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const data = await res.json();
                        if (data.success) {
                            this.records.push(data.record);
                        }
                    } catch (e) { console.error(e); }
                    finally { this.isRecording = false; }
                },
                async clearRecords() {
                    // ä½¿ç”¨è‡ªå®šä¹‰ Modal æ›¿ä»£åŸç”Ÿ confirm
                    const confirmed = await this.openConfirm(
                        'ç¡®è®¤æ¸…ç©º',
                        'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
                        'æ¸…ç©ºè®°å½•'
                    );

                    if (!confirmed) return;

                    try {
                        await fetch('/api/records/clear', { method: 'POST' });
                        this.records = [];
                    } catch (e) { console.error(e); }
                },
                exportCSV() {
                    if (this.records.length === 0) return;

                    let csvContent = "\ufeff"; // BOM
                    csvContent += "æ—¶é—´,ä»·æ ¼(å…ƒ/å…‹),ä¹°å…¥æˆæœ¬,ç›ˆäºç‡(%)\n";

                    this.records.forEach(r => {
                        csvContent += `${r.time_str},${r.price},${r.buy_price},${r.profit}\n`;
                    });

                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement("a");
                    link.setAttribute("href", url);
                    link.setAttribute("download", `gold_price_records_${new Date().toISOString().split('T')[0]}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                },
                exportHistoryCSV() {
                    if (this.historyData.length === 0) return;

                    let csvContent = "\ufeff"; // BOM
                    csvContent += "æ—¶é—´,ä»·æ ¼(å…ƒ/å…‹)\n";

                    // æŒ‰ç…§æ—¶é—´é™åºæ’åˆ—ï¼Œæ–¹ä¾¿æŸ¥çœ‹
                    const sortedHistory = [...this.historyData].sort((a, b) => b.timestamp - a.timestamp);

                    sortedHistory.forEach(h => {
                        const timeStr = new Date(h.timestamp * 1000).toLocaleString();
                        csvContent += `${timeStr},${h.price}\n`;
                    });

                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement("a");
                    link.setAttribute("href", url);
                    link.setAttribute("download", `gold_daily_history_${new Date().toISOString().split('T')[0]}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                },
                initChart() {
                    const ctx = document.getElementById('priceChart').getContext('2d');
                    if (this.chartInstance) {
                        this.chartInstance.destroy();
                    }

                    // æ ¸å¿ƒï¼šå›¾è¡¨æ€§èƒ½ä¸è§†è§‰å¯¹é½æ–¹æ¡ˆ
                    this.chartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            datasets: [{
                                label: 'Au99.99',
                                data: this.processDataForChart(this.historyData),
                                borderColor: '#facc15',
                                borderWidth: 2.5,
                                pointRadius: 0,
                                pointHoverRadius: 5,
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#facc15',
                                pointHoverBorderWidth: 3,
                                tension: 0.3,
                                fill: true,
                                backgroundColor: (context) => {
                                    const chart = context.chart;
                                    const { ctx, chartArea } = chart;
                                    if (!chartArea) return null;
                                    const gradient = ctx.createLinearGradient(0, chartArea.top, 0, chartArea.bottom);
                                    gradient.addColorStop(0, 'rgba(250, 204, 21, 0.15)');
                                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                                    return gradient;
                                },
                                spanGaps: false,
                                normalized: true,
                                parsing: false
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 600,
                                easing: 'easeOutQuart'
                            },
                            transitions: {
                                active: { animation: { duration: 0 } }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index',
                            },
                            layout: {
                                padding: {
                                    left: 10,
                                    right: window.innerWidth < 640 ? 60 : 110,
                                    top: 15,
                                    bottom: 15
                                }
                            },
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    grid: { color: 'rgba(255, 255, 255, 0.03)', drawBorder: false },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.3)',
                                        font: { family: 'JetBrains Mono', size: 10 },
                                        callback: (val) => {
                                            const d = new Date(val * 1000);
                                            return d.getHours().toString().padStart(2, '0') + ':' +
                                                d.getMinutes().toString().padStart(2, '0');
                                        },
                                        maxRotation: 0,
                                        autoSkip: true,
                                        maxTicksLimit: 6
                                    }
                                },
                                y: {
                                    grid: { color: 'rgba(255, 255, 255, 0.03)', drawBorder: false },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.3)',
                                        font: { family: 'JetBrains Mono', size: 10 },
                                        callback: (val) => val.toFixed(2)
                                    }
                                }
                            },
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: '#1a1f2e',
                                    titleColor: '#94a3b8',
                                    titleFont: { family: 'Inter', size: 11, weight: 'bold' },
                                    bodyColor: '#fff',
                                    bodyFont: { family: 'JetBrains Mono', size: 14, weight: 'bold' },
                                    padding: 12,
                                    cornerRadius: 8,
                                    borderColor: 'rgba(255,255,255,0.1)',
                                    borderWidth: 1,
                                    displayColors: false,
                                    callbacks: {
                                        title: (items) => {
                                            const d = new Date(items[0].parsed.x * 1000);
                                            return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                                        },
                                        label: (item) => `Â¥ ${item.parsed.y.toFixed(2)}`
                                    }
                                }
                            }
                        },
                        plugins: [{ // This is the correct place for the highLowMarkers plugin (as an array outside options.plugins)
                            id: 'highLowMarkers',
                            afterDatasetsDraw: (chart) => {
                                const { ctx, chartArea: { left, right }, scales: { x, y } } = chart;
                                const dataset = chart.data.datasets[0].data;
                                const validData = dataset.filter(d => d.y !== null);
                                if (validData.length < 2) return;

                                const prices = validData.map(d => d.y);
                                const maxPrice = Math.max(...prices);
                                const minPrice = Math.min(...prices);

                                const drawLabel = (val, label, color) => {
                                    const point = validData.find(d => d.y === val);
                                    if (!point) return;
                                    const xPos = x.getPixelForValue(point.x);
                                    const yPos = y.getPixelForValue(val);

                                    // ç»˜åˆ¶è¿æ¥è™šçº¿
                                    ctx.save();
                                    ctx.strokeStyle = color;
                                    ctx.setLineDash([2, 4]);
                                    ctx.lineWidth = 1;
                                    ctx.beginPath();
                                    ctx.moveTo(xPos, yPos);
                                    ctx.lineTo(right + 5, yPos);
                                    ctx.stroke();

                                    // ç»˜åˆ¶åœ†ç‚¹
                                    ctx.setLineDash([]);
                                    ctx.fillStyle = color;
                                    ctx.beginPath();
                                    ctx.arc(xPos, yPos, 3, 0, Math.PI * 2);
                                    ctx.fill();

                                    // ç»˜åˆ¶æ ‡ç­¾èƒŒæ™¯
                                    const text = `${label}: ${val.toFixed(2)}`;
                                    ctx.font = 'bold 10px JetBrains Mono';
                                    const textWidth = ctx.measureText(text).width;
                                    const bgWidth = textWidth + 10;
                                    const bgHeight = 16;

                                    const bgX = right + 5;
                                    const bgY = yPos - bgHeight / 2;

                                    ctx.fillStyle = color;
                                    // ç®€å•çš„åœ†è§’çŸ©å½¢
                                    this.drawRoundedRect(ctx, bgX, bgY, bgWidth, bgHeight, 4);
                                    ctx.fill();

                                    // ç»˜åˆ¶æ–‡å­—
                                    ctx.fillStyle = '#fff';
                                    ctx.textAlign = 'center';
                                    ctx.textBaseline = 'middle';
                                    ctx.fillText(text, bgX + bgWidth / 2, yPos);
                                    ctx.restore();
                                };

                                drawLabel(maxPrice, 'H', 'rgba(239, 68, 68, 0.8)');
                                drawLabel(minPrice, 'L', 'rgba(34, 197, 94, 0.8)');
                            }
                        }]
                    });

                    // åº”ç”¨åˆå§‹ x è½´èŒƒå›´
                    this.applyChartRange();
                },

                // è¾…åŠ©å‡½æ•°ï¼šç»˜åˆ¶åœ†è§’çŸ©å½¢
                drawRoundedRect(ctx, x, y, width, height, radius) {
                    ctx.beginPath();
                    ctx.moveTo(x + radius, y);
                    ctx.lineTo(x + width - radius, y);
                    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                    ctx.lineTo(x + width, y + height - radius);
                    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                    ctx.lineTo(x + radius, y + height);
                    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                    ctx.lineTo(x, y + radius);
                    ctx.quadraticCurveTo(x, y, x + radius, y);
                    ctx.closePath();
                },

                updateChartData(newData) {
                    // å¦‚æœå›¾è¡¨æœªåˆå§‹åŒ–ï¼Œå°è¯•åˆå§‹åŒ–
                    if (!this.chartInstance) {
                        const canvas = document.getElementById('priceChart');
                        if (canvas && this.historyData.length > 0) {
                            this.initChart();
                        }
                        return;
                    }

                    this.historyData.push(newData);
                    const now = Date.now() / 1000;
                    if (this.historyData.length > 1000) {
                        this.historyData = this.historyData.filter(h => h.timestamp > now - 86400);
                    }
                    const chartData = this.processDataForChart(this.historyData);
                    this.chartInstance.data.datasets[0].data = chartData;
                    this.applyChartRange();
                    this.chartInstance.update('none');
                },

                // ==================== åŸºé‡‘é€»è¾‘ ====================
                async fetchFunds(fast = true) {
                    try {
                        const res = await fetch(`/api/funds?fast=${fast ? '1' : '0'}`);
                        const data = await res.json();
                        if (data.success) {
                            // åˆå¹¶æ•°æ®ä»¥ä¿ç•™åŠ¨ç”»çŠ¶æ€
                            const newMap = new Map(data.data.map(f => [f.code, f]));

                            // æ›´æ–°ç°æœ‰åˆ—è¡¨æˆ–æ·»åŠ æ–°é¡¹
                            this.funds = data.data.map(newFund => {
                                const oldFund = this.funds.find(f => f.code === newFund.code);
                                let animating = oldFund ? oldFund.animating : false;
                                let changeType = oldFund ? oldFund.changeType : ''; // 'up', 'down' or ''

                                if (oldFund && (oldFund.change !== newFund.change || oldFund.price !== newFund.price)) {
                                    animating = true;
                                    // ç¡®å®šå˜åŠ¨æ–¹å‘
                                    if (newFund.change > oldFund.change || newFund.price > oldFund.price) {
                                        changeType = 'up';
                                    } else {
                                        changeType = 'down';
                                    }
                                }

                                return {
                                    ...newFund,
                                    animating: animating,
                                    changeType: changeType
                                };
                            });

                            // 1ç§’åå¤ä½åŠ¨ç”»çŠ¶æ€ (å¯¹åº” CSS 1s åŠ¨ç”»)
                            setTimeout(() => {
                                this.funds.forEach(f => {
                                    f.animating = false;
                                    // ä¸å»ºè®®ç«‹å³å¤ä½ changeTypeï¼Œå› ä¸º HTML è¿˜éœ€è¦å®ƒæ¥æ˜¾ç¤ºç®­å¤´ï¼Œ
                                    // ä½†å› ä¸º animating å˜ false äº†ï¼Œclass å°±ä¼šæ¶ˆå¤±
                                });
                            }, 1000);

                            this.isConnected = true;
                        }
                    } catch (e) {
                        console.error(e);
                        this.isConnected = false;
                    }
                },
                async addFund() {
                    if (!this.newFundCode || this.isAddingFund) return;

                    this.isAddingFund = true;
                    try {
                        const res = await fetch('/api/funds/add', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code: this.newFundCode })
                        });
                        const data = await res.json();
                        if (data.success) {
                            this.newFundCode = '';
                            this.fetchFunds(false); // å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®ï¼Œä¸ä½¿ç”¨ç¼“å­˜
                        } else {
                            await this.openConfirm('æ·»åŠ å¤±è´¥', data.message, 'çŸ¥é“äº†', 'bg-gray-600');
                        }
                    } catch (e) {
                        console.error(e);
                    } finally {
                        this.isAddingFund = false;
                    }
                },

                async deleteFund(code) {
                    const confirmed = await this.openConfirm('ç¡®è®¤ç§»é™¤', `ç¡®å®šä¸å†å…³æ³¨åŸºé‡‘ ${code} å—ï¼Ÿ`, 'ç§»é™¤', 'bg-red-600');
                    if (!confirmed) return;

                    try {
                        await fetch(`/api/funds/${code}`, { method: 'DELETE' });
                        this.funds = this.funds.filter(f => f.code !== code);
                        // æ— éœ€é¢å¤–åˆ·æ–°ï¼ŒVue å“åº”å¼å·²å¤„ç†
                    } catch (e) { console.error(e); }
                },

                async toggleHoldings(fund, force = false) {
                    // å¼€å¯å…¨å±æŠ½å±‰å±•ç¤ºé‡ä»“è‚¡
                    this.portfolioDrawer.fundName = fund.name;
                    this.portfolioDrawer.fundCode = fund.code;
                    if (!force) this.portfolioDrawer.holdings = [];
                    if (!force) this.portfolioDrawer.meta = { weight_coverage: 0, contribution_available: false, confidence_label: '--', report_period: '', estimate_mode: 'none' };
                    this.portfolioDrawer.visible = true;
                    this.portfolioDrawer.loading = true;

                    try {
                        const url = `/api/funds/${fund.code}/portfolio` + (force ? '?refresh=true' : '');
                        const res = await fetch(url);
                        const data = await res.json();
                        if (data.success) {
                            if (Array.isArray(data.data)) {
                                this.portfolioDrawer.holdings = data.data;
                                this.portfolioDrawer.meta = { weight_coverage: 0, contribution_available: false, confidence_label: '--', report_period: '', estimate_mode: 'none' };
                            } else {
                                this.portfolioDrawer.holdings = data.data.holdings || [];
                                this.portfolioDrawer.meta = data.data.meta || { weight_coverage: 0, contribution_available: false, confidence_label: '--', report_period: '', estimate_mode: 'none' };
                            }
                        }
                    } catch (e) {
                        console.error("è·å–é‡ä»“è‚¡å¤±è´¥", e);
                    } finally {
                        this.portfolioDrawer.loading = false;
                    }
                },

                closePortfolioDrawer() {
                    this.portfolioDrawer.visible = false;
                },

                // ==================== æŒä»“ç®¡ç†é€»è¾‘ ====================
                addFundToHoldings(fund) {
                    // ä»åŸºé‡‘å¡ç‰‡å¿«é€Ÿæ·»åŠ åˆ°æŒä»“ï¼Œé¢„å¡«åŸºé‡‘ä»£ç å’Œå½“å‰å‡€å€¼
                    this.holdingModal = {
                        visible: true,
                        isEdit: false,
                        code: fund.code,
                        costPrice: fund.price || '',
                        shares: '',
                        note: fund.name || '',
                        saving: false
                    };
                },
                isFundInHoldings(code) {
                    return this.holdings.some(h => String(h.code) === String(code));
                },

                async fetchHoldings(fast = true, background = false) {
                    if (!background) {
                        this.isLoadingHoldings = true;
                    }
                    try {
                        const res = await fetch(`/api/holdings?fast=${fast ? '1' : '0'}`);
                        const data = await res.json();
                        if (data.success) {
                            // ä¿ç•™åŠ¨ç”»çŠ¶æ€çš„åˆå¹¶é€»è¾‘
                            if (this.holdings.length > 0) {
                                this.holdings = (data.data || []).map(newH => {
                                    const oldH = this.holdings.find(o => o.code === newH.code);
                                    let animating = oldH ? oldH.animating : false;
                                    let changeType = oldH ? oldH.changeType : '';

                                    if (oldH && (oldH.change !== newH.change || oldH.price !== newH.price)) {
                                        animating = true;
                                        changeType = (newH.change > oldH.change || newH.price > oldH.price) ? 'up' : 'down';
                                    }

                                    return {
                                        ...newH,
                                        animating: animating,
                                        changeType: changeType
                                    };
                                });

                                // 1ç§’åå¤ä½
                                setTimeout(() => {
                                    this.holdings.forEach(h => {
                                        h.animating = false;
                                    });
                                }, 1000);
                            } else {
                                this.holdings = data.data || [];
                            }

                            this.holdingsSummary = data.summary || { total_cost: 0, total_value: 0, total_profit: 0, total_profit_rate: 0, count: 0 };

                            // æ•°æ®åŠ è½½å®Œæˆåæ›´æ–°åˆ—è¡¨é«˜åº¦
                            this.$nextTick(() => {
                                this.updateHoldingsListHeight();
                            });
                            // æ£€æµ‹æœ€ååŠ¨æ€æ—¶é—´æ˜¯å¦çœŸæ­£æ›´æ–°ï¼Œåªæœ‰å˜åŒ–æ—¶æ‰è§¦å‘åŠ¨ç”»
                            const newLastUpdate = data.last_update || '--';
                            const lastUpdateChanged = this.holdingsLastUpdate !== newLastUpdate;
                            this.holdingsLastUpdate = newLastUpdate;
                            
                            // è§¦å‘åŸºé‡‘é¡µæ•°å­—æ»šåŠ¨åŠ¨ç”»
                            if (this.currentView === 'fund' && this.holdings.length > 0) {
                                this.fundPriceAnimating = true;
                                setTimeout(() => {
                                    this.fundPriceAnimating = false;
                                }, 600);
                            }
                            // åªæœ‰å½“æ—¶é—´åœ¨åŸºé‡‘è§†å›¾ä¸‹çœŸæ­£å˜åŒ–æ—¶æ‰è§¦å‘é—ªçƒ
                            if (lastUpdateChanged && this.currentView === 'fund') {
                                if (this.fundTimeAnimTimer) clearTimeout(this.fundTimeAnimTimer);
                                this.fundTimeAnimating = false;
                                this.$nextTick(() => {
                                    this.fundTimeAnimating = true;
                                    this.fundTimeAnimTimer = setTimeout(() => {
                                        this.fundTimeAnimating = false;
                                        this.fundTimeAnimTimer = null;
                                    }, 800);
                                });
                            }
                        } else {
                            console.warn('åŠ è½½æŒä»“å¤±è´¥:', data.message);
                        }
                    } catch (e) {
                        console.error('è·å–æŒä»“æ•°æ®å¤±è´¥', e);
                    } finally {
                        if (!background) {
                            this.isLoadingHoldings = false;
                        }
                    }
                },

                openAddHoldingModal() {
                    this.holdingModal = {
                        visible: true,
                        isEdit: false,
                        code: '',
                        costPrice: '',
                        shares: '',
                        note: '',
                        saving: false
                    };
                },

                openEditHoldingModal(holding) {
                    this.holdingModal = {
                        visible: true,
                        isEdit: true,
                        code: holding.code,
                        costPrice: holding.cost_price,
                        shares: holding.shares,
                        note: holding.note || '',
                        saving: false
                    };
                },

                closeHoldingModal() {
                    this.holdingModal.visible = false;
                },

                async saveHolding() {
                    const { code, costPrice, shares, note } = this.holdingModal;

                    // åŸºæœ¬æ ¡éªŒ - ç¡®ä¿ code ä¸ºå­—ç¬¦ä¸²ç±»å‹
                    const codeStr = String(code || '').trim();
                    if (!codeStr || codeStr.length !== 6 || !/^\d{6}$/.test(codeStr)) {
                        await this.openConfirm('è¾“å…¥é”™è¯¯', 'è¯·è¾“å…¥æœ‰æ•ˆçš„6ä½åŸºé‡‘ä»£ç ', 'çŸ¥é“äº†', 'bg-gray-600');
                        return;
                    }
                    if (!costPrice || costPrice <= 0) {
                        await this.openConfirm('è¾“å…¥é”™è¯¯', 'æˆæœ¬ä»·å¿…é¡»å¤§äº0', 'çŸ¥é“äº†', 'bg-gray-600');
                        return;
                    }
                    if (!shares || shares <= 0) {
                        await this.openConfirm('è¾“å…¥é”™è¯¯', 'ä»½é¢å¿…é¡»å¤§äº0', 'çŸ¥é“äº†', 'bg-gray-600');
                        return;
                    }

                    this.holdingModal.saving = true;
                    try {
                        const res = await fetch('/api/holdings', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                code: codeStr,
                                cost_price: costPrice,
                                shares: shares,
                                note: note
                            })
                        });
                        const data = await res.json();
                        if (data.success) {
                            this.closeHoldingModal();
                            this.fetchHoldings(false); // å¼ºåˆ¶åˆ·æ–°åˆ—è¡¨ï¼Œä¸ä½¿ç”¨ç¼“å­˜
                        } else {
                            await this.openConfirm('ä¿å­˜å¤±è´¥', data.message, 'çŸ¥é“äº†', 'bg-gray-600');
                        }
                    } catch (e) {
                        console.error('ä¿å­˜æŒä»“å¤±è´¥', e);
                    } finally {
                        this.holdingModal.saving = false;
                    }
                },

                async deleteHolding(code) {
                    const confirmed = await this.openConfirm(
                        'ç¡®è®¤åˆ é™¤',
                        `ç¡®å®šè¦åˆ é™¤è¯¥æŒä»“è®°å½•å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`,
                        'åˆ é™¤'
                    );
                    if (!confirmed) return;

                    try {
                        const res = await fetch(`/api/holdings/${code}`, { method: 'DELETE' });
                        const data = await res.json();
                        if (data.success) {
                            this.fetchHoldings(false); // å¼ºåˆ¶åˆ·æ–°åˆ—è¡¨ï¼Œä¸ä½¿ç”¨ç¼“å­˜
                        } else {
                            await this.openConfirm('åˆ é™¤å¤±è´¥', data.message, 'çŸ¥é“äº†', 'bg-gray-600');
                        }
                    } catch (e) {
                        console.error('åˆ é™¤æŒä»“å¤±è´¥', e);
                    }
                },

                // ========== å›¾è¡¨è§†å›¾åˆ‡æ¢ ==========
                setChartViewMode(mode) {
                    // æ ¡éªŒæ¨¡å¼æœ‰æ•ˆæ€§
                    if (!['30M', '1D'].includes(mode)) {
                        console.error('æ— æ•ˆçš„å›¾è¡¨æ¨¡å¼:', mode);
                        return;
                    }
                    // é¿å…é‡å¤ç‚¹å‡»
                    if (this.chartViewMode === mode) return;

                    // è®¾ç½®åˆ‡æ¢åŠ¨ç”»æ ‡å¿—
                    this.chartSwitching = true;

                    // æ›´æ–°æ¨¡å¼
                    this.chartViewMode = mode;

                    // å»¶è¿Ÿæ‰§è¡Œå›¾è¡¨æ›´æ–°ï¼Œç»™åŠ¨ç”»ç•™å‡ºæ—¶é—´
                    setTimeout(() => {
                        // æ£€æŸ¥å›¾è¡¨å®ä¾‹æ˜¯å¦å·²åˆå§‹åŒ–
                        if (!this.chartInstance) {
                            this.chartSwitching = false;
                            return;
                        }

                        // é‡æ–°å¤„ç†æ•°æ®
                        const chartData = this.processDataForChart(this.historyData);
                        this.chartInstance.data.datasets[0].data = chartData;

                        // åº”ç”¨æ–°çš„ x è½´èŒƒå›´
                        this.applyChartRange();

                        // åˆ·æ–°å›¾è¡¨
                        this.chartInstance.update('none');

                        // å…³é—­åˆ‡æ¢åŠ¨ç”»
                        this.chartSwitching = false;
                    }, 150);
                },

                applyChartRange() {
                    // æ£€æŸ¥å›¾è¡¨å®ä¾‹æ˜¯å¦å·²åˆå§‹åŒ–
                    if (!this.chartInstance) return;

                    const now = Date.now() / 1000;
                    if (this.chartViewMode === '30M') {
                        // è¿‘30åˆ†é’Ÿï¼šå›ºå®šæ—¶é—´çª—å£
                        this.chartInstance.options.scales.x.min = now - 1800;
                        this.chartInstance.options.scales.x.max = now;
                    } else {
                        // å½“æ—¥ï¼šä»ä»Šæ—¥00:00åˆ°ç°åœ¨
                        const nowDate = new Date();
                        const todayStart = new Date(nowDate.getFullYear(), nowDate.getMonth(), nowDate.getDate());
                        const todayStartTs = todayStart.getTime() / 1000;
                        this.chartInstance.options.scales.x.min = todayStartTs;
                        this.chartInstance.options.scales.x.max = now;
                    }
                }
            },
            async mounted() {
                // åˆå§‹åŒ–åŠ è½½
                this.fetchHistory();
                this.fetchRecords();
                this.fetchSettings();
                this.fetchPrice();

                // åˆå§‹åŒ–äº¤æ˜“çŠ¶æ€ï¼ˆç­‰å¾…å®Œæˆï¼‰
                try {
                    await this.fetchTradingStatus('gold');
                    await this.fetchTradingStatus('fund');
                } catch (e) {
                    console.error('è·å–äº¤æ˜“çŠ¶æ€å¤±è´¥:', e);
                }

                // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡äº¤æ˜“çŠ¶æ€ï¼ˆç”¨äºæ£€æµ‹å¼€æ”¶ç›˜äº‹ä»¶ï¼‰
                this.tradingTimer = setInterval(this.checkTradingEvents, 1000);

                // é»˜è®¤å¯åŠ¨é‡‘ä»·è½®è¯¢ï¼ˆä¼šæ ¹æ®äº¤æ˜“çŠ¶æ€åŠ¨æ€è°ƒæ•´é¢‘ç‡ï¼‰
                this.startPricePolling();

                // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™ï¼ˆç”¨äºå¼€æ”¶ç›˜æé†’ï¼‰
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                // å“åº”å¼ç›‘å¬
                window.addEventListener('resize', this.handleResize);

                // è§¦å‘å¡ç‰‡å…¥åœºåŠ¨ç”»ï¼ˆä»…åœ¨é¦–æ¬¡åŠ è½½æ—¶ï¼‰
                if (this.isFirstLoad) {
                    this.$nextTick(() => {
                        // åŠ¨ç”»å°†åœ¨é¡µé¢åŠ è½½åè‡ªåŠ¨è§¦å‘
                        // 1.2ç§’åæ ‡è®°åŠ¨ç”»å®Œæˆï¼Œä¹‹åç§»é™¤åŠ¨ç”»ç±»
                        setTimeout(() => {
                            this.cardsAnimated = true;
                            this.isFirstLoad = false;
                        }, 1200);
                    });
                }
            },
            beforeUnmount() {
                if (this.priceTimer) clearInterval(this.priceTimer);
                if (this.fundTimer) clearInterval(this.fundTimer);
                if (this.tradingTimer) clearInterval(this.tradingTimer);
                if (this.timeAnimTimer) clearTimeout(this.timeAnimTimer);
                if (this.fundTimeAnimTimer) clearTimeout(this.fundTimeAnimTimer);
                window.removeEventListener('resize', this.handleResize);
                if (this.chartInstance) {
                    this.chartInstance.destroy();
                    this.chartInstance = null;
                }
            }
        }).mount('#app');
    </script>
</body>

</html>
