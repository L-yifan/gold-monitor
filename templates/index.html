<!DOCTYPE html>
<html lang="zh-CN" :data-theme="isDarkMode ? 'dark' : 'light'">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>国内金价实时监控系统</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui'],
                        mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular'],
                    },
                    colors: {
                        'up': '#ef4444',
                        'down': '#22c55e',
                        'card-bg': '#161b2a',
                        'page-bg': '#0b0f19',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
            // 早期主题检测: 防止页面加载时的颜色闪烁
            (function () {
                const savedTheme = localStorage.getItem('theme');
                let isDark = true;
                if (savedTheme) {
                    isDark = savedTheme === 'dark';
                } else {
                    isDark = !window.matchMedia('(prefers-color-scheme: light)').matches;
                }
                document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            })();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body class="min-h-screen font-sans overflow-x-hidden relative transition-colors duration-300"
    style="background-color: var(--theme-bg-page); color: var(--theme-text-primary);">
    <div
        class="fixed top-0 left-1/4 w-[500px] h-[500px] bg-blue-600/5 blur-[120px] rounded-full animate-blob-slow pointer-events-none -z-10">
    </div>
    <div
        class="fixed bottom-0 right-1/4 w-[600px] h-[600px] bg-purple-600/5 blur-[150px] rounded-full animate-blob-delay pointer-events-none -z-10">
    </div>

    {% raw %}
    <div id="app" v-cloak>
        <!-- 顶部导航栏 -->
        <nav class="fixed top-0 left-0 right-0 z-[60] border-b h-14 flex items-center justify-center gap-1 shadow-xl transition-colors duration-300"
            style="background-color: var(--theme-bg-nav); border-color: var(--theme-border-light);">
            <button @click="currentView = 'gold'"
                class="px-6 py-1.5 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden group"
                :class="[currentView === 'gold' ? 'bg-[var(--accent-primary)] text-[#0b0f19] shadow-lg shadow-[var(--accent-primary)]/20 nav-shimmer' : 'text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-black/5']">
                <span class="relative z-10">金价监控</span>
            </button>
            <div class="w-px h-4 mx-2 transition-colors duration-300"
                style="background-color: var(--theme-border-default);"></div>
            <button @click="currentView = 'fund'"
                class="px-6 py-1.5 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden group"
                :class="[currentView === 'fund' ? 'bg-[#3b82f6] text-white shadow-lg shadow-blue-500/20 nav-shimmer' : 'text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-black/5']">
                <span class="relative z-10">基金估值</span>
            </button>
            <!-- 主题切换按钮 -->
            <div class="absolute right-6 top-1/2 -translate-y-1/2 z-[70]">
                <label class="switch" title="切换显示模式">
                    <span class="sun">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g fill="#ffd43b">
                                <circle r="5" cy="12" cx="12"></circle>
                                <path
                                    d="m21 13h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm-17 0h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm13.66-5.66a1 1 0 0 1 -.66-.29 1 1 0 0 1 0-1.41l.71-.71a1 1 0 1 1 1.41 1.41l-.71.71a1 1 0 0 1 -.75.29zm-12.02 12.02a1 1 0 0 1 -.71-.29 1 1 0 0 1 0-1.41l.71-.66a1 1 0 0 1 1.41 1.41l-.71.71a1 1 0 0 1 -.7.24zm6.36-14.36a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm0 17a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm-5.66-14.66a1 1 0 0 1 -.7-.29l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.29zm12.02 12.02a1 1 0 0 1 -.7-.29l-.66-.71a1 1 0 0 1 1.36-1.36l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.24z">
                                </path>
                            </g>
                        </svg>
                    </span>
                    <span class="moon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                            <path
                                d="m223.5 32c-123.5 0-223.5 100.3-223.5 224s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z">
                            </path>
                        </svg>
                    </span>
                    <input type="checkbox" class="input" v-model="isDarkMode" @change="toggleTheme">
                    <span class="slider"></span>
                </label>
            </div>
        </nav>

        <!-- 全局蒙层与头部 -->
        <transition name="fade">
            <div v-if="isInitialLoading"
                class="fixed inset-0 z-[100] flex flex-col items-center justify-center transition-colors duration-300"
                style="background-color: var(--theme-bg-page);">
                <div class="w-16 h-16 border-4 border-yellow-500/20 border-t-yellow-500 rounded-full animate-spin mb-4">
                </div>
                <p class="text-yellow-500 font-bold animate-pulse">正在连接数据源...</p>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="fetchError && !isInitialLoading"
                class="fixed inset-0 z-[90] backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center transition-colors duration-300"
                style="background-color: rgba(var(--theme-bg-page-rgb, 11, 15, 25), 0.95);">
                <div class="mb-6" style="color: var(--theme-text-muted);">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-20 h-20 opacity-40">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">服务暂时不可用</h2>
                <p class="text-gray-400 mb-8 max-w-md">{{ fetchError }}. 请检查网络连接或稍后再试.</p>
                <button @click="fetchPrice"
                    class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold px-8 py-3 rounded-xl transition-all shadow-lg active:scale-95">手动重试</button>
                <p class="mt-4 text-xs text-gray-600">Au99.99 实时监控系统</p>
            </div>
        </transition>

        <!-- 顶部标题栏 -->
        <header class="fixed top-14 left-0 right-0 z-50 border-b py-4 px-6 shadow-sm transition-colors duration-300"
            style="background-color: var(--theme-bg-page); border-color: var(--theme-border-light);">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex-1 flex items-center gap-3">
                    <div class="flex flex-col">
                        <h1 class="text-xl font-extrabold tracking-tight hidden sm:block"
                            :class="currentView === 'gold' ? 'text-[var(--accent-primary)]' : 'text-blue-500'">{{
                            currentView === 'gold' ? 'Au99.99' : '基金估值' }}</h1>
                        <h1 class="text-lg font-extrabold sm:hidden"
                            :class="currentView === 'gold' ? 'text-[var(--accent-primary)]' : 'text-blue-500'">{{
                            currentView === 'gold' ? 'Au99.99' : '基金' }}</h1>
                        <p
                            class="text-[var(--theme-text-muted)] text-[10px] font-bold uppercase tracking-widest mt-0.5">
                            {{ currentView === 'gold' ? (currentData.source || 'SGE') + '行情数据' : '实时估值监控' }}</p>
                    </div>

                    <!-- 黄金状态胶囊 -->
                    <div v-if="currentView === 'gold'" class="status-pill ml-2"
                        :class="{ 'gold-active': tradingStatus.is_trading_time, 'gold-holiday': tradingStatus.is_holiday, 'gold-closed': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }"
                        :title="tradingStatus.phase_name + (tradingStatus.time_until_next ? ' | ' + formatCountdown(tradingStatus.time_until_next, tradingStatus.next_event_time) + tradingStatus.next_event_name : '')">
                        <div class="led-dot"
                            :class="{ 'active': tradingStatus.is_trading_time, 'holiday': tradingStatus.is_holiday, 'closed': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }">
                        </div>
                        <span class="pill-phase"
                            :class="{ 'text-amber-400': tradingStatus.is_trading_time, 'text-amber-300': tradingStatus.is_holiday, 'text-gray-400': !tradingStatus.is_trading_time && !tradingStatus.is_holiday }">{{
                            tradingStatus.phase_name }}</span>
                        <div class="pill-details">
                            <span class="w-px h-2.5 transition-colors duration-300"
                                style="background-color: var(--theme-border-default);"></span>
                            <span class="text-[10px] text-[var(--theme-text-secondary)]">{{ tradingStatus.weekday_name
                                }}</span>
                            <template v-if="tradingStatus.time_until_next">
                                <span class="w-px h-2.5 transition-colors duration-300"
                                    style="background-color: var(--theme-border-default);"></span>
                                <span class="font-mono text-[var(--theme-text-secondary)]">
                                    <template v-if="tradingStatus.is_holiday && getHolidayName()">{{ getHolidayName() }}
                                        . {{ formatCountdown(tradingStatus.time_until_next,
                                        tradingStatus.next_event_time) }}开</template>
                                    <template v-else>{{ formatCountdown(tradingStatus.time_until_next,
                                        tradingStatus.next_event_time) }}{{ tradingStatus.next_event_name }}</template>
                                </span>
                            </template>
                        </div>
                    </div>

                    <!-- 基金状态胶囊 -->
                    <div v-if="currentView === 'fund'" class="status-pill ml-2"
                        :class="{ 'fund-active': fundTradingStatus.is_trading_time, 'fund-holiday': fundTradingStatus.is_holiday, 'fund-closed': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }"
                        :title="fundTradingStatus.phase_name">
                        <div class="led-dot"
                            :class="{ 'fund-active': fundTradingStatus.is_trading_time, 'fund-holiday': fundTradingStatus.is_holiday, 'fund-closed': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }">
                        </div>
                        <span class="pill-phase"
                            :class="{ 'text-blue-400': fundTradingStatus.is_trading_time, 'text-[#60a5fa]': fundTradingStatus.is_holiday, 'text-gray-400': !fundTradingStatus.is_trading_time && !fundTradingStatus.is_holiday }">{{
                            fundTradingStatus.phase_name }}</span>
                        <div class="pill-details">
                            <span class="w-px h-2.5 transition-colors duration-300"
                                style="background-color: var(--theme-border-default);"></span>
                            <span class="text-[10px] text-[var(--theme-text-secondary)]">{{
                                fundTradingStatus.weekday_name }}</span>
                            <template v-if="fundTradingStatus.time_until_next">
                                <span class="w-px h-2.5 transition-colors duration-300"
                                    style="background-color: var(--theme-border-default);"></span>
                                <span class="font-mono text-[var(--theme-text-secondary)]">
                                    <template v-if="fundTradingStatus.is_holiday && getHolidayName()">{{
                                        getHolidayName() }} . {{ formatCountdown(fundTradingStatus.time_until_next,
                                        fundTradingStatus.next_event_time) }}开</template>
                                    <template v-else>{{ formatCountdown(fundTradingStatus.time_until_next,
                                        fundTradingStatus.next_event_time) }}{{ fundTradingStatus.next_event_name
                                        }}</template>
                                </span>
                            </template>
                        </div>
                    </div>

                    <!-- 交易状态提醒开关 -->
                    <button @click="settings.trading_events_enabled = !settings.trading_events_enabled; saveSettings()"
                        class="p-2 rounded-full transition-all duration-300 ml-1 flex items-center justify-center"
                        :class="[settings.trading_events_enabled ? (currentView === 'gold' ? 'text-[var(--accent-light)] bg-[var(--accent-primary)]/10 hover:bg-[var(--accent-primary)]/20' : 'text-blue-400 bg-blue-400/10 hover:bg-blue-400/20') : 'text-[var(--theme-text-muted)] bg-black/5 hover:bg-black/10']"
                        :title="settings.trading_events_enabled ? '状态提醒已开启' : '状态提醒已禁用'">
                        <svg v-if="settings.trading_events_enabled" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                        </svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.6" stroke="currentColor" class="w-5 h-5 opacity-40">
                            <defs>
                                <mask id="bell-off-mask">
                                    <rect width="24" height="24" fill="white" />
                                    <path d="M3 3l18 18" stroke="black" stroke-width="3" stroke-linecap="round" />
                                </mask>
                            </defs>
                            <g mask="url(#bell-off-mask)">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                            </g>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3l18 18" />
                        </svg>
                    </button>
                </div>

                <div class="flex-1 flex justify-center items-center">
                    <!-- 金价显示 -->
                    <div v-if="currentView === 'gold'"
                        class="px-4 py-1.5 rounded-xl border price-container-breath flex items-center gap-3 hw-accel transition-colors duration-300"
                        :class="{'pop-effect': priceAnimating}"
                        style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-light);">
                        <span class="digit-container">
                            <span class="text-2xl font-black font-mono tracking-tighter transition-colors duration-300"
                                :class="[isPriceUp ? 'text-red-500' : 'text-green-500', { 'digit-roll': priceAnimating }]">{{
                                formatPrice(currentData.price) }}</span>
                        </span>
                        <span class="text-xs font-black font-mono px-2 py-0.5 rounded transition-colors duration-300"
                            style="background-color: rgba(0,0,0,0.05);"
                            :class="isPriceUp ? 'text-red-400 price-text-breath-up' : 'text-green-400 price-text-breath-down'">{{
                            currentData.change >= 0 ? '+' : '' }}{{ currentData.change }}</span>
                    </div>

                    <div v-if="currentView === 'fund'"
                        class="px-4 py-1.5 rounded-xl border flex items-center gap-4 hw-accel transition-colors duration-300"
                        style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-light);">
                        <div class="flex flex-col items-center">
                            <span class="text-[9px] font-bold uppercase tracking-widest"
                                style="color: var(--theme-text-muted);">预估今日收益</span>
                            <span class="digit-container">
                                <span class="text-lg font-black font-mono"
                                    :class="[(holdingsSummary.total_today_profit || 0) >= 0 ? 'text-red-500' : 'text-green-500', { 'digit-roll': fundPriceAnimating }]">{{
                                    (holdingsSummary.total_today_profit || 0) >= 0 ? '+' : '' }}{{
                                    (holdingsSummary.total_today_profit || 0).toFixed(0) }}</span>
                            </span>
                        </div>
                        <div class="w-px h-8 transition-colors duration-300"
                            style="background-color: var(--theme-border-default);"></div>
                        <div class="flex flex-col items-center">
                            <span class="text-[9px] font-bold uppercase tracking-widest"
                                style="color: var(--theme-text-muted);">总盈亏</span>
                            <span class="digit-container">
                                <span class="text-lg font-black font-mono"
                                    :class="[holdingsSummary.total_profit >= 0 ? 'text-red-500' : 'text-green-500', { 'digit-roll': fundPriceAnimating }]">{{
                                    holdingsSummary.total_profit >= 0 ? '+' : '' }}{{
                                    holdingsSummary.total_profit.toFixed(0) }}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="flex-1 text-right flex items-center justify-end gap-3">
                    <div>
                        <p
                            class="text-[var(--theme-text-muted)] text-[10px] uppercase font-bold tracking-widest leading-none mb-1 hidden sm:block">
                            {{ currentView === 'gold' ? '更新时间' : '最后动态' }}</p>
                        <p class="text-sm sm:text-lg font-mono font-bold text-[var(--theme-text-secondary)]"
                            :class="{'time-pop': currentView === 'gold' && timeAnimating, 'time-pop-fund': currentView === 'fund' && fundTimeAnimating}">
                            {{ currentView === 'gold' ? (currentData.time_str || '--:--:--') : holdingsLastUpdate }}</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- 页面状态指示器 -->
        <div class="fixed bottom-4 right-4 flex items-center gap-2 px-4 py-2 rounded-full shadow-lg border z-50 transition-colors duration-300"
            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
            <span class="w-3 h-3 rounded-full transition-colors duration-300"
                :class="[isConnected ? 'bg-green-500 animate-pulse' : 'bg-red-500']"></span>
            <span class="text-sm font-medium">{{ isConnected ? '实时监控中' : '连接中断' }}</span>
        </div>

        <!-- 金价视图内容 -->
        <div v-if="currentView === 'gold'" class="pt-40">
            <main class="max-w-7xl mx-auto p-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 space-y-6">
                        <div class="lg:sticky lg:top-28 space-y-6"
                            :class="{'card-enter delay-0': !isInitialLoading && isFirstLoad && !cardsAnimated}">
                            <div class="rounded-2xl p-6 transition-all duration-500 shadow-2xl relative overflow-hidden"
                                :class="[{'pop-effect': priceAnimating}]"
                                :style="{ backgroundColor: 'var(--theme-bg-card)', border: '1px solid var(--theme-border-light)', borderLeft: '3px solid ' + (isPriceUp ? '#ef4444' : '#22c55e') }">
                                <p class="text-[10px] font-black uppercase tracking-widest mb-2 opacity-80"
                                    style="color: var(--theme-text-muted);">Au99.99 实时成交价 (元/克)</p>
                                <div class="flex items-baseline gap-3">
                                    <span class="digit-container">
                                        <span
                                            class="text-5xl font-black font-mono tracking-tighter transition-transform duration-300"
                                            :class="[isPriceUp ? 'text-red-500' : 'text-green-500', { 'digit-roll': priceAnimating }]">{{
                                            formatPrice(currentData.price) }}</span>
                                    </span>
                                    <span class="text-xl font-black font-mono"
                                        :class="isPriceUp ? 'text-red-400 price-text-breath-up' : 'text-green-400 price-text-breath-down'">{{
                                        currentData.change >= 0 ? '+' : '' }}{{ currentData.change }}</span>
                                    <span v-if="currentData.source"
                                        class="text-[9px] px-1.5 py-0.5 rounded border font-bold uppercase ml-auto self-start mt-2 transition-colors duration-300"
                                        :title="'数据来源: ' + currentData.source"
                                        style="background-color: rgba(0,0,0,0.05); border-color: var(--theme-border-light); color: var(--theme-text-muted);">{{
                                        currentData.source }}</span>
                                </div>
                                <div class="mt-6 grid grid-cols-2 gap-x-6 gap-y-4 text-sm transition-colors duration-300"
                                    style="color: var(--theme-text-secondary);">
                                    <div class="flex justify-between items-end border-b pb-1 transition-colors duration-300"
                                        style="border-color: var(--theme-border-light);">
                                        <p class="text-[10px] font-bold uppercase"
                                            style="color: var(--theme-text-muted);">今开</p>
                                        <p class="font-mono font-bold">{{ formatPrice(currentData.open) }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b pb-1 transition-colors duration-300"
                                        style="border-color: var(--theme-border-light);">
                                        <p class="text-[10px] font-bold uppercase"
                                            style="color: var(--theme-text-muted);">昨收</p>
                                        <p class="font-mono font-bold text-gray-500">{{
                                            formatPrice(currentData.yesterday_close) }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b pb-1 transition-colors duration-300"
                                        style="border-color: var(--theme-border-light);">
                                        <p class="text-[10px] font-bold uppercase"
                                            style="color: var(--theme-text-muted);">最高</p>
                                        <p class="font-mono font-bold text-red-500/80">{{ formatPrice(currentData.high)
                                            }}</p>
                                    </div>
                                    <div class="flex justify-between items-end border-b pb-1 transition-colors duration-300"
                                        style="border-color: var(--theme-border-light);">
                                        <p class="text-[10px] font-bold uppercase"
                                            style="color: var(--theme-text-muted);">最低</p>
                                        <p class="font-mono font-bold text-green-500/80">{{ formatPrice(currentData.low)
                                            }}</p>
                                    </div>
                                </div>
                                <div v-if="currentData.volatility"
                                    class="mt-4 pt-4 border-t grid grid-cols-2 gap-4 text-sm opacity-90 transition-colors duration-300"
                                    style="border-color: var(--theme-border-default); color: var(--theme-text-primary);">
                                    <div class="col-span-2 flex justify-between items-center mb-1">
                                        <span class="text-xs font-bold text-yellow-400/80">当日波动摘要</span>
                                        <span class="text-[10px] opacity-40">基于 {{ currentData.count }} 条样本</span>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">当日最高</p>
                                        <p class="font-mono">{{ formatPrice(currentData.high_24h) }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">当日最低</p>
                                        <p class="font-mono">{{ formatPrice(currentData.low_24h) }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">当日振幅</p>
                                        <p class="font-mono text-yellow-300">{{ currentData.volatility }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs opacity-60">当日均价</p>
                                        <p class="font-mono">{{ formatPrice(currentData.avg_24h) }}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="rounded-2xl p-6 shadow-xl border transition-colors duration-300"
                                :class="{'card-enter delay-1': !isInitialLoading && isFirstLoad && !cardsAnimated}"
                                style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                                <h3
                                    class="text-sm font-black mb-4 text-[var(--theme-text-primary)] uppercase tracking-widest flex items-center gap-2">
                                    <span class="w-1 h-3 bg-yellow-500 rounded-full"></span>我的买入成本
                                </h3>
                                <div class="grid grid-cols-5 gap-2">
                                    <div class="col-span-3 flex">
                                        <input type="number" v-model.number="buyPrice" @focus="handleInputFocus($event)"
                                            @blur="handleInputBlur"
                                            class="w-full border rounded-l-lg px-4 py-3 text-xl font-mono focus:outline-none focus:border-[var(--accent-primary)] transition-colors"
                                            style="background-color: var(--theme-bg-input); border-color: var(--theme-border-default); color: var(--theme-text-primary);"
                                            placeholder="买入价" step="0.01">
                                        <button @click="resetToCurrent"
                                            class="px-3 py-3 rounded-r-lg transition border-l btn-reset-rotate"
                                            style="background-color: var(--theme-bg-hover); border-color: var(--theme-border-default); color: var(--theme-text-secondary);"
                                            title="重置为当前价格">
                                            <span class="btn-reset-icon flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                    stroke-width="2" stroke="currentColor" class="w-4 h-4">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                                </svg>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="col-span-2 relative">
                                        <input type="number" v-model.number="buyWeight"
                                            @focus="handleInputFocus($event)"
                                            class="w-full border rounded-lg px-4 py-3 text-xl font-mono focus:outline-none focus:border-[var(--accent-primary)] transition-colors text-right pr-8"
                                            style="background-color: var(--theme-bg-input); border-color: var(--theme-border-default); color: var(--theme-text-primary);"
                                            placeholder="克数" step="1">
                                        <span
                                            class="absolute right-3 top-1/2 -translate-y-1/2 text-sm pointer-events-none"
                                            style="color: var(--theme-text-muted);">g</span>
                                    </div>
                                </div>
                                <p class="text-sm mt-2 flex justify-between" style="color: var(--theme-text-muted);">
                                    <span>* 手续费率: 0.5%</span>
                                    <span v-if="buyPrice > 0" class="text-yellow-500/80">持仓: {{ buyWeight > 0 ?
                                        buyWeight : '--' }}g @ {{ buyPrice.toFixed(2) }}</span>
                                    <span v-else style="color: var(--theme-text-muted);">未设置</span>
                                </p>
                                <hr class="my-4 transition-colors duration-300"
                                    style="border-color: var(--theme-border-light);">
                                <button @click="recordPrice" :disabled="!(buyPrice > 0)"
                                    class="w-full font-bold py-3 rounded-xl transition shadow-lg btn-premium-breath flex justify-center items-center gap-2 text-sm"
                                    :class="buyPrice > 0 ? 'bg-[var(--accent-primary)] hover:bg-[var(--accent-light)] text-black hover:shadow-[var(--accent-primary)]/30' : 'cursor-not-allowed'"
                                    :style="buyPrice > 0 ? '' : 'background-color: var(--theme-bg-hover); color: var(--theme-text-muted);'"><span>记录当前价格</span>
                                    <span v-if="isRecording" class="flex items-center justify-center ml-1">
                                        <svg class="animate-spin h-4 w-4 text-black" xmlns="http://www.w3.org/2000/svg"
                                            fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                            </path>
                                        </svg>
                                    </span>
                                </button>
                            </div>

                            <div class="rounded-2xl p-6 shadow-lg border transition-all duration-300"
                                :class="[{'opacity-40 grayscale': !(buyPrice > 0)}, {'card-enter delay-2': !isInitialLoading && isFirstLoad && !cardsAnimated}]"
                                style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                                <h3 class="text-lg font-semibold mb-4">当前盈亏状态</h3>
                                <div class="text-center py-4">
                                    <p class="text-gray-400 text-sm">若现在卖出 (扣除手续费后)</p>
                                    <p class="text-4xl font-bold font-mono my-2"
                                        :class="currentProfit.rate >= 0 ? 'text-red-500' : 'text-green-500'">{{ buyPrice
                                        > 0 ? (currentProfit.rate >= 0 ? '+' : '') + currentProfit.rate + '%' : '--%' }}
                                    </p>
                                    <p class="text-gray-500 text-sm font-mono">{{ buyWeight > 0 ? '总盈亏' : '每克盈亏'
                                        }}:<span class="text-lg font-bold"
                                            :class="currentProfit.amount >= 0 ? 'text-red-400' : 'text-green-400'">{{
                                            buyPrice > 0 ? (currentProfit.amount >= 0 ? '+' : '') + currentProfit.amount
                                            + ' 元' : '-- 元' }}</span></p>
                                </div>
                                <div class="mt-4 relative pt-6">
                                    <div class="flex justify-between text-[10px] text-gray-500 mb-1 absolute top-0 w-full transition-colors duration-300"
                                        style="color: var(--theme-text-muted);">
                                        <span class="absolute left-0">-10%</span>
                                        <span class="absolute"
                                            style="left: 33.3333%; transform: translateX(-50%); color: var(--theme-text-secondary); font-weight: bold;">0%</span>
                                        <span class="absolute right-0">+20%</span>
                                    </div>
                                    <div class="h-1.5 bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden relative transition-colors duration-300"
                                        style="background-color: var(--theme-bg-subtle);">
                                        <!-- Zero point reference line -->
                                        <div class="absolute h-full w-0.5 bg-gray-400 dark:bg-gray-600 left-[33.3333%] z-10 transition-colors duration-300"
                                            style="background-color: var(--theme-border-default);"></div>

                                        <!-- Progress Fill -->
                                        <div class="h-full transition-all duration-700 ease-out relative"
                                            :style="buyPrice > 0 ? profitBarStyle : {width: '0%', left: '33.3333%'}"
                                            :class="currentProfit.rate >= 0 ? 'bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.4)]' : 'bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.4)]'">
                                        </div>
                                    </div>
                                    <!-- Current Value Marker -->
                                    <div v-if="buyPrice > 0" class="profit-marker transition-all duration-700 ease-out"
                                        :style="profitMarkerStyle"
                                        :class="currentProfit.rate >= 0 ? 'marker-up' : 'marker-down'">
                                        <div class="marker-tooltip">{{ (currentProfit.rate >= 0 ? '+' : '') +
                                            currentProfit.rate }}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-2 space-y-6">
                        <div class="rounded-2xl p-6 shadow-lg border transition-colors duration-300"
                            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                            <!-- 标题栏 - 始终可见 -->
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                                <div class="flex items-center gap-4">
                                    <h3 class="text-lg font-semibold">价格走势</h3>
                                    <div class="flex p-1 rounded-lg border transition-colors duration-300"
                                        style="background-color: rgba(0,0,0,0.05); border-color: var(--theme-border-default);">
                                        <button @click="setChartViewMode('30M')"
                                            class="px-3 py-1 text-xs rounded-md transition-all"
                                            :class="chartViewMode === '30M' ? 'bg-[var(--accent-primary)] text-black font-bold shadow-lg' : ''"
                                            :style="chartViewMode !== '30M' ? 'color: var(--theme-text-secondary);' : ''">30分钟</button>
                                        <button @click="setChartViewMode('1D')"
                                            class="px-3 py-1 text-xs rounded-md transition-all"
                                            :class="chartViewMode === '1D' ? 'bg-[var(--accent-primary)] text-black font-bold shadow-lg' : ''"
                                            :style="chartViewMode !== '1D' ? 'color: var(--theme-text-secondary);' : ''">当日</button>
                                    </div>
                                </div>
                                <span class="text-gray-500 text-[10px] sm:text-xs flex items-center gap-2"><span
                                        class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>每5秒更新</span>
                            </div>

                            <!-- 图表容器 - 仅图表应用裁剪揭示动画 -->
                            <div class="h-64 relative overflow-hidden rounded-lg" :class="chartContainerClass">
                                <canvas id="priceChart" ref="priceChart" class="w-full h-full"></canvas>
                            </div>
                        </div>

                        <div class="rounded-2xl p-6 shadow-lg border transition-colors duration-300"
                            :class="{'card-enter delay-3': !isInitialLoading && isFirstLoad && !cardsAnimated}"
                            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-[var(--accent-primary)]">价格预警 (浏览器通知)</h3>
                                <div class="flex items-center gap-3">
                                    <button @click="resetAlertsToDefault" class="btn-reset-sm">重置为 ±3%</button>
                                    <label class="custom-switch">
                                        <input type="checkbox" v-model="settings.enabled" @change="saveSettings"
                                            class="sr-only">
                                        <div class="switch-track" :class="{ 'active': settings.enabled }">
                                            <span class="switch-icon switch-on-label">ON</span>
                                            <span class="switch-icon switch-off-label">OFF</span>
                                            <div class="switch-thumb"></div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs block mb-1" style="color: var(--theme-text-muted);">金价高于
                                        (元/克)</label>
                                    <input type="number" v-model.number="settings.high" @blur="saveSettings"
                                        class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[var(--accent-primary)] transition-colors"
                                        style="background-color: var(--theme-bg-input); border-color: var(--theme-border-default); color: var(--theme-text-primary);"
                                        placeholder="0.00" step="0.01">
                                </div>
                                <div>
                                    <label class="text-xs block mb-1" style="color: var(--theme-text-muted);">金价低于
                                        (元/克)</label>
                                    <input type="number" v-model.number="settings.low" @blur="saveSettings"
                                        class="w-full border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-[var(--accent-primary)] transition-colors"
                                        style="background-color: var(--theme-bg-input); border-color: var(--theme-border-default); color: var(--theme-text-primary);"
                                        placeholder="0.00" step="0.01">
                                </div>
                            </div>
                            <p class="text-[10px] mt-3 italic" style="color: var(--theme-text-muted);">*
                                开启后请确保允许浏览器通知。触发后将进入 5 分钟冷却期。</p>
                        </div>

                        <div class="rounded-2xl p-6 shadow-lg border transition-all duration-300"
                            :class="[{'opacity-40 grayscale': !(buyPrice > 0)}, {'card-enter delay-4': !isInitialLoading && isFirstLoad && !cardsAnimated}]"
                            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                            <h3 class="text-lg font-semibold mb-4 text-[var(--accent-primary)]">目标卖出价格</h3>
                            <div class="overflow-x-visible pr-2">
                                <table class="w-full">
                                    <thead>
                                        <tr class="text-sm border-b"
                                            style="color: var(--theme-text-muted); border-color: var(--theme-border-light);">
                                            <th class="text-left py-3">目标盈利</th>
                                            <th class="text-right py-3">{{ buyWeight > 0 ? '总盈利' : '每克盈利' }}</th>
                                            <th class="text-right py-3">需涨至</th>
                                            <th class="text-right py-3">实际涨幅</th>
                                            <th class="text-right py-3">距目标</th>
                                            <th class="text-right py-3">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template v-if="buyPrice > 0">
                                            <tr v-for="target in targetTable" :key="target.percent"
                                                class="border-b transition-all duration-200 target-row"
                                                :class="{'target-reached': target.reached}"
                                                style="border-color: var(--theme-border-light);">
                                                <td class="py-4"><span class="font-bold"
                                                        :class="target.reached ? 'text-red-400' : 'text-yellow-400'">+{{
                                                        target.percent }}%</span></td>
                                                <td class="text-right py-4 font-mono text-blue-400">{{
                                                    target.profitAmount }} 元</td>
                                                <td class="text-right py-4 font-mono text-lg"
                                                    style="color: var(--theme-text-primary);">{{ target.sellPrice }}
                                                </td>
                                                <td class="text-right py-4 font-mono"
                                                    style="color: var(--theme-text-muted);">+{{ target.requiredGain }}%
                                                </td>
                                                <td class="text-right py-4 font-mono">
                                                    <span v-if="target.reached"
                                                        class="text-red-400 font-bold">已达成</span>
                                                    <span v-else style="color: var(--theme-text-muted);">{{
                                                        target.progress }}%</span>
                                                </td>
                                                <td class="text-right py-4">
                                                    <span v-if="target.reached"
                                                        class="px-2 py-1 text-red-400 rounded text-xs border"
                                                        style="background-color: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">可卖出</span>
                                                    <span v-else class="px-2 py-1 rounded text-xs"
                                                        style="background-color: var(--theme-bg-hover); color: var(--theme-text-muted);">等待中</span>
                                                </td>
                                            </tr>
                                        </template>
                                        <tr v-else>
                                            <td colspan="6" class="py-12 text-center italic"
                                                style="color: var(--theme-text-muted);">请输入买入成本以计算目标</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="rounded-2xl p-6 shadow-lg border transition-colors duration-300"
                            :class="{'card-enter delay-5': isFirstLoad && !cardsAnimated}"
                            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">价格记录</h3>
                                <div class="flex gap-2">
                                    <button @click="exportCSV" class="btn-action-base btn-action-blue">导出记录</button>
                                    <button @click="exportHistoryCSV"
                                        class="btn-action-base btn-action-yellow">导出当日历史</button>
                                    <button @click="clearRecords" class="btn-action-base btn-action-red">清空记录</button>
                                </div>
                            </div>
                            <div class="space-y-0 max-h-64 overflow-y-auto overflow-x-hidden pr-2 custom-scrollbar">
                                <div v-if="records.length === 0" class="text-center py-8 rounded-lg"
                                    style="color: var(--theme-text-muted);">暂无记录</div>
                                <transition-group name="fade">
                                    <div v-for="(record, index) in reversedRecords" :key="index"
                                        class="flex justify-between items-center py-3 px-2 -mx-2 rounded-lg transition-all duration-200 cursor-default record-item"
                                        :class="{'border-t': index > 0}"
                                        style="border-color: var(--theme-border-light);">
                                        <div>
                                            <span class="font-mono text-lg" style="color: var(--accent-light);">{{
                                                formatPrice(record.price) }}</span>
                                            <span class="text-sm ml-2 font-mono"
                                                style="color: var(--theme-text-muted);">{{ record.time_str }}</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="font-mono font-bold"
                                                :class="parseFloat(record.profit) >= 0 ? 'text-red-400' : 'text-green-400'">{{
                                                parseFloat(record.profit) >= 0 ? '+' : '' }}{{ record.profit }}%</span>
                                        </div>
                                    </div>
                                </transition-group>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- 基金视图内容 -->
        <div v-if="currentView === 'fund'" class="pt-40 max-w-7xl mx-auto min-h-screen">
            <div class="px-4 pt-4">
                <div class="mb-8 backdrop-blur-2xl rounded-3xl border shadow-2xl overflow-hidden transition-colors duration-300"
                    style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                    <div class="px-6 py-5 border-b flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 transition-colors duration-300"
                        style="border-color: var(--theme-border-light);">
                        <div class="flex items-center gap-4">
                            <div>
                                <h2 class="text-xl font-bold tracking-tight" style="color: var(--theme-text-header);">
                                    我的持仓</h2>
                                <div class="flex items-center gap-2 mt-0.5">
                                    <span v-if="holdingsSummary.count > 0"
                                        class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded-md font-bold uppercase tracking-wider">{{
                                        holdingsSummary.count }} 只基金</span>
                                    <span class="text-[10px] text-gray-500 font-medium tracking-tight">{{
                                        holdingsLastUpdate }}</span>
                                </div>
                            </div>
                            <div class="w-px h-8 bg-white/10 mx-2"></div>
                        </div>
                        <div class="flex items-center gap-2 self-end sm:self-auto px-1.5 py-1.5 rounded-2xl shadow-inner"
                            style="background-color: var(--theme-bg-subtle); border: 1px solid var(--theme-border-default);">
                            <button @click="openAddHoldingModal()"
                                class="group flex items-center gap-2 text-[12px] bg-blue-500/15 hover:bg-blue-500/25 text-blue-300 px-4 py-2 rounded-xl font-black transition-all border border-blue-400/20 active:scale-95"
                                title="添加持仓"><span
                                    class="text-[14px] transition-transform duration-300 group-hover:scale-125">+</span><span>添加</span></button>
                            <button @click="fetchHoldings" :disabled="isLoadingHoldings"
                                class="group flex items-center gap-2 text-[12px] px-4 py-2 rounded-xl font-black transition-all border active:scale-95"
                                style="background-color: var(--theme-bg-surface); color: var(--theme-text-secondary); border-color: var(--theme-border-default);"
                                :class="{'opacity-50 cursor-not-allowed': isLoadingHoldings}" title="刷新数据">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" class="w-4 h-4 transition-transform duration-500"
                                    :class="isLoadingHoldings ? 'animate-spin' : 'group-hover:rotate-180'">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                                <span>刷新持仓</span>
                            </button>
                        </div>
                    </div>

                    <div v-if="holdingsSummary.count > 0"
                        class="px-6 py-6 grid grid-cols-2 xl:grid-cols-5 gap-4 bg-gradient-to-b from-transparent to-black/5 border-b relative overflow-hidden"
                        style="border-color: var(--theme-border-light);">
                        <div
                            class="absolute -right-16 -top-16 w-32 h-32 bg-blue-500/10 blur-[60px] pointer-events-none rotate-45 animate-subtle-float">
                        </div>
                        <div class="absolute -left-20 -bottom-20 w-40 h-40 bg-purple-500/5 blur-[80px] pointer-events-none animate-subtle-float"
                            style="animation-delay: -3s;"></div>
                        <div class="flex flex-col justify-center px-3 py-3 rounded-lg border transition-all duration-300 cursor-default"
                            style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                            <span class="text-[10px] uppercase tracking-[0.2em] mb-1"
                                style="color: var(--theme-text-muted);">资产成本</span>
                            <div class="flex items-baseline gap-1.5"><span
                                    class="text-xl font-bold font-mono tracking-tighter"
                                    style="color: var(--theme-text-primary);">{{
                                    holdingsSummary.total_cost.toFixed(0) }}</span><span
                                    class="text-[9px] font-bold font-mono opacity-60"
                                    style="color: var(--theme-text-muted);">CNY</span></div>
                        </div>
                        <div class="flex flex-col justify-center px-3 py-3 rounded-lg border transition-all duration-300 cursor-default"
                            style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                            <span class="text-[10px] uppercase tracking-[0.2em] mb-1"
                                style="color: var(--theme-text-muted);">当前市值</span>
                            <div class="flex items-baseline gap-1.5"><span
                                    class="text-xl font-bold font-mono text-blue-500 tracking-tighter">{{
                                    holdingsSummary.total_value.toFixed(0) }}</span><span
                                    class="text-[9px] font-bold font-mono uppercase opacity-60"
                                    style="color: var(--theme-text-muted);">CNY</span></div>
                        </div>
                        <div class="flex flex-col justify-center px-3 py-3 rounded-lg border transition-all duration-300 cursor-default"
                            style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                            <span class="text-[10px] uppercase tracking-[0.2em] mb-1"
                                style="color: var(--theme-text-muted);">预估今日收益</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[(holdingsSummary.total_today_profit || totalTodayProfit) >= 0 ? 'text-red-500' : 'text-green-500', holdingsPulse.todayProfit ? 'animate-number-pulse' : '', { 'digit-roll': fundPriceAnimating }]">{{
                                        (holdingsSummary.total_today_profit || totalTodayProfit) >= 0 ? '+' : '' }}{{
                                        (holdingsSummary.total_today_profit || totalTodayProfit).toFixed(0) }}</span>
                                </span>
                            </div>
                        </div>
                        <div class="flex flex-col justify-center px-3 py-3 rounded-lg border transition-all duration-300 cursor-default"
                            style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                            <span class="text-[10px] uppercase tracking-[0.2em] mb-1"
                                style="color: var(--theme-text-muted);">预期收益</span>
                            <div class="flex items-baseline gap-1.5">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[holdingsSummary.total_profit >= 0 ? 'text-red-500' : 'text-green-500', holdingsPulse.totalProfit ? 'animate-number-pulse' : '', { 'digit-roll': fundPriceAnimating }]">{{
                                        holdingsSummary.total_profit >= 0 ? '+' : '' }}{{
                                        holdingsSummary.total_profit.toFixed(0) }}</span>
                                </span>
                            </div>
                        </div>
                        <div class="flex flex-col justify-center px-3 py-3 rounded-lg border transition-all duration-300 cursor-default"
                            style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                            <span class="text-[10px] uppercase tracking-[0.2em] mb-1"
                                style="color: var(--theme-text-muted);">投资回报</span>
                            <div class="flex items-baseline gap-1">
                                <span class="digit-container">
                                    <span
                                        class="text-xl font-black font-mono tracking-tighter transition-colors duration-300"
                                        :class="[holdingsSummary.total_profit_rate >= 0 ? 'text-red-500' : 'text-green-500', holdingsPulse.profitRate ? 'animate-number-pulse' : '', { 'digit-roll': fundPriceAnimating }]">{{
                                        holdingsSummary.total_profit_rate >= 0 ? '+' : '' }}{{
                                        holdingsSummary.total_profit_rate.toFixed(2) }}<span
                                            class="text-xs ml-0.5 opacity-60">%</span></span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div ref="holdingsListRef"
                        :class="['px-6 overflow-hidden duration-500 ease-in-out', holdingsListTransitionEnabled ? 'transition-all' : '', isHoldingsListCollapsed ? 'py-0 opacity-0' : 'py-8 opacity-100']"
                        :style="{ maxHeight: isHoldingsListCollapsed ? '0px' : holdingsListHeight + 'px' }">
                        <div v-if="isLoadingHoldings" class="text-center py-10" style="color: var(--theme-text-muted);">
                            <svg class="animate-spin h-8 w-8 mx-auto mb-3 text-blue-500"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="3"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <p class="text-sm font-medium">正在加载持仓数据...</p>
                        </div>
                        <div v-else-if="holdings.length === 0"
                            class="group relative flex flex-col items-center justify-center py-16 px-4 bg-white/[0.01] border-2 border-dashed border-white/5 rounded-3xl mx-5 transition-all hover:bg-white/[0.02] hover:border-blue-500/20">
                            <div
                                class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mb-4 ring-8 ring-blue-500/[0.02] group-hover:scale-110 transition-transform duration-500 text-blue-500">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                                </svg>
                            </div>
                            <h3 class="text-gray-300 font-bold text-base mb-1">开始管理您的投资</h3>
                            <p class="text-gray-600 text-[11px] mb-6 text-center max-w-[200px] leading-relaxed">
                                录入您的持仓成本，系统将自动计算盈亏，助您做出明智决策。</p>
                            <button @click="openAddHoldingModal()"
                                class="bg-blue-600 hover:bg-blue-500 text-white text-xs font-black px-6 py-2.5 rounded-full shadow-lg shadow-blue-600/20 transition-all active:scale-95 flex items-center gap-2"><span>+
                                    录入第一笔持仓</span></button>
                            <div class="absolute -right-6 -bottom-6 transform rotate-12 opacity-5"
                                style="color: var(--theme-text-primary);">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-24 h-24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                </svg>
                            </div>
                        </div>
                        <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6">
                            <div v-for="h in holdings" :key="h.code" @click="toggleHoldings(h)"
                                class="group relative rounded-2xl border transition-all duration-300 cursor-pointer overflow-hidden flex flex-col min-h-[180px]"
                                style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);"
                                :class="[h.animating && h.changeType === 'up' ? 'animate-flash-up' : '', h.animating && h.changeType === 'down' ? 'animate-flash-down' : '']">
                                <div class="absolute left-0 top-0 bottom-0 w-1"
                                    :class="h.profit_rate >= 0 ? 'bg-gradient-to-b from-red-500/80 to-red-500/20' : 'bg-gradient-to-b from-green-500/80 to-green-500/20'">
                                </div>
                                <div class="p-4 flex-1 flex flex-col justify-between">
                                    <div class="flex justify-between items-start gap-2">
                                        <div class="min-w-0 flex-1">
                                            <h4 class="font-black whitespace-normal line-clamp-2 text-[13px] tracking-tight mb-0.5 group-hover:text-blue-500 transition-colors"
                                                :title="h.name" style="color: var(--theme-text-primary);">{{ h.name }}
                                            </h4>
                                            <div class="flex items-center gap-1.5">
                                                <span
                                                    class="text-[10px] px-1.5 py-0.5 rounded font-mono border uppercase"
                                                    style="background-color: var(--theme-bg-page); color: var(--theme-text-muted); border-color: var(--theme-border-light);">{{
                                                    h.code }}</span>
                                                <span v-if="!h.data_available"
                                                    class="text-[9px] text-yellow-500 border border-yellow-500/20 px-1 rounded animate-pulse">离线</span>
                                            </div>
                                        </div>
                                        <div class="shrink-0 text-right">
                                            <div class="px-2 py-1 rounded-lg text-[11px] font-black font-mono shadow-sm transition-all duration-300 flex items-center justify-end"
                                                :class="[h.change >= 0 ? 'text-red-400 bg-red-400/5 ring-1 ring-red-400/20' : 'text-green-400 bg-green-400/5 ring-1 ring-green-400/20', h.animating ? 'pop-effect' : '']">
                                                <span>{{ h.change >= 0 ? '+' : '' }}{{ h.change }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between py-2">
                                        <div class="flex flex-col">
                                            <div class="text-[10px] font-bold uppercase tracking-widest mb-0.5 opacity-60"
                                                style="color: var(--theme-text-muted);">
                                                持有收益率</div>
                                            <div class="flex items-baseline gap-1.5"><span
                                                    class="text-2xl font-black font-mono tracking-tighter"
                                                    :class="h.profit_rate >= 0 ? 'text-red-500' : 'text-green-500'">{{
                                                    (h.profit_rate >= 0 ? '+' : '') + h.profit_rate.toFixed(2) }}<span
                                                        class="text-xs ml-0.5">%</span></span></div>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <div class="text-[10px] font-bold uppercase tracking-widest mb-0.5 opacity-60 text-right"
                                                style="color: var(--theme-text-muted);">
                                                今日预估盈亏</div>
                                            <span class="text-lg font-black font-mono"
                                                :class="h.today_profit >= 0 ? 'text-red-400' : 'text-green-400'">{{
                                                (h.today_profit >= 0 ? '+' : '') + (h.today_profit !== undefined ?
                                                h.today_profit.toFixed(2) : '0.00') }}</span>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2 pt-3 border-t border-white/[0.03] text-[10px]">
                                        <div class="flex flex-col"><span class="font-medium mb-0.5"
                                                style="color: var(--theme-text-muted);">持份</span><span
                                                class="font-bold font-mono"
                                                style="color: var(--theme-text-secondary);">{{
                                                h.shares }}</span></div>
                                        <div class="flex flex-col"><span class="font-medium mb-0.5"
                                                style="color: var(--theme-text-muted);">成本价</span><span
                                                class="font-bold font-mono"
                                                style="color: var(--theme-text-secondary);">{{
                                                h.cost_price }}</span>
                                        </div>
                                        <div class="flex flex-col items-end"><span class="font-medium mb-0.5"
                                                style="color: var(--theme-text-muted);">当前市值</span><span
                                                class="font-black font-mono text-blue-500 text-[11px]">{{
                                                h.market_value.toFixed(0) }}</span></div>
                                    </div>
                                </div>
                                <div class="absolute bottom-0 left-0 right-0 h-9 backdrop-blur-md border-t flex items-stretch translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out z-10"
                                    style="background-color: var(--theme-bg-nav); border-color: var(--theme-border-light);">
                                    <button @click.stop="toggleHoldings(h)"
                                        class="flex-1 flex items-center justify-center gap-2 hover:bg-blue-500/10 transition-all text-gray-400 hover:text-blue-400 border-r border-white/5 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2.5" stroke="currentColor" class="w-3.5 h-3.5">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                        </svg>
                                        <span class="text-[10px] font-bold tracking-wider">重仓股</span>
                                    </button>
                                    <div class="flex-[1.5] flex items-stretch">
                                        <button @click.stop="openEditHoldingModal(h)"
                                            class="flex-1 flex items-center justify-center gap-1.5 hover:bg-yellow-500/10 transition-all text-gray-500 hover:text-yellow-500 border-r border-white/5 group/btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="2" stroke="currentColor"
                                                class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                            </svg>
                                            <span class="text-[10px] font-bold">编辑</span>
                                        </button>
                                        <button @click.stop="deleteHolding(h.code)"
                                            class="flex-1 flex items-center justify-center gap-1.5 hover:bg-red-500/10 transition-all text-gray-600 hover:text-red-400 group/btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="2" stroke="currentColor"
                                                class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                            <span class="text-[10px] font-bold">删除</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="holdings.length > 0 && !isLoadingHoldings" class="border-t transition-colors"
                        style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-light);">
                        <button @click="isHoldingsListCollapsed = !isHoldingsListCollapsed"
                            class="w-full py-3 flex items-center justify-center transition-colors group"
                            style="color: var(--theme-text-muted);">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor"
                                class="w-6 h-6 transition-transform duration-300 group-hover:text-blue-500 group-hover:scale-125"
                                :class="isHoldingsListCollapsed ? 'rotate-0' : 'rotate-180'">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="px-4 pt-4">
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6 px-1">
                        <div class="flex items-center gap-3">
                            <h3 class="text-xl font-black uppercase tracking-tight"
                                style="color: var(--theme-text-header);">自选基金</h3>
                            <span v-if="funds.length > 0"
                                class="text-xs px-2 py-0.5 rounded-full border shadow-sm font-bold"
                                style="background-color: var(--theme-bg-surface); color: var(--theme-text-muted); border-color: var(--theme-border-default);">{{
                                filteredFunds.length }}/{{ funds.length }}</span>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <div class="relative group flex items-center rounded-lg border p-0.5 focus-within:border-blue-500/50 focus-within:ring-1 focus-within:ring-blue-500/50 transition-all shadow-sm"
                                style="background-color: var(--theme-bg-surface); border-color: var(--theme-border-default);">
                                <input type="text" v-model="newFundCode" @keyup.enter="addFund" placeholder="添加基金代码"
                                    class="w-28 focus:w-36 bg-transparent border-none text-xs text-center px-2 py-1.5 focus:outline-none transition-all font-mono"
                                    style="color: var(--theme-text-primary);">
                                <button @click="addFund" :disabled="isAddingFund"
                                    class="bg-blue-600 hover:bg-blue-500 text-white px-2.5 py-1 rounded-md text-xs font-bold transition-all disabled:opacity-50 active:scale-95 shadow-sm border border-white/10"
                                    title="添加">
                                    <span v-if="isAddingFund" class="flex items-center justify-center">
                                        <svg class="animate-spin h-3.5 w-3.5 text-white"
                                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                            </path>
                                        </svg>
                                    </span>
                                    <span v-else>+</span>
                                </button>
                            </div>
                            <div v-if="fundDisplayMode === 'list'" class="flex p-1 rounded-lg border"
                                style="background-color: var(--theme-bg-surface); border-color: var(--theme-border-default);">
                                <button @click="fundRowHeight = 'compact'"
                                    class="px-2.5 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundRowHeight === 'compact' ? 'bg-indigo-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'"
                                    title="紧凑行高">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3 4.5h17.25M3 9h17.25M3 13.5h17.25" />
                                    </svg>
                                </button>
                                <button @click="fundRowHeight = 'comfortable'"
                                    class="px-2.5 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundRowHeight === 'comfortable' ? 'bg-indigo-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'"
                                    title="舒适行高">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3 4.5h17.25M3 12h17.25M3 19.5h17.25" />
                                    </svg>
                                </button>
                            </div>
                            <div class="flex p-1 rounded-lg border"
                                style="background-color: var(--theme-bg-surface); border-color: var(--theme-border-default);">
                                <button @click="setFundDisplayMode('card')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium flex items-center gap-1.5"
                                    :class="fundDisplayMode === 'card' ? 'bg-slate-500 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'"
                                    title="卡片视图">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                                    </svg>
                                    <span class="hidden sm:inline">卡片</span>
                                </button>
                                <button @click="setFundDisplayMode('list')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium flex items-center gap-1.5"
                                    :class="fundDisplayMode === 'list' ? 'bg-slate-500 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'"
                                    title="列表视图">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                                    </svg>
                                    <span class="hidden sm:inline">列表</span>
                                </button>
                            </div>
                            <div class="flex p-1 rounded-lg border"
                                style="background-color: var(--theme-bg-surface); border-color: var(--theme-border-default);">
                                <button @click="setLegacyFundSortMode('default')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="(fundSortMode === 'default' && fundSortField === 'default') ? 'bg-blue-600 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'">默认</button>
                                <button @click="setLegacyFundSortMode('gain')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundSortMode === 'gain' ? 'bg-red-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'">涨幅</button>
                                <button @click="setLegacyFundSortMode('loss')"
                                    class="px-3 py-1 text-xs rounded-md transition-all font-medium"
                                    :class="fundSortMode === 'loss' ? 'bg-green-600/80 text-white shadow-sm' : 'text-gray-400 hover:text-blue-500'">跌幅</button>
                            </div>
                            <div v-if="funds.length > 0" class="relative group">
                                <input type="text" v-model="fundFilterText" placeholder="搜索基金名/代码..."
                                    class="theme-input border rounded-lg px-3 py-1.5 pl-8 pr-8 text-sm w-full sm:w-56">
                                <span
                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs transition-colors group-focus-within:text-blue-500 pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2.5" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                                    </svg>
                                </span>
                                <button v-show="fundFilterText" type="button" @click.stop="fundFilterText = ''"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 hover:text-red-500 hover:bg-gray-500/10 rounded-full transition-all p-1.5 cursor-pointer flex items-center justify-center pointer-events-auto"
                                    style="color: var(--theme-text-muted);" title="清空搜索">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="3" stroke="currentColor" class="w-3.5 h-3.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="pb-24">
                        <div v-if="funds.length === 0" class="text-center py-24"
                            style="color: var(--theme-text-muted);">
                            <div class="mb-6 opacity-20 flex justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                                    stroke="currentColor" class="w-24 h-24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
                                </svg>
                            </div>
                            <p class="font-medium text-lg">暂无自选基</p>
                        </div>
                        <transition-group v-if="fundDisplayMode === 'card'" name="list" tag="div"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3">
                            <div v-for="fund in filteredFunds" :key="fund.code" @click="toggleHoldings(fund)"
                                class="rounded-xl p-3 border transition-all hover:shadow-[0_0_15px_rgba(59,130,246,0.1)] hover:scale-[1.02] group relative overflow-hidden cursor-pointer flex flex-col h-full"
                                style="background-color: var(--theme-bg-card); border-color: var(--theme-border-default);"
                                :class="[fund.change > 0 ? 'border-red-500/10 bg-red-500/[0.02]' : (fund.change < 0 ? 'border-green-500/10 bg-green-500/[0.02]' : 'border-gray-300/10'), fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '', fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : '']">
                                <div class="flex-1 space-y-2">
                                    <div class="flex justify-between items-start gap-1">
                                        <div class="flex items-center gap-1.5 min-w-0 flex-1">
                                            <h3 class="font-bold text-sm whitespace-normal line-clamp-2 leading-tight"
                                                :title="fund.name" style="color: var(--theme-text-primary);">{{
                                                fund.name }}</h3>
                                            <span class="text-[10px] px-1 py-0.5 rounded font-mono shrink-0"
                                                style="background-color: var(--theme-bg-subtle); color: var(--theme-text-muted);">{{
                                                fund.code }}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-baseline gap-1">
                                            <span
                                                class="text-2xl font-black font-mono tracking-tighter transition-all duration-300 flex items-center"
                                                :class="[fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'), fund.animating ? 'pop-effect' : '']">{{
                                                (fund.change > 0 ? '+' : '') + fund.change }}%<span
                                                    class="text-lg w-5 text-center inline-block transition-all duration-300 transform"
                                                    :class="fund.animating ? 'opacity-100 scale-125' : 'opacity-0 scale-50 overflow-hidden w-0'">{{
                                                    fund.changeType === 'up' ? '↑' : '↓' }}</span></span>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-[10px] font-mono uppercase leading-none mb-0.5"
                                                style="color: var(--theme-text-muted);">
                                                净值</p>
                                            <span class="text-sm font-bold font-mono transition-transform"
                                                style="color: var(--theme-text-secondary);"
                                                :class="fund.animating ? 'scale-110' : ''">{{ fund.price }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 flex justify-between items-end">
                                    <span
                                        class="text-[10px] font-mono opacity-60 group-hover:opacity-100 transition-opacity"
                                        style="color: var(--theme-text-muted);">{{
                                        fund.time_str }}</span>
                                    <div class="flex items-center gap-2">
                                        <div v-if="isFundInHoldings(fund.code)"
                                            class="flex items-center gap-1 bg-blue-500/10 text-blue-400 border border-blue-500/20 px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">
                                            已持仓</div>
                                    </div>
                                </div>
                                <div class="absolute bottom-0 left-0 right-0 h-11 lg:h-9 backdrop-blur-md border-t flex items-stretch translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out z-10"
                                    style="background-color: var(--theme-bg-nav); border-color: var(--theme-border-default);">
                                    <button @click.stop="toggleHoldings(fund)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-blue-500/10 transition-colors text-gray-400 hover:text-blue-400 border-r border-gray-700/50 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">重仓股</span>
                                    </button>
                                    <button @click.stop="addFundToHoldings(fund)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-green-500/10 transition-colors text-gray-400 hover:text-green-400 border-r border-gray-700/50 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">入持仓</span>
                                    </button>
                                    <button @click.stop="deleteFund(fund.code)"
                                        class="flex-1 flex items-center justify-center gap-1.5 hover:bg-red-500/10 transition-colors text-gray-500 hover:text-red-400 group/btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="2" stroke="currentColor"
                                            class="w-3.5 h-3.5 transition-transform group-hover/btn:scale-110">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                        <span class="text-[10px] lg:text-[11px] font-bold">移除</span>
                                    </button>
                                </div>
                            </div>
                        </transition-group>

                        <div v-else class="fund-list-view fund-list-desktop rounded-xl overflow-hidden border"
                            style="border-color: var(--theme-border-default);">
                            <table class="fund-list-table">
                                <thead class="fund-list-header">
                                    <tr>
                                        <th class="sortable" :class="getSortClass('name')" @click="toggleSort('name')">
                                            基金名称</th>
                                        <th class="sortable text-right" :class="getSortClass('change')"
                                            @click="toggleSort('change')">涨跌幅</th>
                                        <th class="sortable text-right" :class="getSortClass('price')"
                                            @click="toggleSort('price')">净值</th>
                                        <th class="text-right">更新时间</th>
                                        <th class="text-center">状态</th>
                                        <th class="text-right">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="fund in filteredFunds" :key="fund.code" @click="toggleHoldings(fund)"
                                        class="fund-list-row"
                                        :class="[fundRowHeight, fund.change > 0 ? 'up' : (fund.change < 0 ? 'down' : ''), fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '', fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : '']">
                                        <td>
                                            <div class="flex flex-col">
                                                <span class="font-bold text-sm"
                                                    style="color: var(--theme-text-primary);">{{
                                                    fund.name }}</span>
                                                <span class="text-[10px] font-mono"
                                                    style="color: var(--theme-text-muted);">{{ fund.code }}</span>
                                            </div>
                                        </td>
                                        <td class="text-right">
                                            <span class="text-lg font-black font-mono"
                                                :class="[fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'), fund.animating ? 'pop-effect' : '']">{{
                                                (fund.change > 0 ? '+' : '') + fund.change }}%</span>
                                        </td>
                                        <td class="text-right"><span class="text-base font-bold font-mono"
                                                style="color: var(--theme-text-primary);">{{ fund.price
                                                }}</span></td>
                                        <td class="text-right"><span class="text-[11px] font-mono"
                                                style="color: var(--theme-text-muted);">{{
                                                fund.time_str }}</span></td>
                                        <td class="text-center">
                                            <span v-if="isFundInHoldings(fund.code)"
                                                class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20">已持仓</span>
                                        </td>
                                        <td>
                                            <div class="fund-list-actions justify-end">
                                                <button @click.stop="toggleHoldings(fund)"
                                                    class="fund-list-btn primary">重仓股</button>
                                                <button @click.stop="addFundToHoldings(fund)"
                                                    class="fund-list-btn">入持仓</button>
                                                <button @click.stop="deleteFund(fund.code)"
                                                    class="fund-list-btn danger">移除</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div v-if="fundDisplayMode === 'list'" class="fund-list-mobile">
                            <div v-for="fund in filteredFunds" :key="fund.code" @click="toggleHoldings(fund)"
                                class="fund-mobile-card"
                                :class="[fund.change > 0 ? 'up' : (fund.change < 0 ? 'down' : ''), fund.animating && fund.changeType === 'up' ? 'animate-flash-up' : '', fund.animating && fund.changeType === 'down' ? 'animate-flash-down' : '']">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex flex-col min-w-0 flex-1"><span class="font-bold text-sm"
                                            style="color: var(--theme-text-primary);">{{ fund.name }}</span><span
                                            class="text-[10px] font-mono" style="color: var(--theme-text-muted);">{{
                                            fund.code }}</span></div>
                                    <span class="text-xl font-black font-mono"
                                        :class="[fund.change > 0 ? 'text-red-500' : (fund.change < 0 ? 'text-green-500' : 'text-gray-400'), fund.animating ? 'pop-effect' : '']">{{
                                        (fund.change > 0 ? '+' : '') + fund.change }}%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <span class="text-sm font-bold text-gray-300 font-mono">{{ fund.price }}</span>
                                        <span class="text-[10px] text-gray-500 font-mono">{{ fund.time_str }}</span>
                                        <span v-if="isFundInHoldings(fund.code)"
                                            class="inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20">已持仓</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click.stop="toggleHoldings(fund)"
                                            class="fund-list-btn primary py-1 px-2 text-[10px]">重仓</button>
                                        <button @click.stop="deleteFund(fund.code)"
                                            class="fund-list-btn danger py-1 px-2 text-[10px]">移除</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="funds.length > 0" class="mt-8 mb-12 text-center">
                            <span class="px-4 py-1.5 rounded-full text-xs border font-medium shadow-sm"
                                style="background-color: var(--theme-bg-surface); color: var(--theme-text-muted); border-color: var(--theme-border-default);">实时估值，约
                                3 秒刷新</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 通用模态框 -->
        <div v-if="modal.visible" class="fixed inset-0 z-[100] flex items-center justify-center px-4"
            @keydown.esc="closeModal(false)">
            <transition name="fade" appear>
                <div v-if="modal.visible" class="absolute inset-0 bg-black/60 backdrop-blur-sm"
                    @click="closeModal(false)">
                </div>
            </transition>
            <transition name="modal" appear>
                <div v-if="modal.visible" class="relative rounded-2xl shadow-2xl border w-full max-w-md p-6"
                    style="background-color: var(--theme-bg-card); border-color: var(--theme-border-default);">
                    <h3 class="text-xl font-bold mb-4" style="color: var(--theme-text-primary);">{{ modal.title }}</h3>
                    <div v-if="modal.type === 'prompt'" class="mb-6">
                        <input ref="modalInput" v-model="modal.inputValue" @keyup.enter="closeModal(true)" type="text"
                            class="w-full border rounded-lg px-4 py-3 focus:outline-none transition-colors"
                            style="background-color: var(--theme-bg-input); color: var(--theme-text-primary); border-color: var(--theme-border-default);"
                            :placeholder="modal.placeholder">
                    </div>
                    <div v-if="modal.type === 'confirm'" class="mb-6" style="color: var(--theme-text-secondary);">{{
                        modal.message }}</div>
                    <div class="flex justify-end gap-3">
                        <button @click="closeModal(false)"
                            class="px-5 py-2 rounded-lg transition-colors font-medium border"
                            style="background-color: var(--theme-bg-surface); color: var(--theme-text-secondary); border-color: var(--theme-border-default);">取消</button>
                        <button @click="closeModal(true)"
                            class="px-5 py-2 rounded-lg font-bold transition-colors shadow-lg"
                            :class="modal.confirmButtonClass || 'bg-blue-600 hover:bg-blue-500 text-white'">{{
                            modal.confirmText || '确定' }}</button>
                    </div>
                </div>
            </transition>
        </div>

        <!-- 持仓编辑模态框 -->
        <div v-if="holdingModal.visible" class="fixed inset-0 z-[100] flex items-center justify-center px-4">
            <transition name="fade" appear>
                <div v-if="holdingModal.visible" class="absolute inset-0 bg-black/60 backdrop-blur-sm"
                    @click="closeHoldingModal()">
                </div>
            </transition>
            <transition name="modal" appear>
                <div v-if="holdingModal.visible" class="relative rounded-2xl shadow-2xl border w-full max-w-md p-6"
                    style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                    <h3 class="text-xl font-black mb-4 uppercase tracking-tight flex items-center gap-2"
                        style="color: var(--theme-text-primary);">
                        <span class="w-1.5 h-4 bg-blue-500 rounded-full"></span>{{ holdingModal.isEdit ? '编辑持仓' : '添加持仓'
                        }}
                    </h3>
                    <div class="space-y-4">
                        <div><label class="text-sm block mb-1 font-bold"
                                style="color: var(--theme-text-muted);">基金代码</label><input type="text"
                                v-model="holdingModal.code" :disabled="holdingModal.isEdit" maxlength="6"
                                class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 transition-colors font-mono"
                                style="background-color: var(--theme-bg-input); color: var(--theme-text-primary); border-color: var(--theme-border-default);"
                                :class="{'opacity-50 cursor-not-allowed': holdingModal.isEdit}" placeholder="6位基金代码">
                        </div>
                        <div><label class="text-sm block mb-1 font-bold" style="color: var(--theme-text-muted);">成本价
                                (元)</label><input type="number" v-model.number="holdingModal.costPrice" step="0.0001"
                                class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 transition-colors font-mono"
                                style="background-color: var(--theme-bg-input); color: var(--theme-text-primary); border-color: var(--theme-border-default);"
                                placeholder="如 1.2345"></div>
                        <div><label class="text-sm block mb-1 font-bold"
                                style="color: var(--theme-text-muted);">持有份额</label><input type="number"
                                v-model.number="holdingModal.shares" step="0.01"
                                class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 transition-colors font-mono"
                                style="background-color: var(--theme-bg-input); color: var(--theme-text-primary); border-color: var(--theme-border-default);"
                                placeholder="如 1000"></div>
                        <div><label class="text-sm block mb-1 font-bold" style="color: var(--theme-text-muted);">备注
                                (可选)</label><input type="text" v-model="holdingModal.note"
                                class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 transition-colors"
                                style="background-color: var(--theme-bg-input); color: var(--theme-text-primary); border-color: var(--theme-border-default);"
                                placeholder="可选备注信息"></div>
                    </div>
                    <div class="flex justify-end gap-3 mt-6">
                        <button @click="closeHoldingModal()"
                            class="px-5 py-2 rounded-lg transition-colors font-medium border"
                            style="background-color: var(--theme-bg-surface); color: var(--theme-text-secondary); border-color: var(--theme-border-default);">取消</button>
                        <button @click="saveHolding()" :disabled="holdingModal.saving"
                            class="px-5 py-2 rounded-lg font-bold transition-colors shadow-lg bg-blue-600 hover:bg-blue-500 text-white disabled:bg-gray-600 disabled:cursor-not-allowed">{{
                            holdingModal.saving ? '保存中...' : '保存' }}</button>
                    </div>
                </div>
            </transition>
        </div>

        <!-- 重仓股详情抽屉 -->
        <div v-if="portfolioDrawer.visible" class="fixed inset-0 z-[110] overflow-hidden">
            <transition name="fade" appear>
                <div v-if="portfolioDrawer.visible" class="absolute inset-0 bg-black/60 backdrop-blur-sm"
                    @click="closePortfolioDrawer()"></div>
            </transition>
            <transition name="drawer" appear>
                <div v-if="portfolioDrawer.visible"
                    class="absolute right-0 top-0 h-full w-full max-w-md shadow-2xl flex flex-col border-l"
                    style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                    <div class="p-6 border-b flex items-center justify-between"
                        style="background-color: var(--theme-bg-nav); border-color: var(--theme-border-light);">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--theme-text-primary);">{{
                                portfolioDrawer.fundName }}</h3>
                            <p class="text-xs text-gray-400 font-mono mt-1 font-medium tracking-tight">{{
                                portfolioDrawer.fundCode }} · 前十大重仓股详情</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button
                                @click="toggleHoldings({code: portfolioDrawer.fundCode, name: portfolioDrawer.fundName}, true)"
                                :disabled="portfolioDrawer.loading"
                                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-blue-500/10 text-gray-400 hover:text-blue-400 transition-all group/ref"
                                title="刷新持仓构成">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor"
                                    class="w-5 h-5 transition-transform group-hover/ref:rotate-180 duration-500"
                                    :class="{'animate-spin': portfolioDrawer.loading}">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                            </button>
                            <button @click="closePortfolioDrawer()"
                                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-red-500/10 dark:hover:bg-red-500/20 transition-all group/close"
                                title="关闭详情">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="2.5" stroke="currentColor"
                                    class="w-6 h-6 transition-all duration-300 text-[var(--theme-text-muted)] group-hover/close:text-red-500 dark:group-hover/close:text-red-400 group-hover/close:scale-110">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                        <div v-if="portfolioDrawer.loading" class="flex flex-col items-center justify-center h-64"
                            style="color: var(--theme-text-muted);">
                            <svg class="animate-spin h-10 w-10 mb-4 text-blue-500" xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="3">
                                </circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <p class="font-medium">正在拉取实时行情...</p>
                        </div>
                        <div v-else-if="portfolioDrawer.holdings && portfolioDrawer.holdings.length > 0"
                            class="space-y-4">
                            <div class="rounded-2xl p-5 border shadow-inner transition-colors"
                                style="background-color: var(--theme-bg-subtle); border-color: var(--theme-border-default);">
                                <div class="flex justify-between items-center mb-2"><span
                                        class="text-xs font-bold uppercase tracking-wider"
                                        style="color: var(--theme-text-secondary);">前十大重仓贡献预估</span><span
                                        class="text-xs bg-blue-500/10 text-blue-500 px-1.5 py-0.5 rounded border border-blue-500/20 scale-90 font-bold">实时估算</span>
                                </div>
                                <div class="text-4xl font-bold font-mono tracking-tighter"
                                    :class="portfolioContribution.available ? (portfolioContribution.value >= 0 ? 'text-red-500' : 'text-green-500') : 'text-gray-400'">
                                    <template v-if="portfolioContribution.available">{{ portfolioContribution.value >= 0
                                        ? '+' : '' }}{{ portfolioContribution.value.toFixed(3) }}<span
                                            class="text-lg ml-0.5">%</span></template>
                                    <template v-else>--</template>
                                </div>
                                <div class="mt-3 text-[11px] flex items-center gap-1 font-medium"
                                    style="color: var(--theme-text-muted);"><span class="opacity-70">数据截止:</span><span
                                        class="italic" style="color: var(--theme-text-secondary);">{{
                                        portfolioDrawer.meta.report_period || portfolioDrawer.holdings[0]?.report_period
                                        || '--' }} 季度报告期</span></div>
                                <div class="mt-2 text-[11px] flex items-center justify-between font-medium"
                                    style="color: var(--theme-text-muted);">
                                    <span>权重覆盖: <span class="font-mono" style="color: var(--theme-text-primary);">{{
                                            portfolioDrawer.meta.weight_coverage !== undefined ?
                                            portfolioDrawer.meta.weight_coverage.toFixed(2) + '%' : '--'
                                            }}</span></span><span>置信度: <span
                                            style="color: var(--theme-text-primary);">{{
                                            portfolioDrawer.meta.confidence_label || '--' }}</span></span>
                                </div>
                                <p v-if="portfolioDrawer.meta.estimate_mode === 'equal_weight'"
                                    class="mt-2 text-[11px] text-yellow-600 font-bold">已使用等权估算，结果仅供参考</p>
                                <p v-else-if="!portfolioDrawer.meta.contribution_available"
                                    class="mt-2 text-[11px] text-yellow-600 font-bold">权重占比缺失，贡献暂不可估算</p>
                                <p v-if="portfolioDrawer.meta.estimate_mode === 'cached_stale'"
                                    class="mt-1 text-[11px] text-orange-500 font-bold">使用过期缓存权重估算，请注意时效</p>
                                <p v-if="portfolioDrawer.meta.parse_error"
                                    class="mt-1 text-[11px] text-orange-500 font-bold">
                                    解析提示：{{ portfolioDrawer.meta.parse_error }}</p>
                            </div>
                            <div class="space-y-3 pb-8">
                                <div v-for="(stock, idx) in portfolioDrawer.holdings" :key="stock.code"
                                    class="rounded-xl p-4 border transition-all hover:shadow-md hover:-translate-y-0.5 group"
                                    style="background-color: var(--theme-bg-card); border-color: var(--theme-border-default);">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2"><span
                                                    class="text-xs font-mono w-5 font-bold"
                                                    style="color: var(--theme-text-muted);">{{ (idx +
                                                    1).toString().padStart(2, '0') }}</span>
                                                <h4 class="font-bold truncate text-base leading-tight group-hover:text-blue-500 transition-colors"
                                                    style="color: var(--theme-text-primary);">{{
                                                    stock.name }}</h4>
                                            </div>
                                            <div class="text-[11px] font-mono mt-1 opacity-80"
                                                style="color: var(--theme-text-muted);">{{ stock.code
                                                }}</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-lg font-bold font-mono leading-none"
                                                :class="stock.change_percent >= 0 ? 'text-red-500' : 'text-green-500'">
                                                {{ stock.change_percent >= 0 ? '+' : '' }}{{
                                                stock.change_percent.toFixed(2) }}%</div>
                                            <div class="text-[11px] font-bold font-mono mt-1.5 px-2 py-0.5 rounded inline-block transition-colors"
                                                :class="typeof stock.contribution === 'number' ? (stock.contribution >= 0 ? 'bg-red-500/10 text-red-500' : 'bg-green-500/10 text-green-500') : 'bg-gray-100 text-gray-400'">
                                                贡献: {{ typeof stock.contribution === 'number' ?
                                                (stock.contribution.toFixed(3) + '%') : '--' }}</div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-end text-[11px] mt-4 pt-3 border-t"
                                        style="border-color: var(--theme-border-light);">
                                        <div class="font-medium" style="color: var(--theme-text-muted);">持仓占比: <span
                                                class="text-yellow-600 font-mono font-bold ml-1 text-sm">{{
                                                stock.weight ? stock.weight.toFixed(2) + '%' : '--' }}</span></div>
                                        <div class="font-mono" style="color: var(--theme-text-muted);">现价: <span
                                                class="font-bold ml-1" style="color: var(--theme-text-secondary);">{{
                                                stock.price.toFixed(2) }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else class="flex flex-col items-center justify-center py-24"
                            style="color: var(--theme-text-muted);">
                            <div class="mb-6 opacity-10">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                                    stroke="currentColor" class="w-24 h-24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                </svg>
                            </div>
                            <p class="font-bold text-lg">暂无重仓股数据</p>
                            <p class="text-xs opacity-40 mt-2">请确认基金代码是否正确或稍后重试.</p>
                        </div>
                    </div>
                    <div class="p-6 border-t"
                        style="border-color: var(--theme-border-default); background-color: var(--theme-bg-subtle);">
                        <div class="flex items-start gap-3 p-3 rounded-lg border shadow-sm"
                            style="background-color: var(--theme-bg-card); border-color: var(--theme-border-light);">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" class="w-5 h-5 mt-0.5 text-blue-500 shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                            </svg>
                            <p class="text-[11px] leading-relaxed font-medium"
                                style="color: var(--theme-text-secondary);">
                                <strong class="mr-1" style="color: var(--theme-text-primary);">数据提示:
                                </strong>前十大重仓股为季度公开披露数据, 具有滞后性. 实时贡献度基于当前股票涨跌幅估算, 仅供基金日内波动参考, 不代表基金实际净值.
                            </p>
                        </div>
                    </div>
                </div>
            </transition>
        </div>
        {% endraw %}

        <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>